[{"id":"d3ff7562.eebf38","type":"tab","label":"Main","disabled":false,"info":""},{"id":"7d4c9938.2a0338","type":"tab","label":"Entertainment","disabled":false,"info":""},{"id":"6e3c7fcf.e7591","type":"tab","label":"Blinds","disabled":false,"info":""},{"id":"5ecca76c.9de098","type":"tab","label":"Loggia","disabled":false,"info":""},{"id":"423c527d.a422fc","type":"tab","label":"Bedroom","disabled":false,"info":""},{"id":"260e105e.72e61","type":"tab","label":"Bathroom","disabled":false,"info":""},{"id":"ce35d200.18817","type":"tab","label":"Entrance","disabled":false,"info":""},{"id":"2614aeae.a90552","type":"tab","label":"Security","disabled":false,"info":""},{"id":"e550f91e.577438","type":"tab","label":"Tracking","disabled":false,"info":""},{"id":"f008a57656af0219","type":"tab","label":"Experiments","disabled":false,"info":"","env":[]},{"id":"84cddc8f.78464","type":"tab","label":"NFC Tags","disabled":false,"info":""},{"id":"b13dd5761c2c67bf","type":"tab","label":"Energy Control","disabled":false,"info":"","env":[]},{"id":"27f43369.1137ec","type":"subflow","name":"apartment occupied?","info":"","category":"","in":[{"x":181.5,"y":69,"wires":[{"id":"cbbdb47d.a4ed48"}]}],"out":[{"x":700,"y":40,"wires":[{"id":"1792a55d.ddc24b","port":0}]},{"x":700,"y":90,"wires":[{"id":"1792a55d.ddc24b","port":1}]}],"outputLabels":["clear","occupied"]},{"id":"7fa54d71.595124","type":"subflow","name":"alarm state active","info":"","category":"","in":[{"x":220,"y":300,"wires":[{"id":"569f155d.bbd95c"}]}],"out":[{"x":540,"y":350,"wires":[{"id":"b631dff9.45941","port":0}]}]},{"id":"d4379195.7e131","type":"subflow","name":"get secret","info":"","category":"","in":[{"x":40,"y":40,"wires":[{"id":"358bbb81.f1b0c4"}]}],"out":[{"x":1260,"y":40,"wires":[{"id":"39cc86d9ec3ed34f","port":0}]}],"env":[{"name":"secret_id","type":"str","value":"","ui":{"icon":"font-awesome/fa-lock","type":"input","opts":{"types":["str"]}}},{"name":"is_bearer","type":"bool","value":"false"}],"meta":{},"color":"#3FADB5","icon":"font-awesome/fa-lock"},{"id":"6327b002.7d9f4","type":"subflow","name":"Float Addition","info":"","category":"","in":[{"x":40,"y":40,"wires":[{"id":"3f7c3f1f.cfbce"}]}],"out":[{"x":420,"y":40,"wires":[{"id":"3f7c3f1f.cfbce","port":0}]}],"env":[{"name":"sensor_id","type":"str","value":"","ui":{"icon":"font-awesome/fa-plus-circle","type":"input","opts":{"types":["str"]}}},{"name":"payload_path","type":"str","value":""}],"color":"#FDD0A2","inputLabels":["float to add"],"outputLabels":["sensor value + input float = output"],"icon":"font-awesome/fa-plus-circle"},{"id":"78fe396.483dac8","type":"server","name":"Home Assistant","legacy":false,"addon":true,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true},{"id":"527c202d.c9b79","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"ff691ce7.c0e1c","type":"influxdb","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"homeassistant","name":"Home Assistant Influx","usetls":false,"tls":"","influxdbVersion":"1.x","url":"http://localhost:8086","rejectUnauthorized":true},{"id":"f7f39f4e.896ae","type":"tls-config","name":"local-tls","cert":"","key":"","ca":"","certname":"","keyname":"","caname":"","verifyservercert":false},{"id":"cbbdb47d.a4ed48","type":"api-current-state","z":"27f43369.1137ec","name":"apartment occupancy","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"binary_sensor.apartment_occupancy","state_type":"habool","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":361.5,"y":69,"wires":[["1792a55d.ddc24b"]]},{"id":"1792a55d.ddc24b","type":"switch","z":"27f43369.1137ec","name":"is occupied?","property":"payload","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":554.5,"y":69,"wires":[[],[]]},{"id":"569f155d.bbd95c","type":"function","z":"7fa54d71.595124","name":"alarm_state","func":"msg.alarm_state = global.get('alarm_state') || 'inactive';\n\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":300,"wires":[["b631dff9.45941"]]},{"id":"b631dff9.45941","type":"switch","z":"7fa54d71.595124","name":"was triggered","property":"alarm_state","propertyType":"msg","rules":[{"t":"eq","v":"triggered","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":380,"y":350,"wires":[[]]},{"id":"cbb350e7.54a96","type":"file in","z":"d4379195.7e131","name":"secrets","filename":"/config/secrets.yaml","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":380,"y":80,"wires":[["168da1d3.7b3ace"]]},{"id":"168da1d3.7b3ace","type":"yaml","z":"d4379195.7e131","property":"payload","name":"","x":510,"y":80,"wires":[["cd100a20.901b08"]]},{"id":"cd100a20.901b08","type":"function","z":"d4379195.7e131","name":"save secrets in memory","func":"for (let [key, value] of Object.entries(msg.payload)) {\n  flow.set(key,value);\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":690,"y":80,"wires":[["cb9383d4.07e1a"]]},{"id":"358bbb81.f1b0c4","type":"function","z":"d4379195.7e131","name":"get already loaded secret","func":"msg.secret_id = env.get(\"secret_id\");\nmsg.secret = flow.get(msg.secret_id);\n\nif (msg.secret !== undefined && msg.secret !== null) {\n    return [ msg, null ];\n} else {\n    msg.payload_backup = msg.payload;\n    return [ null, msg ];\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":190,"y":40,"wires":[["39cc86d9ec3ed34f"],["cbb350e7.54a96"]],"outputLabels":["secret was loaded","secret is not loaded yet"]},{"id":"cb9383d4.07e1a","type":"function","z":"d4379195.7e131","name":"export secret","func":"msg.secret = flow.get(msg.secret_id);\nmsg.payload = msg.payload_backup;\ndelete msg.payload_backup;\ndelete msg.filename;\n\nif (msg.secret !== undefined && msg.secret !== null) {\n   return [ msg, null ];\n} else {\n    msg.error = \"SECRET DOES NOT EXIST!\"\n   return [ null, msg ];\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":890,"y":80,"wires":[["39cc86d9ec3ed34f"],["39cc86d9ec3ed34f","9020c683.c61c98"]],"outputLabels":["secret was loaded","secret does not exist"]},{"id":"9020c683.c61c98","type":"debug","z":"d4379195.7e131","name":"log error","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1140,"y":100,"wires":[]},{"id":"39cc86d9ec3ed34f","type":"function","z":"d4379195.7e131","name":"set bearer","func":"if (env.get(\"is_bearer\")) {\n  msg.secret = \"Bearer \" + msg.secret;\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1140,"y":40,"wires":[[]]},{"id":"3f7c3f1f.cfbce","type":"function","z":"6327b002.7d9f4","name":"Input + sensor value = output","func":"function Leaf(obj,path) {\n  path=path.split('.');\n  var res=obj;\n  for (var i=0;i<path.length;i++) res=res[path[i]];\n  return res;\n}\n\nconst globalHomeAssistant = global.get('homeassistant');\n\nvar sensor_id = env.get(\"sensor_id\");\nvar payload_path = env.get(\"payload_path\");\n\nvar input = parseFloat(Leaf(msg, payload_path));\nvar sensor_value = parseFloat(globalHomeAssistant.homeAssistant.states[sensor_id].state);\n\nmsg.payload = sensor_value + input;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":230,"y":40,"wires":[[]]},{"id":"74556465.5e1fac","type":"api-call-service","z":"d3ff7562.eebf38","name":"Vacuum Robot ON","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"vacuum","service":"start","entityId":"vacuum.roborock_s7","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":810,"y":20,"wires":[[]]},{"id":"d5a40336.045ed","type":"inject","z":"d3ff7562.eebf38","name":"10am weekdays","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"00 10 * * 1,2,3,4,5","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":144.5,"y":60,"wires":[["d2922fa7.4bc15"]]},{"id":"dd3a875c.3ca6f8","type":"server-state-changed","z":"d3ff7562.eebf38","name":"Kitchen Motion","server":"78fe396.483dac8","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.kitchen_sink_motion","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":120,"y":180,"wires":[[]]},{"id":"3e0b850.2c5117c","type":"switch","z":"d3ff7562.eebf38","name":"detected","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":480,"y":180,"wires":[["5f5c835e.99396c","2ebc2530.aba6ea"],["8aa7dbfd.4c8878"]]},{"id":"2ebc2530.aba6ea","type":"api-call-service","z":"d3ff7562.eebf38","name":"Overhead Light ON","server":"78fe396.483dac8","version":1,"service_domain":"light","service":"turn_on","entityId":"light.kitchen_overhead_light","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":670,"y":140,"wires":[[]]},{"id":"8aa7dbfd.4c8878","type":"trigger","z":"d3ff7562.eebf38","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"3","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":650,"y":220,"wires":[["8ddc636e.df38f"]]},{"id":"8ddc636e.df38f","type":"api-call-service","z":"d3ff7562.eebf38","name":"Overhead Light OFF","server":"78fe396.483dac8","version":1,"service_domain":"light","service":"turn_off","entityId":"light.kitchen_overhead_light","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":860,"y":220,"wires":[[]]},{"id":"5f5c835e.99396c","type":"change","z":"d3ff7562.eebf38","name":"reset timer","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":180,"wires":[["8aa7dbfd.4c8878"]]},{"id":"1a4d1ac8.a678e5","type":"server-events","z":"d3ff7562.eebf38","name":"IFTTT","server":"78fe396.483dac8","event_type":"ifttt_webhook_received","x":90,"y":480,"wires":[["e4677a2c.2fb918"]]},{"id":"e4677a2c.2fb918","type":"switch","z":"d3ff7562.eebf38","name":"","property":"payload.event.controlDomain","propertyType":"msg","rules":[{"t":"eq","v":"tv","vt":"str"},{"t":"eq","v":"sleep","vt":"str"},{"t":"eq","v":"printer","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":250,"y":480,"wires":[["3284503b.0166a"],["8cac1b54.768a28"],["775f637d.fe8cdc"]]},{"id":"3284503b.0166a","type":"link out","z":"d3ff7562.eebf38","name":"IFTTT TV Events Output","links":["1a982428.5111cc"],"x":355,"y":460,"wires":[]},{"id":"b816139a.b3f9e","type":"subflow:27f43369.1137ec","z":"d3ff7562.eebf38","name":"","env":[],"x":580,"y":60,"wires":[["74556465.5e1fac"],["b94a88b0.eff1c8"]]},{"id":"b94a88b0.eff1c8","type":"api-call-service","z":"d3ff7562.eebf38","name":"Telegram Log","server":"78fe396.483dac8","version":"1","debugenabled":false,"service_domain":"telegram_bot","service":"send_message","entityId":"","data":"{\"message\":\"Not launching Roomba because someone's home\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":800,"y":60,"wires":[[]]},{"id":"85ff61bd.80eda","type":"server-state-changed","z":"d3ff7562.eebf38","name":"Kitchen Devices Motion","server":"78fe396.483dac8","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.kitchen_devices_presence","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":120,"y":300,"wires":[["f47b3f7.5fbd4c"]]},{"id":"f47b3f7.5fbd4c","type":"switch","z":"d3ff7562.eebf38","name":"detected","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":340,"y":300,"wires":[["efb1f287.eadc5","bb905d7b.ae76f"],["72158545.1954ec"]]},{"id":"efb1f287.eadc5","type":"api-call-service","z":"d3ff7562.eebf38","name":"Kitchen Utilities ON","server":"78fe396.483dac8","version":"1","service_domain":"switch","service":"turn_on","entityId":"switch.kitchen_plug","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":590,"y":280,"wires":[[]]},{"id":"bb905d7b.ae76f","type":"change","z":"d3ff7562.eebf38","name":"reset timer","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":320,"wires":[["72158545.1954ec"]]},{"id":"6bc00530.fa108c","type":"api-call-service","z":"d3ff7562.eebf38","name":"Kitchen Utilities OFF","server":"78fe396.483dac8","version":"1","service_domain":"switch","service":"turn_off","entityId":"switch.kitchen_plug","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":760,"y":360,"wires":[[]]},{"id":"72158545.1954ec","type":"trigger","z":"d3ff7562.eebf38","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"5","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":570,"y":360,"wires":[["6bc00530.fa108c"]]},{"id":"8cc952d3.8b182","type":"api-call-service","z":"d3ff7562.eebf38","name":"bed occupied","server":"78fe396.483dac8","version":"1","debugenabled":false,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.bed_occupied_input","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":620,"y":460,"wires":[[]]},{"id":"8cac1b54.768a28","type":"switch","z":"d3ff7562.eebf38","name":"sleep detected","property":"payload.event.state","propertyType":"msg","rules":[{"t":"eq","v":"sleep_started","vt":"str"},{"t":"eq","v":"sleep_ended","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":420,"y":500,"wires":[["8cc952d3.8b182"],["1306bb69.89c9d5"]]},{"id":"1306bb69.89c9d5","type":"api-call-service","z":"d3ff7562.eebf38","name":"bed not occupied","server":"78fe396.483dac8","version":"1","debugenabled":false,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.bed_occupied_input","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":630,"y":500,"wires":[[]]},{"id":"5f3c7a7e.33eda4","type":"trigger-state","z":"d3ff7562.eebf38","name":"Media: everywhere","server":"78fe396.483dac8","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"media_player.everywhere","entityidfiltertype":"exact","debugenabled":false,"constraints":[],"outputs":6,"customoutputs":[{"messageType":"default","messageValue":"","messageValueType":"json","comparatorPropertyType":"current_state","comparatorType":"is","comparatorValue":"playing","comparatorValueDataType":"str","comparatorPropertyValue":"new_state.state"},{"messageType":"default","messageValue":"","messageValueType":"json","comparatorPropertyType":"current_state","comparatorType":"is","comparatorValue":"off","comparatorValueDataType":"str","comparatorPropertyValue":"new_state.state"},{"messageType":"default","messageValue":"","messageValueType":"json","comparatorPropertyType":"current_state","comparatorType":"is","comparatorValue":"idle","comparatorValueDataType":"str","comparatorPropertyValue":"new_state.state"},{"messageType":"default","messageValue":"","messageValueType":"json","comparatorPropertyType":"current_state","comparatorType":"is","comparatorValue":"paused","comparatorValueDataType":"str","comparatorPropertyValue":"new_state.state"}],"outputinitially":false,"state_type":"str","x":150,"y":780,"wires":[[],[],[],[],[],[]]},{"id":"5953b2af.36038c","type":"trigger-state","z":"d3ff7562.eebf38","name":"Light: nanoleaf","server":"78fe396.483dac8","entityid":"light.nanoleaf","entityidfiltertype":"exact","debugenabled":false,"constraints":[],"outputs":4,"customoutputs":[{"outputId":"1dnhtuz78f","messageType":"default","messageValue":"","comparatorPropertyType":"current_state","comparatorPropertyValue":"new_state.state","comparatorType":"is","comparatorValue":"on"},{"outputId":"ej080y5e098","messageType":"default","messageValue":"","comparatorPropertyType":"current_state","comparatorPropertyValue":"new_state.state","comparatorType":"is","comparatorValue":"off"}],"outputinitially":false,"state_type":"str","x":140,"y":880,"wires":[[],[],[],[]]},{"id":"c8039b89.760f28","type":"api-current-state","z":"d3ff7562.eebf38","name":"Nanoleaf is on","server":"78fe396.483dac8","outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"light.nanoleaf","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":360,"y":740,"wires":[[],["8b7e1035.9df86"]]},{"id":"8b7e1035.9df86","type":"api-call-service","z":"d3ff7562.eebf38","name":"Media Visualization","server":"78fe396.483dac8","service_domain":"light","service":"turn_on","data":"{\"entity_id\":\"light.nanoleaf\",\"effect\":\"0rgasme\"}","mergecontext":"","output_location":"","output_location_type":"none","x":550,"y":740,"wires":[[]]},{"id":"540526f9.65de28","type":"api-call-service","z":"d3ff7562.eebf38","name":"AI: Red X Anim","server":"78fe396.483dac8","service_domain":"light","service":"turn_on","data":"{\"entity_id\":\"light.nanoleaf\",\"effect\":\"sixtyAI_computerSaysNo\"}","mergecontext":"","output_location":"","output_location_type":"none","x":540,"y":800,"wires":[["3ea3fb8c.fd7904"]]},{"id":"3ea3fb8c.fd7904","type":"trigger","z":"d3ff7562.eebf38","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"10","extend":false,"units":"s","reset":"","bytopic":"all","outputs":1,"x":710,"y":800,"wires":[["5157fe04.4c4a3"]]},{"id":"5157fe04.4c4a3","type":"api-call-service","z":"d3ff7562.eebf38","name":"Normal Light","server":"78fe396.483dac8","service_domain":"light","service":"turn_on","data":"{\"entity_id\":\"light.nanoleaf\",\"effect\":\"Inner Peace\"}","mergecontext":"","output_location":"","output_location_type":"none","x":870,"y":800,"wires":[[]]},{"id":"6a6d11a3.a3831","type":"api-current-state","z":"d3ff7562.eebf38","name":"Media: everywhere is playing","server":"78fe396.483dac8","outputs":2,"halt_if":"playing","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"media_player.everywhere","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":380,"y":880,"wires":[[],["7b9deaef.3d2f84"]]},{"id":"7b9deaef.3d2f84","type":"api-call-service","z":"d3ff7562.eebf38","name":"Media Visualization","server":"78fe396.483dac8","service_domain":"light","service":"turn_on","data":"{\"entity_id\":\"light.nanoleaf\",\"effect\":\"0rgasme\"}","mergecontext":"","output_location":"","output_location_type":"none","x":630,"y":880,"wires":[[]]},{"id":"8b1da417.70faa8","type":"api-current-state","z":"d3ff7562.eebf38","name":"Nanoleaf is on","server":"78fe396.483dac8","outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"light.nanoleaf","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":360,"y":800,"wires":[[],["540526f9.65de28"]]},{"id":"775f637d.fe8cdc","type":"api-call-service","z":"d3ff7562.eebf38","name":"print the shopping list","server":"78fe396.483dac8","version":"1","debugenabled":false,"service_domain":"script","service":"print_shopping_list","entityId":"","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":420,"y":540,"wires":[[]]},{"id":"f5161934.cbd058","type":"trigger-state","z":"d3ff7562.eebf38","name":"charging station has turned on","server":"78fe396.483dac8","entityid":"switch.charging_station","entityidfiltertype":"exact","debugenabled":false,"constraints":[],"outputs":3,"customoutputs":[{"outputId":"n25w4pa5dhk","messageType":"default","messageValue":"","comparatorPropertyType":"current_state","comparatorPropertyValue":"new_state.state","comparatorType":"is","comparatorValue":"on"}],"outputinitially":false,"state_type":"str","x":170,"y":980,"wires":[[],[],["2b241d1b.0fd762"]]},{"id":"2b241d1b.0fd762","type":"trigger","z":"d3ff7562.eebf38","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"5","extend":false,"units":"hr","reset":"","bytopic":"all","outputs":1,"x":410,"y":980,"wires":[["86813262.687c8"]]},{"id":"86813262.687c8","type":"api-call-service","z":"d3ff7562.eebf38","name":"turn off","server":"78fe396.483dac8","service_domain":"switch","service":"turn_off","data":"{\"entity_id\":\"switch.charging_station\"}","mergecontext":"","output_location":"","output_location_type":"none","x":560,"y":980,"wires":[[]]},{"id":"b448b45d.d1adf8","type":"server-events","z":"d3ff7562.eebf38","name":"Dconz Event","server":"78fe396.483dac8","event_type":"deconz_event","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"x":110,"y":1060,"wires":[["e5de3997.8f3db8"]]},{"id":"e5de3997.8f3db8","type":"switch","z":"d3ff7562.eebf38","name":"device?","property":"payload.event.id","propertyType":"msg","rules":[{"t":"eq","v":"switch_47","vt":"str"},{"t":"eq","v":"symfonisk_controller","vt":"str"},{"t":"eq","v":"office_blinds","vt":"str"},{"t":"eq","v":"mood_switch","vt":"str"},{"t":"eq","v":"loggia_lightswitch","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":280,"y":1060,"wires":[["f522e33e.0e3b2"],["858fb146.95725"],["c1346b08.87caf8"],["146b1873b0b6228e"],["bf5631cb.fc977"]]},{"id":"f522e33e.0e3b2","type":"switch","z":"d3ff7562.eebf38","name":"single/double tap?","property":"payload.event.event","propertyType":"msg","rules":[{"t":"eq","v":"1002","vt":"str"},{"t":"eq","v":"1004","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":570,"y":1060,"wires":[["26e097f9.02b1f8","23eb49fc.0e9116","a99e36e6.259cf8","be42c9c7.09d818"],[]],"outputLabels":["single tap","double tap"]},{"id":"26e097f9.02b1f8","type":"api-call-service","z":"d3ff7562.eebf38","name":"Turn all lights off","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"all","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":820,"y":960,"wires":[[]]},{"id":"23eb49fc.0e9116","type":"api-call-service","z":"d3ff7562.eebf38","name":"Pause all media players","server":"78fe396.483dac8","version":"1","service_domain":"media_player","service":"turn_off","entityId":"all","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":850,"y":1000,"wires":[[]]},{"id":"a99e36e6.259cf8","type":"api-call-service","z":"d3ff7562.eebf38","name":"Kitchen Utilities OFF","server":"78fe396.483dac8","version":"1","service_domain":"switch","service":"turn_off","entityId":"switch.mystromkitchen","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":840,"y":1040,"wires":[[]]},{"id":"be42c9c7.09d818","type":"api-call-service","z":"d3ff7562.eebf38","name":"Turn Smart Garden Off","server":"78fe396.483dac8","version":1,"service_domain":"switch","service":"turn_off","entityId":"switch.mystromclickandgrow9, switch.mystromclickandgrow3","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":840,"y":1080,"wires":[[]]},{"id":"ec6465c1.af7418","type":"inject","z":"d3ff7562.eebf38","name":"Weekdays Morning Trigger","repeat":"","crontab":"30 08 * * 1,2,3,4,5","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":180,"y":1440,"wires":[[]]},{"id":"574d5403.197e3c","type":"inject","z":"d3ff7562.eebf38","name":"Weekend Morning Trigger","repeat":"","crontab":"30 08 * * 6,0","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":180,"y":1480,"wires":[[]]},{"id":"7d99138d.5057dc","type":"server-state-changed","z":"d3ff7562.eebf38","name":"Living Room Switch 4","server":"78fe396.483dac8","version":1,"entityidfilter":"binary_sensor.living_room_light_switch_4","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":160,"y":1700,"wires":[["8ca1d088.642c3"]]},{"id":"95624fc3.e74b5","type":"server-state-changed","z":"d3ff7562.eebf38","name":"Living Room Switch 2","server":"78fe396.483dac8","version":1,"entityidfilter":"binary_sensor.living_room_light_switch_2","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":160,"y":1760,"wires":[["57e90f82.0ddf3","5dfc6196.0a00c"]]},{"id":"8ca1d088.642c3","type":"api-call-service","z":"d3ff7562.eebf38","name":"Living Room Lights","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"light","service":"toggle","entityId":"light.living_room_light_group","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":410,"y":1700,"wires":[[]]},{"id":"858fb146.95725","type":"link out","z":"d3ff7562.eebf38","name":"Deconz Sympfonisk Output","links":["b2656b1.a12b498"],"x":495,"y":1100,"wires":[]},{"id":"e2c5b59.0ec7448","type":"api-call-service","z":"d3ff7562.eebf38","name":"Scene: Party","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"scene","service":"turn_on","entityId":"scene.party_colors","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":570,"y":2040,"wires":[[]]},{"id":"c796b0ce.bc729","type":"api-call-service","z":"d3ff7562.eebf38","name":"Scene: Warm","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"scene","service":"turn_on","entityId":"scene.warm_lights_everywhere","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":580,"y":2220,"wires":[[]]},{"id":"ed74742c.9bd0b8","type":"api-call-service","z":"d3ff7562.eebf38","name":"Scene: Cinema","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"scene","service":"turn_on","entityId":"scene.cinema","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":580,"y":1980,"wires":[[]]},{"id":"c1346b08.87caf8","type":"switch","z":"d3ff7562.eebf38","name":"Office Desk Switch","property":"payload.event.event","propertyType":"msg","rules":[{"t":"eq","v":"1002","vt":"str"},{"t":"eq","v":"1004","vt":"str"},{"t":"eq","v":"1005","vt":"str"},{"t":"eq","v":"1006","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":550,"y":1180,"wires":[["41f7b432.89f46c","93eec4bf.cb84c8","0819b265e7f68eea"],["93eec4bf.cb84c8","917e19ba.a7ffe8","0819b265e7f68eea"],["874971d7.99a2f","93eec4bf.cb84c8","0819b265e7f68eea"],["0819b265e7f68eea"]],"outputLabels":["1 press","2 press","3 press","4 press"]},{"id":"41f7b432.89f46c","type":"api-call-service","z":"d3ff7562.eebf38","name":"Livingroom Blinds 30%","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"cover","service":"set_cover_position","entityId":"cover.livingroom","data":"{\"position\":\"30\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":830,"y":1160,"wires":[[]]},{"id":"93eec4bf.cb84c8","type":"api-call-service","z":"d3ff7562.eebf38","name":"Loggia Blinds open","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"cover","service":"open_cover","entityId":"cover.loggia","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":810,"y":1200,"wires":[[]]},{"id":"917e19ba.a7ffe8","type":"api-call-service","z":"d3ff7562.eebf38","name":"Livingroom Blinds 40%","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"cover","service":"set_cover_position","entityId":"cover.livingroom","data":"{\"position\":\"40\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":830,"y":1240,"wires":[[]]},{"id":"874971d7.99a2f","type":"api-call-service","z":"d3ff7562.eebf38","name":"Livingroom Blinds open","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"cover","service":"open_cover","entityId":"cover.livingroom","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":830,"y":1280,"wires":[[]]},{"id":"d88a154c.06ec28","type":"ha-entity","z":"d3ff7562.eebf38","name":"Cinema Scene","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":2,"entityType":"switch","config":[{"property":"name","value":"Cinema Scene"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:popcorn"},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":140,"y":1980,"wires":[[],[]]},{"id":"185a7a86.a7d725","type":"ha-entity","z":"d3ff7562.eebf38","name":"Party Scene","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":2,"entityType":"switch","config":[{"property":"name","value":"Party Scene"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:party-popper"},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":150,"y":2040,"wires":[[],[]]},{"id":"4185b4c8.a5f16c","type":"ha-entity","z":"d3ff7562.eebf38","name":"Loggia Scene","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":2,"entityType":"switch","config":[{"property":"name","value":"Loggia Scene"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:torch"},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":140,"y":2100,"wires":[[],[]]},{"id":"175028fa.79cc47","type":"ha-entity","z":"d3ff7562.eebf38","name":"Fullbright Scene","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":2,"entityType":"switch","config":[{"property":"name","value":"Fullbright Scene"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:lightbulb-on-outline"},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":140,"y":2220,"wires":[[],[]]},{"id":"7066001c.41d4a","type":"ha-entity","z":"d3ff7562.eebf38","name":"Livingroom Scene","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":2,"entityType":"switch","config":[{"property":"name","value":"Livingroom Scene"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:sofa-outline"},{"property":"unit_of_measurement","value":""}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":130,"y":2160,"wires":[[],[]]},{"id":"9e12210c.5213b","type":"server-state-changed","z":"d3ff7562.eebf38","name":"Cinema Scene on","server":"78fe396.483dac8","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.cinema_scene","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":330,"y":1980,"wires":[["ed74742c.9bd0b8","5dfc6196.0a00c"],[]]},{"id":"ac80648a.57b0e8","type":"server-state-changed","z":"d3ff7562.eebf38","name":"Party Scene on","server":"78fe396.483dac8","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.party_scene","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":320,"y":2040,"wires":[["e2c5b59.0ec7448","5dfc6196.0a00c"],[]]},{"id":"5dfc6196.0a00c","type":"function","z":"d3ff7562.eebf38","name":"select other scenes","func":"var scenes = [\"switch.cinema_scene\", \n\"switch.party_scene\", \n\"switch.loggia_scene\",\n\"switch.livingroom_scene\",\n\"switch.fullbright_scene\"];\n\n//Remove activated scene from list\nfilteredScenes = scenes.filter(e => e !== msg.topic);\n\nmsg.payload = filteredScenes.join(', ');\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":590,"y":1920,"wires":[["8030545d.d0f558"]]},{"id":"8030545d.d0f558","type":"api-call-service","z":"d3ff7562.eebf38","name":"Turn Off","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"","data":"{\"entity_id\":\"{{payload}}\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":780,"y":1920,"wires":[[]]},{"id":"9edf57a6.f42298","type":"server-state-changed","z":"d3ff7562.eebf38","name":"Fullbright scene on","server":"78fe396.483dac8","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.fullbright_scene","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":330,"y":2220,"wires":[["c796b0ce.bc729","5dfc6196.0a00c"],[]]},{"id":"544b2cf5.6d5c24","type":"server-state-changed","z":"d3ff7562.eebf38","name":"Lights off triggered","server":"78fe396.483dac8","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_button.lights_off","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":330,"y":1920,"wires":[["5dfc6196.0a00c","057d4eecb960a540"]]},{"id":"57e90f82.0ddf3","type":"api-call-service","z":"d3ff7562.eebf38","name":"Scene: Livingroom","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"scene","service":"turn_on","entityId":"scene.livingroom","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":590,"y":2160,"wires":[[]]},{"id":"a2c3da39.362ae8","type":"api-call-service","z":"d3ff7562.eebf38","name":"Scene: Loggia","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"scene","service":"turn_on","entityId":"scene.loggia","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":580,"y":2100,"wires":[[]]},{"id":"f45140da.38953","type":"server-state-changed","z":"d3ff7562.eebf38","name":"Livingroom Scene on","server":"78fe396.483dac8","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.livingroom_scene","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":340,"y":2160,"wires":[["57e90f82.0ddf3","5dfc6196.0a00c"],[]]},{"id":"4a3b5055.9cc8a","type":"server-state-changed","z":"d3ff7562.eebf38","name":"Loggia Scene on","server":"78fe396.483dac8","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.loggia_scene","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":320,"y":2100,"wires":[["a2c3da39.362ae8","5dfc6196.0a00c"],[]]},{"id":"888b893a.9d25c8","type":"inject","z":"d3ff7562.eebf38","name":"Evening Trigger","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"00 22 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":2300,"wires":[["ced6a7ca.c9fc68"]]},{"id":"ced6a7ca.c9fc68","type":"api-call-service","z":"d3ff7562.eebf38","name":"Click & Grow OFF","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.mystromclickandgrow3, light.pixar_shelly","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":390,"y":2300,"wires":[[]]},{"id":"bf5631cb.fc977","type":"link out","z":"d3ff7562.eebf38","name":"Loggia Lightswitch Input","mode":"link","links":["2747e3b8.697dfc"],"x":545,"y":1580,"wires":[]},{"id":"3b9b5a81.952146","type":"api-call-service","z":"d3ff7562.eebf38","name":"Telegram Log","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"telegram_bot","service":"send_message","entityId":"","data":"{\"message\":\"Not launching Roomba because it's disabled\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":560,"y":100,"wires":[[]]},{"id":"d2922fa7.4bc15","type":"api-current-state","z":"d3ff7562.eebf38","name":"get vacuum robot settings","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_select.automatic_cleaning","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":380,"y":20,"wires":[["c14e556a.23bb88"]]},{"id":"c14e556a.23bb88","type":"switch","z":"d3ff7562.eebf38","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"enabled (always)","vt":"str"},{"t":"eq","v":"enabled (occupancy-check)","vt":"str"},{"t":"eq","v":"disabled","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":350,"y":80,"wires":[["74556465.5e1fac"],["b816139a.b3f9e"],["3b9b5a81.952146"]]},{"id":"057d4eecb960a540","type":"api-call-service","z":"d3ff7562.eebf38","name":"Turn all lights off","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"all","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":580,"y":1880,"wires":[[]]},{"id":"0819b265e7f68eea","type":"api-call-service","z":"d3ff7562.eebf38","name":"Energy Save Mode Off","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.energy_save_mode","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":820,"y":1360,"wires":[[]]},{"id":"146b1873b0b6228e","type":"switch","z":"d3ff7562.eebf38","name":"TV Switch","property":"payload.event.event","propertyType":"msg","rules":[{"t":"eq","v":"1002","vt":"str"},{"t":"eq","v":"1004","vt":"str"},{"t":"eq","v":"1005","vt":"str"},{"t":"eq","v":"1006","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":600,"y":1480,"wires":[["204e0e41c370e6a7","2ad1f92154b1c129"],["09b67e86bd8437b8"],[],[]],"outputLabels":["1 press","2 press","3 press","4 press"]},{"id":"254a6a251f602de5","type":"time-range-switch","z":"d3ff7562.eebf38","name":"","lat":"47.38089","lon":"8.48364","startTime":"19:00","endTime":"22:00","startOffset":0,"endOffset":0,"x":300,"y":180,"wires":[["3e0b850.2c5117c"],[]]},{"id":"9fa3f1dbd462f301","type":"time-range-switch","z":"d3ff7562.eebf38","name":"","lat":"47.38089","lon":"8.48364","startTime":"05:30","endTime":"07:00","startOffset":0,"endOffset":0,"x":300,"y":220,"wires":[["3e0b850.2c5117c"],[]]},{"id":"204e0e41c370e6a7","type":"api-call-service","z":"d3ff7562.eebf38","name":"Cinema Switch ON","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.cinema_scene","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":790,"y":1420,"wires":[[]]},{"id":"2ad1f92154b1c129","type":"api-call-service","z":"d3ff7562.eebf38","name":"TV Switch ON","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.tv_energy","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":780,"y":1460,"wires":[[]]},{"id":"09b67e86bd8437b8","type":"api-call-service","z":"d3ff7562.eebf38","name":"TV Switch ON","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.tv_energy","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":780,"y":1500,"wires":[[]]},{"id":"50995fb88ff8961c","type":"api-call-service","z":"d3ff7562.eebf38","name":"Play","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"media_player","service":"play_media","entityId":"media_player.m5stack_atom_echo","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":290,"y":2440,"wires":[[]]},{"id":"f4e598282e682b89","type":"api-call-service","z":"d3ff7562.eebf38","name":"Spotify: Schwizerd√ºtsch","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"spotcast","service":"start","entityId":"media_player.m5stack_atom_echo","data":"{\"uri\":\"spotify:playlist:1sNB7DzHbHYS6rNVOfa4jP\",\"shuffle\":true}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":290,"y":2380,"wires":[[]]},{"id":"5b03e1a3.813c6","type":"http request","z":"7d4c9938.2a0338","name":"Netflix","method":"POST","ret":"txt","paytoqs":"ignore","url":"http://192.168.178.20:8080/ws/app/Netflix","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":1150,"y":380,"wires":[["9e4938a1.a731b8","f6d56ec6.908fa"]]},{"id":"140749a4.0fed96","type":"api-call-service","z":"7d4c9938.2a0338","name":"TV ON","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"remote","service":"send_command","entityId":"remote.harmony_hub","data":"{\"device\":\"Samsung TV\",\"command\":[\"PowerOn\"],\"delay_secs\":0.6}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":820,"y":310,"wires":[["125d603.261a1a"]]},{"id":"761bf111.d7e1d","type":"api-current-state","z":"7d4c9938.2a0338","name":"Samsung TV","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"entity_id":"binary_sensor.samsung_tv","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":620,"y":420,"wires":[["2d8645dd.cbd9fa"]]},{"id":"2d8645dd.cbd9fa","type":"switch","z":"7d4c9938.2a0338","name":"is on?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"off","vt":"str"},{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":680,"y":340,"wires":[["140749a4.0fed96"],["c0d4c663.216208"]]},{"id":"125d603.261a1a","type":"trigger","z":"7d4c9938.2a0338","name":"wait 3s","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"3","extend":false,"units":"s","reset":"","bytopic":"all","outputs":1,"x":950,"y":310,"wires":[["c0d4c663.216208"]]},{"id":"7ed0d1c0.fdf53","type":"http request","z":"7d4c9938.2a0338","name":"Home","method":"POST","ret":"obj","paytoqs":"ignore","url":"http://192.168.178.20:8080/ws/app/YouTube","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":1070,"y":450,"wires":[["ca9d6a57.4323b8"]]},{"id":"ca9d6a57.4323b8","type":"trigger","z":"7d4c9938.2a0338","name":"wait 2s","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"2","extend":false,"units":"s","reset":"","bytopic":"all","outputs":1,"x":1200,"y":450,"wires":[["a5d34e3d.aef63"]]},{"id":"a5d34e3d.aef63","type":"api-call-service","z":"7d4c9938.2a0338","name":"Switch to Zattoo","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"remote","service":"send_command","entityId":"","data":"{\"device\":\"Samsung TV\",\"command\":[\"SmartHub\",\"DirectionRight\",\"Select\"],\"delay_secs\":1}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1360,"y":450,"wires":[["c2f374af.75b428"]]},{"id":"f4c935e3.63f598","type":"http request","z":"7d4c9938.2a0338","name":"Zattoo","method":"GET","ret":"txt","paytoqs":false,"url":"http://192.168.178.20:8080/ws/app/Zattoo","tls":"","persist":false,"proxy":"","authType":"","x":810,"y":480,"wires":[["dcfdd847.af5008"]]},{"id":"dcfdd847.af5008","type":"switch","z":"7d4c9938.2a0338","name":"is active","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"<state>stopped</state>","vt":"str"},{"t":"cont","v":"<state>running</state>","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":940,"y":480,"wires":[["7ed0d1c0.fdf53"],["c2f374af.75b428"]]},{"id":"f501d8cb.053688","type":"change","z":"7d4c9938.2a0338","name":"BBC World News","rules":[{"t":"set","p":"tvchannel","pt":"msg","to":"1","tot":"str"},{"t":"set","p":"app","pt":"msg","to":"zattoo","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":320,"wires":[["761bf111.d7e1d"]]},{"id":"a638bfe8.496cd","type":"api-call-service","z":"7d4c9938.2a0338","name":"Switch Channel","server":"78fe396.483dac8","service_domain":"remote","service":"send_command","data":"","mergecontext":"","output_location":"payload","output_location_type":"msg","x":1020,"y":570,"wires":[[]]},{"id":"88ba2f44.63fba","type":"function","z":"7d4c9938.2a0338","name":"Channel Msg","func":"var command = msg.tvchannel\n\nmsg.payload =\n    {\n        \"domain\":\"remote\",\n        \"service\":\"send_command\",\n        \"data\":{\n            \"device\": \"Samsung TV\",\n            \"command\": [\n                command\n            ],\n            \"delay_secs\": 1\n        }\n    }\n\nreturn msg;","outputs":1,"noerr":0,"x":840,"y":570,"wires":[["a638bfe8.496cd"]]},{"id":"c2f374af.75b428","type":"change","z":"7d4c9938.2a0338","name":"Channel Manager","rules":[],"action":"","property":"","from":"","to":"","reg":false,"x":1140,"y":500,"wires":[["88ba2f44.63fba","613b88ed.b9ef28"]]},{"id":"c0d4c663.216208","type":"switch","z":"7d4c9938.2a0338","name":"Chosen app?","property":"app","propertyType":"msg","rules":[{"t":"eq","v":"youtube","vt":"str"},{"t":"eq","v":"netflix","vt":"str"},{"t":"eq","v":"zattoo","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":890,"y":380,"wires":[["c15b7ba5.953c18"],["5b03e1a3.813c6"],["f4c935e3.63f598"]]},{"id":"c15b7ba5.953c18","type":"http request","z":"7d4c9938.2a0338","name":"YouTube","method":"POST","ret":"txt","paytoqs":false,"url":"http://192.168.178.20:8080/ws/app/YouTube","tls":"","persist":false,"proxy":"","authType":"","x":1160,"y":340,"wires":[[]]},{"id":"613b88ed.b9ef28","type":"api-call-service","z":"7d4c9938.2a0338","name":"Reset Channel Group","server":"78fe396.483dac8","version":0,"service_domain":"switch","service":"turn_off","data":"{\"entity_id\":\"group.tv_channels\"}","mergecontext":"","output_location":"payload","output_location_type":"msg","x":1380,"y":510,"wires":[[]]},{"id":"b25553b2.1f43","type":"switch","z":"7d4c9938.2a0338","name":"turn on?","property":"payload.event.tv_action","propertyType":"msg","rules":[{"t":"eq","v":"tv_off","vt":"str"},{"t":"eq","v":"tv_on","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":330,"y":260,"wires":[["775f25a7.89c9ec"],["f501d8cb.053688"]]},{"id":"775f25a7.89c9ec","type":"api-call-service","z":"7d4c9938.2a0338","name":"Turn TV OFF","server":"78fe396.483dac8","version":"1","debugenabled":false,"service_domain":"remote","service":"send_command","entityId":"remote.harmony_hub","data":"{\"device\":\"Samsung TV\",\"command\":[\"PowerOff\"],\"delay_secs\":0.6}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":560,"y":260,"wires":[[]]},{"id":"1a982428.5111cc","type":"link in","z":"7d4c9938.2a0338","name":"IFTTT TV Events","links":["3284503b.0166a"],"x":105,"y":500,"wires":[["51b2f8ef.898868"]],"outputLabels":["TV Events"]},{"id":"2400d95c.a0bbc6","type":"change","z":"7d4c9938.2a0338","name":"Next Channel","rules":[{"t":"set","p":"tvchannel","pt":"msg","to":"ChannelUp","tot":"str"},{"t":"set","p":"app","pt":"msg","to":"zattoo","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":480,"wires":[["761bf111.d7e1d"]]},{"id":"7e74e960.187558","type":"change","z":"7d4c9938.2a0338","name":"Last Channel","rules":[{"t":"set","p":"tvchannel","pt":"msg","to":"ChannelDown","tot":"str"},{"t":"set","p":"app","pt":"msg","to":"zattoo","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":520,"wires":[["761bf111.d7e1d"]]},{"id":"51b2f8ef.898868","type":"switch","z":"7d4c9938.2a0338","name":"Cmd Interpreter","property":"payload.event.tv","propertyType":"msg","rules":[{"t":"eq","v":"nextchannel","vt":"str"},{"t":"eq","v":"lastchannel","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":240,"y":500,"wires":[["2400d95c.a0bbc6"],["7e74e960.187558"]]},{"id":"8d3b36f.f86ddc8","type":"server-events","z":"7d4c9938.2a0338","name":"TV On/Off Events","server":"78fe396.483dac8","event_type":"ACTION_TV_STATE_CHANGE","x":130,"y":260,"wires":[["b25553b2.1f43"]]},{"id":"9e4938a1.a731b8","type":"api-call-service","z":"7d4c9938.2a0338","name":"Netflix Red Tap","server":"78fe396.483dac8","service_domain":"light","service":"turn_on","data":"{\"entity_id\":\"light.tv_lightstrip\",\"rgb_color\":[255,43,0],\"transition\":10,\"brightness\":241}","mergecontext":"","output_location":"payload","output_location_type":"msg","x":1370,"y":340,"wires":[[]]},{"id":"f6d56ec6.908fa","type":"trigger","z":"7d4c9938.2a0338","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"20","extend":false,"units":"s","reset":"","bytopic":"all","outputs":1,"x":1360,"y":380,"wires":[["25fa21c2.ca683e"]]},{"id":"25fa21c2.ca683e","type":"api-call-service","z":"7d4c9938.2a0338","name":"Turn light off","server":"78fe396.483dac8","service_domain":"light","service":"turn_off","data":"{\"entity_id\":\"light.tv_lightstrip\"}","mergecontext":"","output_location":"payload","output_location_type":"msg","x":1520,"y":380,"wires":[[]]},{"id":"44e265e4.fe5dbc","type":"server-state-changed","z":"7d4c9938.2a0338","name":"TV Channel Input","server":"78fe396.483dac8","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_select.tv_channels","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":160,"y":680,"wires":[["c26380c9.3d0be"]]},{"id":"c26380c9.3d0be","type":"switch","z":"7d4c9938.2a0338","name":"Cmd Interpreter","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Netflix","vt":"str"},{"t":"eq","v":"Spotify","vt":"str"},{"t":"eq","v":"YouTube","vt":"str"},{"t":"eq","v":"Apple TV","vt":"str"},{"t":"eq","v":"Google","vt":"str"},{"t":"eq","v":"Playstation","vt":"str"},{"t":"eq","v":"Nintendo Switch","vt":"str"},{"t":"eq","v":"Wallpaper","vt":"str"}],"checkall":"true","repair":false,"outputs":8,"x":360,"y":680,"wires":[["82207da4.02ffb"],["ebbe3548.911ea8"],["aba3e24a.8178f"],["eb8a7ab8.eb9688"],["6a9fb9e7.02e778"],["210bbf3e.19945"],["36e4f0c4.5bbcc"],["e6b530eb.56c74"]]},{"id":"aba3e24a.8178f","type":"http request","z":"7d4c9938.2a0338","name":"YouTube","method":"POST","ret":"txt","paytoqs":false,"url":"http://192.168.178.20:8080/ws/app/YouTube","tls":"","persist":false,"proxy":"","authType":"","x":580,"y":680,"wires":[[]]},{"id":"82207da4.02ffb","type":"http request","z":"7d4c9938.2a0338","name":"Netflix","method":"POST","ret":"txt","paytoqs":"ignore","url":"http://192.168.178.20:8080/ws/app/Netflix","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"x":570,"y":600,"wires":[[]]},{"id":"2af6559.c6e05aa","type":"api-call-service","z":"7d4c9938.2a0338","name":"Spotify","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"remote","service":"send_command","entityId":"remote.harmony_hub","data":"{\"device\":\"Samsung TV\",\"command\":[\"SmartHub\",\"DirectionRight\",\"Select\"],\"delay_secs\":1}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":840,"y":640,"wires":[[]]},{"id":"ebbe3548.911ea8","type":"http request","z":"7d4c9938.2a0338","name":"Home","method":"POST","ret":"txt","paytoqs":"ignore","url":"http://192.168.178.20:8080/ws/app/YouTube","tls":"","persist":false,"proxy":"","authType":"","x":570,"y":640,"wires":[["f5eba7c6.993038"]]},{"id":"c622196f.1fd878","type":"api-call-service","z":"7d4c9938.2a0338","name":"HDMI 1","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"remote","service":"send_command","entityId":"remote.harmony_hub","data":"{\"device\":\"Samsung TV\",\"command\":[\"InputHdmi1\"],\"delay_secs\":1}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":740,"y":700,"wires":[[]]},{"id":"d68ab66.d666748","type":"api-call-service","z":"7d4c9938.2a0338","name":"Apple TV ON","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"remote","service":"send_command","entityId":"remote.apple_tv","data":"{\"command\":[\"menu\"]}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":750,"y":740,"wires":[["ce4873e9.b2d69"]]},{"id":"6a9fb9e7.02e778","type":"api-call-service","z":"7d4c9938.2a0338","name":"HDMI 2","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"remote","service":"send_command","entityId":"remote.harmony_hub","data":"{\"device\":\"Samsung TV\",\"command\":[\"InputHdmi2\"],\"delay_secs\":1}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":580,"y":760,"wires":[[]]},{"id":"210bbf3e.19945","type":"api-call-service","z":"7d4c9938.2a0338","name":"HDMI 3","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"remote","service":"send_command","entityId":"remote.harmony_hub","data":"{\"device\":\"Samsung TV\",\"command\":[\"InputHdmi3\"],\"delay_secs\":1}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":580,"y":800,"wires":[[]]},{"id":"36e4f0c4.5bbcc","type":"api-call-service","z":"7d4c9938.2a0338","name":"HDMI 4","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"remote","service":"send_command","entityId":"remote.harmony_hub","data":"{\"device\":\"Samsung TV\",\"command\":[\"InputHdmi4\"],\"delay_secs\":1}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":580,"y":840,"wires":[[]]},{"id":"f5eba7c6.993038","type":"trigger","z":"7d4c9938.2a0338","name":"wait 2s","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"2","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":700,"y":640,"wires":[["2af6559.c6e05aa"]]},{"id":"f6a0263a.6a51a8","type":"api-call-service","z":"7d4c9938.2a0338","name":"HDMI 1","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"remote","service":"send_command","entityId":"remote.harmony_hub","data":"{\"device\":\"Samsung TV\",\"command\":[\"InputHdmi1\"],\"delay_secs\":1}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":740,"y":860,"wires":[[]]},{"id":"888e8838.970288","type":"api-call-service","z":"7d4c9938.2a0338","name":"Apple TV Wallpaper","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"remote","service":"send_command","entityId":"remote.apple_tv","data":"{\"command\":[\"menu\"]}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":770,"y":900,"wires":[["4cc12ade.fb8b14"]]},{"id":"e6b530eb.56c74","type":"change","z":"7d4c9938.2a0338","name":"Apple TV","rules":[],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":880,"wires":[["f6a0263a.6a51a8","888e8838.970288"]]},{"id":"eb8a7ab8.eb9688","type":"change","z":"7d4c9938.2a0338","name":"Apple TV","rules":[],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":720,"wires":[["c622196f.1fd878","d68ab66.d666748"]]},{"id":"950a73cb.42b4d","type":"api-call-service","z":"7d4c9938.2a0338","name":"Apple TV Wallpaper","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"remote","service":"send_command","entityId":"remote.apple_tv","data":"{\"command\":[\"top_menu\"]}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1030,"y":900,"wires":[["c0e1daa5.464ce8"]]},{"id":"7a03096b.758ef8","type":"api-call-service","z":"7d4c9938.2a0338","name":"Apple TV Wallpaper","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"remote","service":"send_command","entityId":"remote.apple_tv","data":"{\"command\":[\"menu\"]}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1290,"y":900,"wires":[[]]},{"id":"4cc12ade.fb8b14","type":"trigger","z":"7d4c9938.2a0338","name":"wait 2s","op1":"","op2":"1","op1type":"nul","op2type":"num","duration":"2","extend":false,"units":"s","reset":"","bytopic":"all","outputs":1,"x":900,"y":860,"wires":[["950a73cb.42b4d"]]},{"id":"ce4873e9.b2d69","type":"trigger","z":"7d4c9938.2a0338","name":"wait 2s","op1":"","op2":"1","op1type":"nul","op2type":"num","duration":"1","extend":false,"units":"s","reset":"","bytopic":"all","outputs":1,"x":900,"y":740,"wires":[["642767b2.727cc8"]]},{"id":"642767b2.727cc8","type":"api-call-service","z":"7d4c9938.2a0338","name":"Apple TV ON","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"remote","service":"send_command","entityId":"remote.apple_tv","data":"{\"command\":[\"top_menu\"]}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1050,"y":740,"wires":[[]]},{"id":"c0e1daa5.464ce8","type":"trigger","z":"7d4c9938.2a0338","name":"wait 2s","op1":"","op2":"1","op1type":"nul","op2type":"num","duration":"2","extend":false,"units":"s","reset":"","bytopic":"all","outputs":1,"x":1160,"y":860,"wires":[["7a03096b.758ef8"]]},{"id":"398bef58.0823b","type":"server-events","z":"7d4c9938.2a0338","name":"Apple TV Remote","server":"78fe396.483dac8","event_type":"homekit_tv_remote_key_pressed","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"x":140,"y":1120,"wires":[["2ee572cf.c3ab0e"]]},{"id":"5faa8fc8.def59","type":"api-call-service","z":"7d4c9938.2a0338","name":"Arrow Left","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"remote","service":"send_command","entityId":"remote.harmony_hub","data":"{\"device\":\"Samsung TV\",\"command\":[\"DirectionLeft\"]}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":770,"y":1000,"wires":[[]]},{"id":"15f6fb28.5325e5","type":"switch","z":"7d4c9938.2a0338","name":"Cmd Interpreter","property":"payload.event.key_name","propertyType":"msg","rules":[{"t":"eq","v":"arrow_left","vt":"str"},{"t":"eq","v":"arrow_right","vt":"str"},{"t":"eq","v":"arrow_up","vt":"str"},{"t":"eq","v":"arrow_down","vt":"str"},{"t":"eq","v":"back","vt":"str"},{"t":"eq","v":"information","vt":"str"},{"t":"eq","v":"select","vt":"str"}],"checkall":"true","repair":false,"outputs":7,"x":500,"y":1120,"wires":[["5faa8fc8.def59"],["8d53a9b9.0092a8"],["31ccec9c.f8bf24"],["54457a1a.1d8364"],["15b52dd8.16eab2"],["afc9e035.0f08b"],["c6b13a5c.b54578"]]},{"id":"2ee572cf.c3ab0e","type":"switch","z":"7d4c9938.2a0338","name":"is Samsung TV?","property":"payload.entity_id","propertyType":"msg","rules":[{"t":"eq","v":"media_player.samsung_tv","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":320,"y":1120,"wires":[["15f6fb28.5325e5"]]},{"id":"8d53a9b9.0092a8","type":"api-call-service","z":"7d4c9938.2a0338","name":"Arrow Right","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"remote","service":"send_command","entityId":"remote.harmony_hub","data":"{\"device\":\"Samsung TV\",\"command\":[\"DirectionRight\"]}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":770,"y":1040,"wires":[[]]},{"id":"31ccec9c.f8bf24","type":"api-call-service","z":"7d4c9938.2a0338","name":"Arrow Up","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"remote","service":"send_command","entityId":"remote.harmony_hub","data":"{\"device\":\"Samsung TV\",\"command\":[\"DirectionUp\"]}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":760,"y":1080,"wires":[[]]},{"id":"54457a1a.1d8364","type":"api-call-service","z":"7d4c9938.2a0338","name":"Arrow Down","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"remote","service":"send_command","entityId":"remote.harmony_hub","data":"{\"device\":\"Samsung TV\",\"command\":[\"DirectionDown\"]}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":770,"y":1120,"wires":[[]]},{"id":"c6b13a5c.b54578","type":"api-call-service","z":"7d4c9938.2a0338","name":"Select","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"remote","service":"send_command","entityId":"remote.harmony_hub","data":"{\"device\":\"Samsung TV\",\"command\":[\"Select\"]}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":750,"y":1240,"wires":[[]]},{"id":"afc9e035.0f08b","type":"api-call-service","z":"7d4c9938.2a0338","name":"Smart Hub","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"remote","service":"send_command","entityId":"remote.harmony_hub","data":"{\"device\":\"Samsung TV\",\"command\":[\"SmartHub\"]}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":770,"y":1200,"wires":[[]]},{"id":"15b52dd8.16eab2","type":"api-call-service","z":"7d4c9938.2a0338","name":"Back","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"remote","service":"send_command","entityId":"remote.harmony_hub","data":"{\"device\":\"Samsung TV\",\"command\":[\"Return\"]}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":750,"y":1160,"wires":[[]]},{"id":"b2656b1.a12b498","type":"link in","z":"7d4c9938.2a0338","name":"Deconz Symfonisk Input","links":["858fb146.95725"],"x":55,"y":1440,"wires":[["cf7d2d40.c7d13"]]},{"id":"cf7d2d40.c7d13","type":"switch","z":"7d4c9938.2a0338","name":"Symfonisk Switch Actions","property":"payload.event.event","propertyType":"msg","rules":[{"t":"eq","v":"2001","vt":"str"},{"t":"eq","v":"2003","vt":"str"},{"t":"eq","v":"1002","vt":"str"},{"t":"eq","v":"1004","vt":"str"},{"t":"eq","v":"1005","vt":"str"},{"t":"eq","v":"3001","vt":"str"},{"t":"eq","v":"3003","vt":"str"}],"checkall":"true","repair":false,"outputs":7,"x":230,"y":1440,"wires":[["27ecd9cb.24afd6"],[],["1abc8834.6bacb8"],["98e9af69.efe0a"],[],["d21b50a8.04e38"],[]],"outputLabels":["turn right","","","","","turn left",""]},{"id":"426753c8.9587cc","type":"api-call-service","z":"7d4c9938.2a0338","name":"Volume up by 0.05","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"media_player","service":"volume_set","entityId":"media_player.everywhere","data":"{\t   \"volume_level\": data.attributes.volume_level + 0.05\t}","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":750,"y":1400,"wires":[[]]},{"id":"27ecd9cb.24afd6","type":"api-current-state","z":"7d4c9938.2a0338","name":"get volume info","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"media_player.everywhere","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":520,"y":1400,"wires":[["426753c8.9587cc"]]},{"id":"bd5054c0.e960a8","type":"api-call-service","z":"7d4c9938.2a0338","name":"Volume down by 0.05","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"media_player","service":"volume_set","entityId":"media_player.everywhere","data":"{\t   \"volume_level\": data.attributes.volume_level - 0.05\t}","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":true,"x":760,"y":1520,"wires":[[]]},{"id":"d21b50a8.04e38","type":"api-current-state","z":"7d4c9938.2a0338","name":"get volume info","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"media_player.everywhere","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":520,"y":1520,"wires":[["bd5054c0.e960a8"]]},{"id":"1abc8834.6bacb8","type":"api-call-service","z":"7d4c9938.2a0338","name":"Play/Pause","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"media_player","service":"media_play_pause","entityId":"media_player.everywhere","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":510,"y":1440,"wires":[[]]},{"id":"98e9af69.efe0a","type":"api-call-service","z":"7d4c9938.2a0338","name":"Spotify: WestLink Lounge Playlist","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"spotcast","service":"start","entityId":"media_player.everywhere","data":"{\"uri\":\"spotify:playlist:440DwvrtJWWM3v0AgRSRNx\",\"shuffle\":true}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":580,"y":1480,"wires":[[]]},{"id":"2dbc954b.a9f16a","type":"trigger-state","z":"7d4c9938.2a0338","name":"Audio Channel changed","server":"78fe396.483dac8","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"input_select.audio_channel","entityidfiltertype":"exact","debugenabled":false,"constraints":[],"outputs":4,"customoutputs":[{"outputId":"k75947gjlwq","messageType":"default","messageValue":"","messageValueType":"json","comparatorPropertyType":"current_state","comparatorPropertyValue":"new_state.state","comparatorType":"is","comparatorValue":"Lounge"},{"outputId":"ei8fx5on32","messageType":"default","messageValue":"","messageValueType":"json","comparatorPropertyType":"current_state","comparatorPropertyValue":"new_state.state","comparatorType":"is","comparatorValue":"Energy Z√ºrich"}],"outputinitially":false,"state_type":"str","x":230,"y":1560,"wires":[[],[],["98e9af69.efe0a"],["19b452dd.bc0aed"]]},{"id":"19b452dd.bc0aed","type":"api-call-service","z":"7d4c9938.2a0338","name":"Play Energy Z√ºrich","server":"78fe396.483dac8","version":1,"service_domain":"media_player","service":"play_media","entityId":"media_player.everywhere","data":"{\"media_content_id\":\"https://energyzuerich.ice.infomaniak.ch/energyzuerich-high.mp3\",\"media_content_type\":\"music\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":670,"y":1580,"wires":[[]]},{"id":"a68fb114.2ee01","type":"server-state-changed","z":"7d4c9938.2a0338","name":"Living Room Switch 1","server":"78fe396.483dac8","version":1,"entityidfilter":"binary_sensor.living_room_light_switch_1","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":220,"y":1640,"wires":[["df233cc0.51de3"]]},{"id":"df233cc0.51de3","type":"api-current-state","z":"7d4c9938.2a0338","name":"is playing?","server":"78fe396.483dac8","version":1,"outputs":2,"halt_if":"playing","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"media_player.everywhere","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":410,"y":1640,"wires":[["cc57ed6c.2a60c"],["19b452dd.bc0aed"]]},{"id":"cc57ed6c.2a60c","type":"api-call-service","z":"7d4c9938.2a0338","name":"Stop playing","server":"78fe396.483dac8","version":1,"service_domain":"media_player","service":"media_stop","entityId":"media_player.everywhere","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":650,"y":1640,"wires":[[]]},{"id":"340426f4.0eab9a","type":"server-state-changed","z":"7d4c9938.2a0338","name":"Reset Audio","server":"78fe396.483dac8","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"script.reset_audio","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":190,"y":1700,"wires":[["c76d9562.9e7c28"]]},{"id":"5057fd94.5d0bc4","type":"api-call-service","z":"7d4c9938.2a0338","name":"select custom","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.audio_channel","data":"{\"option\":\"custom\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":540,"y":1700,"wires":[["ae420248.e86a6"]]},{"id":"ae420248.e86a6","type":"api-call-service","z":"7d4c9938.2a0338","name":"select current scene","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.audio_channel","data":"{\"option\":msg.payload}","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":740,"y":1700,"wires":[[]]},{"id":"c76d9562.9e7c28","type":"api-current-state","z":"7d4c9938.2a0338","name":"current channel","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_select.audio_channel","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":360,"y":1700,"wires":[["5057fd94.5d0bc4"]]},{"id":"fd59915e3f41618e","type":"trigger-state","z":"7d4c9938.2a0338","name":"TV Energy","server":"78fe396.483dac8","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"input_boolean.tv_energy","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"bool","comparatorValue":"true","propertyValue":"new_state.state"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"habool","x":110,"y":100,"wires":[["7607e25681417792"],["e8d4b0825af548d6"]],"outputLabels":["on","off"]},{"id":"7607e25681417792","type":"api-call-service","z":"7d4c9938.2a0338","name":"TV Utils ON","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.mystromtvutilities","data":"","dataType":"jsonata","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":290,"y":80,"wires":[["5df50d3219c22463"]]},{"id":"e8d4b0825af548d6","type":"api-call-service","z":"7d4c9938.2a0338","name":"TV Utils OFF","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.mystromtvutilities","data":"","dataType":"jsonata","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":290,"y":120,"wires":[[]]},{"id":"5df50d3219c22463","type":"trigger","z":"7d4c9938.2a0338","name":"wait 5s","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"5","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":440,"y":80,"wires":[["a8107342b1c366db"]]},{"id":"a8107342b1c366db","type":"api-call-service","z":"7d4c9938.2a0338","name":"TV ON","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"remote","service":"send_command","entityId":"remote.harmony_hub","data":"{\"device\":\"Samsung TV\",\"command\":[\"PowerOn\"],\"num_repeats\":20,\"delay_secs\":1}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":570,"y":80,"wires":[[]]},{"id":"fabad148.d1309","type":"subflow:27f43369.1137ec","z":"6e3c7fcf.e7591","name":"","env":[],"x":940,"y":60,"wires":[["49d07c78.1df8f4","88d97097.a8bec"],["88d97097.a8bec"]]},{"id":"88d97097.a8bec","type":"api-call-service","z":"6e3c7fcf.e7591","name":"Loggia Blinds OPEN","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"cover","service":"open_cover","entityId":"cover.loggia","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1220,"y":40,"wires":[[]]},{"id":"49d07c78.1df8f4","type":"api-call-service","z":"6e3c7fcf.e7591","name":"Living Room Blinds OPEN","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"cover","service":"open_cover","entityId":"cover.livingroom","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1230,"y":80,"wires":[[]]},{"id":"a644a327.cff02","type":"inject","z":"6e3c7fcf.e7591","name":"08:05","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"05 08 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":40,"wires":[["8a89dfc37fcd8fe5"]]},{"id":"da7bdcd9.ac5c7","type":"inject","z":"6e3c7fcf.e7591","name":"09:05","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"05 09 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":280,"wires":[["7623e789.a3b6d8"]]},{"id":"8531819f.10275","type":"inject","z":"6e3c7fcf.e7591","name":"13:05","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"05 13 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":320,"wires":[["7623e789.a3b6d8"]]},{"id":"7623e789.a3b6d8","type":"api-current-state","z":"6e3c7fcf.e7591","name":"check weather","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"weather.dark_sky","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":340,"y":320,"wires":[["72117e48.27d31"]]},{"id":"72117e48.27d31","type":"switch","z":"6e3c7fcf.e7591","name":"max temperature below 25¬∞C","property":"data.attributes.forecast[0].temperature","propertyType":"msg","rules":[{"t":"lt","v":"25","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":590,"y":320,"wires":[["8a89dfc37fcd8fe5"]]},{"id":"c56c06ff.6ee9a8","type":"inject","z":"6e3c7fcf.e7591","name":"17:00","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"00 17 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":200,"wires":[["8a89dfc37fcd8fe5"]]},{"id":"dba681ea.8d5ab","type":"link in","z":"6e3c7fcf.e7591","name":"Blinds Control Output","links":["71837a0e.668474"],"x":175,"y":360,"wires":[["7623e789.a3b6d8"]]},{"id":"8a89dfc37fcd8fe5","type":"api-current-state","z":"6e3c7fcf.e7591","name":"get blinds control","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_select.blind_control","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":390,"y":140,"wires":[["72474cec90321fa3"]]},{"id":"72474cec90321fa3","type":"switch","z":"6e3c7fcf.e7591","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"automatic (more sun)","vt":"str"},{"t":"eq","v":"automatic (no direct sun / afternoon)","vt":"str"},{"t":"eq","v":"manual","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":550,"y":140,"wires":[["fabad148.d1309"],["f48864b440537b5b"],[]]},{"id":"f48864b440537b5b","type":"time-range-switch","z":"6e3c7fcf.e7591","name":"","lat":"47.39148","lon":"8.49183","startTime":"14:00","endTime":"24:00","startOffset":0,"endOffset":0,"x":750,"y":140,"wires":[["fabad148.d1309"],[]]},{"id":"dacf6d3eca849c7a","type":"inject","z":"6e3c7fcf.e7591","name":"14:05","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"05 14 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":160,"wires":[["8a89dfc37fcd8fe5"]]},{"id":"5f20aad7013aa701","type":"inject","z":"6e3c7fcf.e7591","name":"09:05","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"05 09 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":80,"wires":[["8a89dfc37fcd8fe5"]]},{"id":"1fe6a55866dcc874","type":"inject","z":"6e3c7fcf.e7591","name":"10:05","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"05 10 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":120,"wires":[["8a89dfc37fcd8fe5"]]},{"id":"2747e3b8.697dfc","type":"link in","z":"5ecca76c.9de098","name":"Loggia Lightswitch Output","links":["bf5631cb.fc977"],"x":75,"y":160,"wires":[["439becce.6390b4"]]},{"id":"439becce.6390b4","type":"api-call-service","z":"5ecca76c.9de098","name":"Toggle Fairylights","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"light","service":"toggle","entityId":"light.loggia_fairy_lights","data":"","dataType":"jsonata","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":240,"y":160,"wires":[[]]},{"id":"1da3c18754c1c44d","type":"inject","z":"5ecca76c.9de098","name":"Every day at 08:00","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"00 08 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":320,"wires":[[]]},{"id":"82c5ae7549af2a7e","type":"api-call-service","z":"5ecca76c.9de098","name":"Water Plants ON","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.mystromservers","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":430,"y":320,"wires":[["2634bde19d0a7427"]]},{"id":"f05d0eb27c589cd0","type":"inject","z":"5ecca76c.9de098","name":"Every day at 16:00","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"00 16 * * 2,4,6,0","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":360,"wires":[[]]},{"id":"8606a22cded92476","type":"api-call-service","z":"5ecca76c.9de098","name":"Water Plants OFF","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.mystromservers","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":790,"y":320,"wires":[[]]},{"id":"2634bde19d0a7427","type":"trigger","z":"5ecca76c.9de098","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"5","extend":false,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":610,"y":320,"wires":[["8606a22cded92476"]]},{"id":"8d1170c346bea36a","type":"api-call-service","z":"5ecca76c.9de098","name":"Water Indoor Plants ON","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.pixar_shelly","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":450,"y":380,"wires":[["580954c1ba701993"]]},{"id":"580954c1ba701993","type":"trigger","z":"5ecca76c.9de098","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"2","extend":false,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":650,"y":380,"wires":[["30b17025d9d7863d"]]},{"id":"30b17025d9d7863d","type":"api-call-service","z":"5ecca76c.9de098","name":"Water Indoor Plants OFF","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.pixar_shelly","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":850,"y":380,"wires":[[]]},{"id":"c90ddae.bc85728","type":"api-call-service","z":"423c527d.a422fc","name":"minimal skylight","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.loggia_lightstrip","data":"{\"color_temp\":265,\"transition\":0,\"brightness\":1}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1010,"y":140,"wires":[["2593bf4d.0d296","a5b0d457.3326e8","aba733f2.5eead","bce81705.c72518","d5db3ab5.558558"]]},{"id":"2593bf4d.0d296","type":"trigger","z":"423c527d.a422fc","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"2","extend":false,"units":"s","reset":"","bytopic":"all","outputs":1,"x":1220,"y":140,"wires":[["f05e1143.564ec"]]},{"id":"dd928c2c.25ec7","type":"trigger","z":"423c527d.a422fc","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"30","extend":false,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1050,"y":420,"wires":[["516e2c4f.b76a44","2f77a7ef.884288","6f379880.04b2d8"]]},{"id":"1d2c5c55.314864","type":"subflow:27f43369.1137ec","z":"423c527d.a422fc","name":"","env":[],"x":730,"y":120,"wires":[["b17aca82.d1b688","7f06dd0f.f01a24","dd928c2c.25ec7"],["c90ddae.bc85728","dd928c2c.25ec7","c3fa5eb4.4cdf7"]]},{"id":"ed17765b.667578","type":"api-call-service","z":"423c527d.a422fc","name":"broadcast","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"tts","service":"cloud_say","entityId":"media_player.home_hub","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1290,"y":70,"wires":[[]]},{"id":"b17aca82.d1b688","type":"function","z":"423c527d.a422fc","name":"Alternate alarm: No occupancy","func":"var message = `\nGood morning! An alarm was scheduled, however I'm unable to detect apartment occupancy.\nIf you are in fact here, please make sure to connect to the wifi at your earliest convenience!\n`\n\nmsg.payload =\n    {\n        \"data\":\n        {\n            \"message\": message\n        }\n        \n    }\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1070,"y":70,"wires":[["ed17765b.667578"]]},{"id":"1cd30d6b.ce27e3","type":"server-state-changed","z":"423c527d.a422fc","name":"Bedroom Corridor Motion","server":"78fe396.483dac8","version":"1","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.bedroom_corridor_motion","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":1230,"y":1180,"wires":[["b07bb49f.c73718"]]},{"id":"f639a82d.37ec38","type":"api-call-service","z":"423c527d.a422fc","name":"Living Room Lights ON","server":"78fe396.483dac8","version":"1","debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.living_room","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1460,"y":1230,"wires":[[]]},{"id":"b07bb49f.c73718","type":"subflow:7fa54d71.595124","z":"423c527d.a422fc","name":"","x":1460,"y":1180,"wires":[["f639a82d.37ec38"]]},{"id":"2cb2daa8.4f01b6","type":"switch","z":"423c527d.a422fc","name":"has Kitchen Table Chair moved?","property":"payload.event.id","propertyType":"msg","rules":[{"t":"eq","v":"kitchen_table_chair","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":230,"y":940,"wires":[["420d6edf.8b25b"]]},{"id":"6a4f6bf8.7eef94","type":"api-current-state","z":"423c527d.a422fc","name":"Tasks due today","server":"78fe396.483dac8","outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"calendar.due_today","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":490,"y":770,"wires":[["acf96f3c.a1bed"]]},{"id":"983288ed.15bb08","type":"api-call-service","z":"423c527d.a422fc","name":"broadcast","server":"78fe396.483dac8","service_domain":"tts","service":"amazon_polly_say","data":"{\"entity_id\":\"media_player.home_hub\"}","mergecontext":"","output_location":"payload","output_location_type":"msg","x":1460,"y":840,"wires":[[]]},{"id":"aaeca2b1.7784c","type":"function","z":"423c527d.a422fc","name":"Has tasks","func":"\nvar allTasks = msg.data.attributes.all_tasks;\n\nvar taskText = \"\";\nallTasks.forEach(function (value) {\n  taskText += value + \", \"\n});\n\n//Replace characters that Amazon Polly can't deal with\ntaskText = taskText.replace(\"&\", \"and\")\n\nvar taskMessage = `\n    <p>You have ${allTasks.length} tasks scheduled for today.</p>\n    <p>These are the tasks: ${taskText}</p>\n`\n\nmsg.payload =\n    {\n        \"data\":\n        {\n            \"task_message\": taskMessage\n        }\n        \n    }\n\nreturn msg;","outputs":1,"noerr":0,"x":780,"y":820,"wires":[["b10f16fd.17ccd8"]]},{"id":"acf96f3c.a1bed","type":"switch","z":"423c527d.a422fc","name":"have tasks","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":530,"y":840,"wires":[["aaeca2b1.7784c","60db98cb.674b78","3f61b70b.f50308"],["7e512cf1.0b7384","60db98cb.674b78","3f61b70b.f50308"]],"outputLabels":["true","false"]},{"id":"7e512cf1.0b7384","type":"function","z":"423c527d.a422fc","name":"No tasks","func":"var taskMessage = `\n    <p>Good morning Theo.</p>\n    <p>You have no tasks scheduled for today.</p>\n`\n\nmsg.payload =\n    {\n        \"data\":\n        {\n            \"task_message\": taskMessage\n        }\n        \n    }\n\nreturn msg;","outputs":1,"noerr":0,"x":780,"y":860,"wires":[["b10f16fd.17ccd8"]]},{"id":"8ae2d0b1.0b119","type":"subflow:7fa54d71.595124","z":"423c527d.a422fc","name":"","x":190,"y":890,"wires":[["2cb2daa8.4f01b6"]]},{"id":"1615abe7.e45534","type":"api-call-service","z":"423c527d.a422fc","name":"Set Volume","server":"78fe396.483dac8","service_domain":"media_player","service":"volume_set","data":"{\"entity_id\":\"media_player.home_hub\",\"volume_level\":0.6}","mergecontext":"","output_location":"payload","output_location_type":"msg","x":310,"y":770,"wires":[["6a4f6bf8.7eef94"]]},{"id":"420d6edf.8b25b","type":"function","z":"423c527d.a422fc","name":"read tasks","func":"msg.read_tasks = global.get('read_tasks') || 'true';\nglobal.set('read_tasks', 'false');\nreturn msg;","outputs":1,"noerr":0,"x":130,"y":990,"wires":[["12fba262.ebc60e"]]},{"id":"12fba262.ebc60e","type":"switch","z":"423c527d.a422fc","name":"is set","property":"read_tasks","propertyType":"msg","rules":[{"t":"eq","v":"true","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":270,"y":990,"wires":[["1615abe7.e45534"]]},{"id":"545f5cab.1df934","type":"api-call-service","z":"423c527d.a422fc","name":"Telegram Log","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"telegram_bot","service":"send_message","entityId":"","data":"{\"message\":\"Alarm Clock triggered\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":720,"y":70,"wires":[[]]},{"id":"7f06dd0f.f01a24","type":"api-call-service","z":"423c527d.a422fc","name":"Telegram Log","server":"78fe396.483dac8","version":"1","debugenabled":false,"service_domain":"telegram_bot","service":"send_message","entityId":"","data":"{\"message\":\"Alarm Clock: No occupancy detected\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1020,"y":30,"wires":[[]]},{"id":"9a02837f.300ba","type":"inject","z":"423c527d.a422fc","name":"Current time","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"60","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":60,"wires":[["a75dacbf.0a632"]]},{"id":"a75dacbf.0a632","type":"api-current-state","z":"423c527d.a422fc","name":"alarm enabled?","server":"78fe396.483dac8","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is_not","override_topic":false,"entity_id":"input_boolean.alarm_clock_enabled","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":320,"y":60,"wires":[[],["7167885b.43cc38"]],"outputLabels":["false","true"]},{"id":"8a7dcc55.c68e3","type":"api-current-state","z":"423c527d.a422fc","name":"work week alarm","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is_not","override_topic":false,"entity_id":"input_datetime.work_week_alarm","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":300,"y":120,"wires":[["63d54b73.ce88b4"]],"outputLabels":["true"]},{"id":"73be7a52.f99c34","type":"api-current-state","z":"423c527d.a422fc","name":"weekend alarm","server":"78fe396.483dac8","version":"1","outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is_not","override_topic":false,"entity_id":"input_datetime.weekend_alarm","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":290,"y":160,"wires":[["63d54b73.ce88b4"]],"outputLabels":["true"]},{"id":"7167885b.43cc38","type":"weekday","z":"423c527d.a422fc","name":"is weekday?","sun":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":false,"x":120,"y":140,"wires":[["8a7dcc55.c68e3"],["73be7a52.f99c34"]],"outputLabels":["weekday","weekend"]},{"id":"63d54b73.ce88b4","type":"function","z":"423c527d.a422fc","name":"check alarm","func":"var now = new Date();\nvar hour = now.getHours();\nvar minute = now.getMinutes();\n\nif(hour.toString().length == 1) {\n    hour = '0'+hour;\n}\n\nif(minute.toString().length == 1) {\n    minute = '0'+minute;\n}\nvar currentTimeString = hour+':'+minute+':00';\n\nif(msg.data.state == currentTimeString){\n    msg.payload = true;\n} else {\n    msg.payload = false;\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":160,"wires":[["5148f55d.6b534c"]]},{"id":"5148f55d.6b534c","type":"switch","z":"423c527d.a422fc","name":"is triggered","property":"payload","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":510,"y":100,"wires":[["1d2c5c55.314864","545f5cab.1df934"]]},{"id":"17497a64.bc4de6","type":"function","z":"423c527d.a422fc","name":"Create message","func":"var taskMessage = msg.payload.data.task_message;\nvar tempOutside = msg.data.outdoor.state;\n\nvar message = `\n<speak>\n    <p>Good morning Theo.</p>\n    <p>Outside it is currently ${tempOutside}¬∞ warm.</p>\n    ${taskMessage}\n</speak>\n`\n\nmsg.payload =\n    {\n        \"data\":\n        {\n            \"message\": message\n        }\n        \n    }\n\nreturn msg;","outputs":1,"noerr":0,"x":1260,"y":840,"wires":[["983288ed.15bb08"]]},{"id":"f68df361.78477","type":"inject","z":"423c527d.a422fc","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":340,"y":820,"wires":[["6a4f6bf8.7eef94"]]},{"id":"60db98cb.674b78","type":"api-current-state","z":"423c527d.a422fc","name":"get outdoor temperature","server":"78fe396.483dac8","outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.outside_temperature","state_type":"num","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":730,"y":900,"wires":[["25ba811f.0989ae"]]},{"id":"25ba811f.0989ae","type":"change","z":"423c527d.a422fc","name":"data.outdoor","rules":[{"t":"move","p":"data","pt":"msg","to":"data.outdoor","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":900,"wires":[["b10f16fd.17ccd8"]]},{"id":"b10f16fd.17ccd8","type":"join","z":"423c527d.a422fc","name":"","mode":"custom","build":"merged","property":"data","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1090,"y":840,"wires":[["17497a64.bc4de6"]]},{"id":"3f61b70b.f50308","type":"api-current-state","z":"423c527d.a422fc","name":"get outdoor temperature","server":"78fe396.483dac8","outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sun.sun","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":730,"y":960,"wires":[["5ef15d47.7a9894"]]},{"id":"5ef15d47.7a9894","type":"change","z":"423c527d.a422fc","name":"data.sun","rules":[{"t":"move","p":"data","pt":"msg","to":"data.sun","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":920,"y":960,"wires":[[]]},{"id":"516e2c4f.b76a44","type":"api-call-service","z":"423c527d.a422fc","name":"Turn bedroom lights off","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.loggia_lightstrip, light.bedroom_light_group","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1270,"y":420,"wires":[[]]},{"id":"55bce5b1.25781c","type":"server-state-changed","z":"423c527d.a422fc","name":"Bedroom Light Switch","server":"78fe396.483dac8","version":1,"entityidfilter":"binary_sensor.bedroom_light_switch_short","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":140,"y":1220,"wires":[["156507b5.6f9048"]]},{"id":"9a9bff1c.6a972","type":"api-call-service","z":"423c527d.a422fc","name":"Bedroom Lights Toggle","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"light","service":"toggle","entityId":"light.bedroom_light_group","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":550,"y":1240,"wires":[[]]},{"id":"156507b5.6f9048","type":"api-current-state","z":"423c527d.a422fc","name":"light is off?","server":"78fe396.483dac8","version":1,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.bedroom_light_group","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":330,"y":1220,"wires":[["9044a83f.e3ea28"],["9a9bff1c.6a972"]]},{"id":"9044a83f.e3ea28","type":"api-call-service","z":"423c527d.a422fc","name":"Bedroom Scene: Warm Neutral","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"scene","service":"turn_on","entityId":"scene.bedroom_warm_default","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":570,"y":1200,"wires":[[]]},{"id":"f05e1143.564ec","type":"api-call-service","z":"423c527d.a422fc","name":"incremental skylight","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.loggia_lightstrip","data":"{\"color_temp\":265,\"transition\":200,\"brightness\":150}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1420,"y":140,"wires":[[]]},{"id":"a5b0d457.3326e8","type":"trigger","z":"423c527d.a422fc","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"2","extend":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1230,"y":220,"wires":[["3ce663b1.5493dc"]]},{"id":"3ce663b1.5493dc","type":"api-call-service","z":"423c527d.a422fc","name":"open loggia blinds","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"cover","service":"open_cover","entityId":"cover.loggia","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1410,"y":220,"wires":[[]]},{"id":"aba733f2.5eead","type":"trigger","z":"423c527d.a422fc","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"30","extend":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1230,"y":180,"wires":[["5cd05f14.cf227"]]},{"id":"5cd05f14.cf227","type":"api-call-service","z":"423c527d.a422fc","name":"loggia overhead light on","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.loggia_overhead_light","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1430,"y":180,"wires":[[]]},{"id":"bce81705.c72518","type":"trigger","z":"423c527d.a422fc","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"3","extend":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1230,"y":260,"wires":[["16f1272d.7d6fc9"]]},{"id":"16f1272d.7d6fc9","type":"api-call-service","z":"423c527d.a422fc","name":"loggia overhead light off","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.loggia_overhead_light","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1430,"y":260,"wires":[[]]},{"id":"d5db3ab5.558558","type":"function","z":"423c527d.a422fc","name":"set wake-up-period true","func":"global.set('wake-up-period', true);\n//global.get('wake-up-period') || false;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1270,"y":300,"wires":[[]]},{"id":"c3fa5eb4.4cdf7","type":"trigger","z":"423c527d.a422fc","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"15","extend":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1050,"y":380,"wires":[["37a78725.af4848"]]},{"id":"37a78725.af4848","type":"function","z":"423c527d.a422fc","name":"set wake-up-period false","func":"global.set('wake-up-period', false);\n//global.get('wake-up-period') || false;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1270,"y":380,"wires":[[]]},{"id":"6730eb4c.b13134","type":"function","z":"423c527d.a422fc","name":"get wake-up-period","func":"//global.set('wake-up-period', true);\nmsg.wakeup = global.get('wake-up-period') || false;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":360,"y":360,"wires":[["ccacc737.cba488"]]},{"id":"b2c77119.820a5","type":"server-state-changed","z":"423c527d.a422fc","name":"Corridor Motion","server":"78fe396.483dac8","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.bedroom_corridor_tradfri_motion","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":150,"y":360,"wires":[["6730eb4c.b13134"],[]]},{"id":"ccacc737.cba488","type":"switch","z":"423c527d.a422fc","name":"is true","property":"wakeup","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":530,"y":360,"wires":[["2ec8ee7b.8b1fc2"]]},{"id":"1fba351b.a7285b","type":"api-call-service","z":"423c527d.a422fc","name":"Scene: Good Morning","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"scene","service":"turn_on","entityId":"scene.good_morning","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":700,"y":400,"wires":[[]]},{"id":"2ec8ee7b.8b1fc2","type":"api-call-service","z":"423c527d.a422fc","name":"select custom scene","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"input_select","service":"select_option","entityId":"input_select.light_scene","data":"{\"option\":\"custom\"}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":700,"y":360,"wires":[["1fba351b.a7285b"]]},{"id":"2f77a7ef.884288","type":"api-call-service","z":"423c527d.a422fc","name":"Turn Loggia lights off","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.loggia_light_group","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1260,"y":480,"wires":[[]]},{"id":"6f379880.04b2d8","type":"api-call-service","z":"423c527d.a422fc","name":"Turn Entrance lights off","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.entrance_light_group","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1270,"y":520,"wires":[[]]},{"id":"7b531b23.4bdc74","type":"api-call-service","z":"260e105e.72e61","name":"Bathroom Light ON","server":"78fe396.483dac8","version":1,"service_domain":"light","service":"turn_on","entityId":"light.bathroom_light","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":950,"y":80,"wires":[["2c1a3f4b.49faa"]]},{"id":"e04a1096.1e46c","type":"api-call-service","z":"260e105e.72e61","name":"Bathroom Light OFF","server":"78fe396.483dac8","version":1,"service_domain":"light","service":"turn_off","entityId":"light.bathroom_light","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":520,"y":200,"wires":[[]]},{"id":"883dab48.2fd2d8","type":"time-range-switch","z":"260e105e.72e61","name":"","lat":"47.38089","lon":"8.48364","startTime":"06:20","endTime":"22:00","startOffset":0,"endOffset":0,"x":730,"y":120,"wires":[["7b531b23.4bdc74"],[]],"outputLabels":["true","false"]},{"id":"f8f3aba9.04b268","type":"change","z":"260e105e.72e61","name":"reset timer","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":330,"y":160,"wires":[["c3a4bcd8.0c80b"]]},{"id":"c3a4bcd8.0c80b","type":"trigger","z":"260e105e.72e61","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"10","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":330,"y":200,"wires":[["e04a1096.1e46c"]]},{"id":"ad3c4ae1.80e2d8","type":"server-state-changed","z":"260e105e.72e61","name":"Bathroom Motion","server":"78fe396.483dac8","version":1,"entityidfilter":"binary_sensor.bathroom_motion_sensor","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":120,"y":140,"wires":[["ee589d45.693bd","f8f3aba9.04b268"],["c3a4bcd8.0c80b"]]},{"id":"9aa401d4.89747","type":"weekday","z":"260e105e.72e61","name":"Weekday?","sun":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":false,"x":550,"y":160,"wires":[["883dab48.2fd2d8"],["451d3747.dd8278"]],"outputLabels":["Weekdays","Weekend"]},{"id":"451d3747.dd8278","type":"time-range-switch","z":"260e105e.72e61","name":"","lat":"47.38089","lon":"8.48364","startTime":"08:00","endTime":"22:00","startOffset":0,"endOffset":0,"x":730,"y":180,"wires":[["7b531b23.4bdc74"],[]],"outputLabels":["true","false"]},{"id":"ee589d45.693bd","type":"api-current-state","z":"260e105e.72e61","name":"is kitchen table light on?","server":"78fe396.483dac8","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.kitchen_table_light","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":370,"y":100,"wires":[["7b531b23.4bdc74"],["9aa401d4.89747"]]},{"id":"c6f43e7e.68de2","type":"server-state-changed","z":"260e105e.72e61","name":"Bathroom Switch","server":"78fe396.483dac8","version":1,"entityidfilter":"binary_sensor.bathroom_light_switch_short","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":120,"y":280,"wires":[["3cba1b36.7ed954"]]},{"id":"94a8d5d8.8e2e18","type":"api-call-service","z":"260e105e.72e61","name":"Bathroom Light Toggle","server":"78fe396.483dac8","version":1,"service_domain":"light","service":"toggle","entityId":"light.bathroom_light","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":580,"y":280,"wires":[["d0e36ea9.7e1c1"]]},{"id":"2c1a3f4b.49faa","type":"change","z":"260e105e.72e61","name":"lock bathroom light","rules":[{"t":"set","p":"bathroom_light_locked","pt":"global","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1170,"y":80,"wires":[["3c09074d.089b18"]]},{"id":"3c09074d.089b18","type":"trigger","z":"260e105e.72e61","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"2","extend":false,"units":"s","reset":"","bytopic":"all","outputs":1,"x":1160,"y":120,"wires":[["d0e36ea9.7e1c1"]]},{"id":"d0e36ea9.7e1c1","type":"change","z":"260e105e.72e61","name":"unlock bathroom light","rules":[{"t":"set","p":"bathroom_light_locked","pt":"global","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1180,"y":180,"wires":[[]]},{"id":"3cba1b36.7ed954","type":"switch","z":"260e105e.72e61","name":"is bathroom light locked?","property":"bathroom_light_locked","propertyType":"global","rules":[{"t":"true"},{"t":"false"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":330,"y":280,"wires":[[],["94a8d5d8.8e2e18"],["94a8d5d8.8e2e18"]]},{"id":"6921bf8c.d2b6a","type":"server-events","z":"260e105e.72e61","name":"Dconz Event","server":"78fe396.483dac8","event_type":"deconz_event","x":110,"y":420,"wires":[["8541155a.e79b88"]]},{"id":"8541155a.e79b88","type":"switch","z":"260e105e.72e61","name":"is bathroom switch?","property":"payload.event.id","propertyType":"msg","rules":[{"t":"eq","v":"switch_60","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":340,"y":420,"wires":[["83eacea3.de8b5"]]},{"id":"83eacea3.de8b5","type":"switch","z":"260e105e.72e61","name":"number of taps?","property":"payload.event.event","propertyType":"msg","rules":[{"t":"eq","v":"1002","vt":"str"},{"t":"eq","v":"1004","vt":"str"},{"t":"eq","v":"1005","vt":"str"},{"t":"eq","v":"1006","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":560,"y":420,"wires":[[],[],[],[]],"outputLabels":["single tap","double tap","triple tap","4 tap"]},{"id":"d9be011b.16673","type":"api-call-service","z":"260e105e.72e61","name":"broadcast","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"tts","service":"cloud_say","entityId":"media_player.home_hub","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":820,"y":640,"wires":[[]]},{"id":"675fad99.757bc4","type":"function","z":"260e105e.72e61","name":"Washing Ended Message","func":"var message = `The washing machine has finished washing your clothes!`\n\nmsg.payload =\n    {\n        \"data\":\n        {\n            \"message\": message\n        }\n        \n    }\n\nreturn msg;","outputs":1,"noerr":0,"x":630,"y":640,"wires":[["d9be011b.16673"]]},{"id":"611183c0.7fcf1c","type":"trigger-state","z":"260e105e.72e61","name":"Washing Machine has turned off","server":"78fe396.483dac8","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.washingmachine_state","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"e6erc5od20g","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"bool","comparatorValue":"false"},{"id":"a0fqt2v0q4","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"bool","comparatorValue":"true"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"habool","x":190,"y":660,"wires":[["8240e9ab.480058"],[]]},{"id":"4878869d.24de78","type":"api-call-service","z":"260e105e.72e61","name":"Push Notification","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_theos_iphone_14_pro_2","entityId":"","data":"{\"title\":\"Washing Machine done üëï\",\"message\":\"Don't wait for your clothes to wrinkle!\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":610,"y":680,"wires":[[]]},{"id":"c9383bc0.d91c48","type":"api-call-service","z":"260e105e.72e61","name":"broadcast","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"tts","service":"cloud_say","entityId":"media_player.home_hub","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":820,"y":740,"wires":[[]]},{"id":"e51508c8.c6d4f8","type":"function","z":"260e105e.72e61","name":"Tumbler Ended Message","func":"var message = `The tumbler has finished drying your clothes!`\n\nmsg.payload =\n    {\n        \"data\":\n        {\n            \"message\": message\n        }\n        \n    }\n\nreturn msg;","outputs":1,"noerr":0,"x":630,"y":740,"wires":[["c9383bc0.d91c48"]]},{"id":"6973d28b.547b7c","type":"trigger-state","z":"260e105e.72e61","name":"Tumbler has turned off","server":"78fe396.483dac8","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.tumbler_state","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"e6erc5od20g","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"bool","comparatorValue":"false"},{"id":"a0fqt2v0q4","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"bool","comparatorValue":"true"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"habool","x":220,"y":760,"wires":[["c3532e2b.30fa5"],[]]},{"id":"a44c7e50.b177f","type":"api-call-service","z":"260e105e.72e61","name":"Push Notification","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_theos_iphone_14_pro_2","entityId":"","data":"{\"title\":\"Tumbler done üëï\",\"message\":\"Don't wait for your clothes to wrinkle!\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":610,"y":780,"wires":[[]]},{"id":"56ec8b38.4f9624","type":"trigger-state","z":"260e105e.72e61","name":"Washing Machine has turned on","server":"78fe396.483dac8","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.washingmachine_state","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"true","propertyValue":"new_state.state"},{"targetType":"this_entity","targetValue":"","propertyType":"previous_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"false","propertyValue":"old_state.state"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"habool","x":190,"y":880,"wires":[["a167b6a7.ed0d48"],[]]},{"id":"a167b6a7.ed0d48","type":"api-current-state","z":"260e105e.72e61","name":"home occupied","server":"78fe396.483dac8","version":1,"outputs":2,"halt_if":"true","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.apartment_occupancy","state_type":"habool","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":460,"y":880,"wires":[[],["f6425403.9be298"]],"outputLabels":["occupied","not occupied"]},{"id":"f6425403.9be298","type":"api-call-service","z":"260e105e.72e61","name":"Notification","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_theos_iphone_14_pro_2","entityId":"","data":"{\"title\":\"Washing Machine started üëï\",\"message\":\"Has been started by a timer!\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":670,"y":880,"wires":[[]]},{"id":"8240e9ab.480058","type":"time-range-switch","z":"260e105e.72e61","name":"","lat":"47.38089","lon":"8.48364","startTime":"08:00","endTime":"22:00","startOffset":0,"endOffset":0,"x":410,"y":660,"wires":[["675fad99.757bc4","4878869d.24de78"],["4878869d.24de78"]]},{"id":"54698a41.81b204","type":"time-range-switch","z":"260e105e.72e61","name":"","lat":"47.38089","lon":"8.48364","startTime":"08:00","endTime":"22:00","startOffset":0,"endOffset":0,"x":410,"y":660,"wires":[[],[]]},{"id":"c3532e2b.30fa5","type":"time-range-switch","z":"260e105e.72e61","name":"","lat":"47.38089","lon":"8.48364","startTime":"08:00","endTime":"22:00","startOffset":0,"endOffset":0,"x":410,"y":760,"wires":[["e51508c8.c6d4f8","a44c7e50.b177f"],["a44c7e50.b177f"]]},{"id":"8815ce5c.99928","type":"server-state-changed","z":"ce35d200.18817","name":"Entrance door opens","server":"78fe396.483dac8","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.apartment_entrance","entityidfiltertype":"substring","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":160,"y":120,"wires":[["87e9d7b8.c59e28","6eefae60.3d2d5"],[]]},{"id":"cdf5a30e.068da","type":"api-call-service","z":"ce35d200.18817","name":"Set Volume","server":"78fe396.483dac8","version":"1","service_domain":"media_player","service":"volume_set","entityId":"media_player.bathroom","data":"{\"volume_level\":0.5}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":721.5,"y":122,"wires":[["2f983cc3.99fd64","2c5475b7.8e398a"]]},{"id":"77a024f3.4773cc","type":"api-call-service","z":"ce35d200.18817","name":"Set Volume","server":"78fe396.483dac8","version":"1","service_domain":"media_player","service":"volume_set","entityId":"media_player.bathroom","data":"{\"volume_level\":0.3}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":931.5,"y":202,"wires":[[]]},{"id":"b215a410.cee808","type":"trigger","z":"ce35d200.18817","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"2","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":751.5,"y":202,"wires":[["77a024f3.4773cc"]]},{"id":"966da4a8.1a1fb8","type":"api-call-service","z":"ce35d200.18817","name":"broadcast","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"tts","service":"cloud_say","entityId":"media_player.bathroom","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1651.5,"y":112,"wires":[[]]},{"id":"d89175f9.fa3d28","type":"function","z":"ce35d200.18817","name":"Welcome Message","func":"var currentTime = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});\n\nvar greetings = [\n    'Welcome home!',\n    'Welcome back!'\n]\nvar randomGreeting = greetings[Math.floor(Math.random() * greetings.length)];\n\nvar tempOutside = msg.data.outdoor.state;\nvar tempInside = msg.data.indoor.state;\n\nvar message = `\n    ${randomGreeting}\n    It is now ${currentTime}. \n    The temperature inside is ${tempInside}¬∞, whereas outside it is ${tempOutside}¬∞.\n    `\n\nmsg.payload =\n    {\n        \"data\":\n        {\n            \"message\": message\n        }\n        \n    }\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1481.5,"y":112,"wires":[["966da4a8.1a1fb8"]]},{"id":"2f983cc3.99fd64","type":"api-current-state","z":"ce35d200.18817","name":"get outdoor temperature","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.loggia_shelly_ht_temperature","state_type":"num","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":961.5,"y":92,"wires":[["4c2a796e.fd8f08"]]},{"id":"2c5475b7.8e398a","type":"api-current-state","z":"ce35d200.18817","name":"get indoor temperature","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.netatmo_sixtymeters_indoor_temperature","state_type":"num","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":951.5,"y":142,"wires":[["c654f4ba.8286a8"]]},{"id":"d75aada9.566fb","type":"join","z":"ce35d200.18817","name":"","mode":"custom","build":"merged","property":"data","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1311.5,"y":112,"wires":[["d89175f9.fa3d28"]]},{"id":"4c2a796e.fd8f08","type":"change","z":"ce35d200.18817","name":"data.outdoor","rules":[{"t":"move","p":"data","pt":"msg","to":"data.outdoor","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1161.5,"y":92,"wires":[["d75aada9.566fb"]]},{"id":"c654f4ba.8286a8","type":"change","z":"ce35d200.18817","name":"data.indoor","rules":[{"t":"move","p":"data","pt":"msg","to":"data.indoor","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1161.5,"y":142,"wires":[["d75aada9.566fb"]]},{"id":"783c11e5.0d766","type":"server-state-changed","z":"ce35d200.18817","name":"Entrance Motion","server":"78fe396.483dac8","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.entrance_logi_motion","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":140,"y":460,"wires":[["846e5a53.b62518","3520901e.7400f"],[]]},{"id":"ccaa5b92.6c0808","type":"time-range-switch","z":"ce35d200.18817","name":"","lat":"47.38089","lon":"8.48364","startTime":"09:00","endTime":"22:00","startOffset":0,"endOffset":0,"x":630,"y":480,"wires":[["eb8946b5.671eb8","4fed0d6a.2f8f24"],[]]},{"id":"eb8946b5.671eb8","type":"api-call-service","z":"ce35d200.18817","name":"Entrance Light DAY ON","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.entrance_light_group","data":"{\"brightness\":254,\"color_temp\":379}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":870,"y":480,"wires":[[]]},{"id":"10db8870.e03238","type":"api-call-service","z":"ce35d200.18817","name":"Entrance Light NIGHT ON","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.entrance_light_group","data":"{\"brightness\":82,\"color_temp\":431}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":870,"y":440,"wires":[[]]},{"id":"4fed0d6a.2f8f24","type":"trigger","z":"ce35d200.18817","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"3","extend":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":830,"y":400,"wires":[["74191056.eb5ca"]]},{"id":"74191056.eb5ca","type":"api-call-service","z":"ce35d200.18817","name":"Entrance Light OFF","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.entrance_light_group","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1010,"y":400,"wires":[[]]},{"id":"3520901e.7400f","type":"change","z":"ce35d200.18817","name":"reset timer","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":400,"wires":[["4fed0d6a.2f8f24"]]},{"id":"6eefae60.3d2d5","type":"switch","z":"ce35d200.18817","name":"is exiting?","property":"exiting","propertyType":"global","rules":[{"t":"true"},{"t":"false"},{"t":"null"}],"checkall":"true","repair":false,"outputs":3,"x":480,"y":260,"wires":[[],["4fed0d6a.2f8f24","eb8946b5.671eb8"],["4fed0d6a.2f8f24","eb8946b5.671eb8"]]},{"id":"87e9d7b8.c59e28","type":"subflow:27f43369.1137ec","z":"ce35d200.18817","name":"","env":[],"x":501.5,"y":122,"wires":[["cdf5a30e.068da","b215a410.cee808"],[]]},{"id":"845eeff7.7a8fc","type":"time-range-switch","z":"ce35d200.18817","name":"","lat":"47.38089","lon":"8.48364","startTime":"07:00","endTime":"09:00","startOffset":0,"endOffset":0,"x":630,"y":440,"wires":[["10db8870.e03238","4fed0d6a.2f8f24"],[]]},{"id":"bcae61e8.18c4","type":"server-state-changed","z":"ce35d200.18817","name":"Entrance Light Switch","server":"78fe396.483dac8","version":1,"entityidfilter":"binary_sensor.entrance_light_switch","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":160,"y":640,"wires":[["790dafb6.c95e"]]},{"id":"790dafb6.c95e","type":"api-call-service","z":"ce35d200.18817","name":"Entrance Lights","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"light","service":"toggle","entityId":"light.entrance_light_group","data":"{\"brightness\":254,\"color_temp\":379}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":400,"y":640,"wires":[[]]},{"id":"846e5a53.b62518","type":"api-current-state","z":"ce35d200.18817","name":"is kitchen table light on?","server":"78fe396.483dac8","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"light.kitchen_table_light","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":390,"y":460,"wires":[["eb8946b5.671eb8"],["ccaa5b92.6c0808","845eeff7.7a8fc"]]},{"id":"4ad4dd23.23cc14","type":"switch","z":"ce35d200.18817","name":"button pressed","property":"payload.event.event","propertyType":"msg","rules":[{"t":"eq","v":"34","vt":"str"},{"t":"eq","v":"16","vt":"str"},{"t":"eq","v":"17","vt":"str"},{"t":"eq","v":"18","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":460,"y":860,"wires":[["213350ed.d0402"],["213350ed.d0402","31f92b88.1c2eb4"],[],[]],"outputLabels":["button 1","button 2","button 3","button 4"]},{"id":"da41d838.b695c8","type":"api-call-service","z":"ce35d200.18817","name":"Kitchen Utilities OFF","server":"78fe396.483dac8","version":"1","service_domain":"switch","service":"turn_off","entityId":"switch.kitchen_plug","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":1000,"y":820,"wires":[[]]},{"id":"ac63547a.3fced8","type":"api-call-service","z":"ce35d200.18817","name":"Turn all lights off","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"all","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":980,"y":880,"wires":[[]]},{"id":"66e60089.5902f","type":"server-events","z":"ce35d200.18817","name":"Dconz Event","server":"78fe396.483dac8","event_type":"deconz_event","x":140,"y":860,"wires":[["f7f6683f.9d6418"]]},{"id":"f7f6683f.9d6418","type":"switch","z":"ce35d200.18817","name":"is tap?","property":"payload.event.id","propertyType":"msg","rules":[{"t":"eq","v":"tap","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":280,"y":860,"wires":[["4ad4dd23.23cc14"]]},{"id":"213350ed.d0402","type":"function","z":"ce35d200.18817","name":"set exiting=true","func":"global.set('exiting', true);\n\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":820,"wires":[["da41d838.b695c8","ac63547a.3fced8","d9bee355.abbcb","10ada537.a7bb3b","73fa472b.c6c4f8","bf48167398d96d8a"]]},{"id":"524f37da.a7bb88","type":"function","z":"ce35d200.18817","name":"set exiting=false","func":"global.set('exiting', false);","outputs":1,"noerr":0,"x":1140,"y":940,"wires":[[]]},{"id":"d9bee355.abbcb","type":"trigger","z":"ce35d200.18817","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"2","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":970,"y":940,"wires":[["524f37da.a7bb88"]]},{"id":"10ada537.a7bb3b","type":"api-call-service","z":"ce35d200.18817","name":"Pause all media players","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"media_player","service":"turn_off","entityId":"media_player.samsung_tv, media_player.everywhere, media_player.google_home, media_player.bathroom, media_player.home_hub, media_player.bedroom_speaker, media_player.loggia_speaker","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":1010,"y":760,"wires":[[]]},{"id":"31f92b88.1c2eb4","type":"api-call-service","z":"ce35d200.18817","name":"Vacuum Robot ON","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"vacuum","service":"start","entityId":"vacuum.roborock_s7","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":710,"y":860,"wires":[[]]},{"id":"73fa472b.c6c4f8","type":"time-range-switch","z":"ce35d200.18817","name":"","lat":"47.38089","lon":"8.48364","startTime":"06:00","endTime":"18:00","startOffset":0,"endOffset":0,"x":980,"y":700,"wires":[["71837a0e.668474"],[]]},{"id":"5c4d93ce.f7478c","type":"api-call-service","z":"ce35d200.18817","name":"Turn eBike Charger off","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.eBike_Charger","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":540,"y":1020,"wires":[[]]},{"id":"598ddec5.ca4ee","type":"server-state-changed","z":"ce35d200.18817","name":"eBike Charger turns on","server":"78fe396.483dac8","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.ebike_charger","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":130,"y":1020,"wires":[["8061bd4a.5088c"],[]]},{"id":"8061bd4a.5088c","type":"trigger","z":"ce35d200.18817","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"4","extend":false,"units":"hr","reset":"","bytopic":"all","outputs":1,"x":330,"y":1020,"wires":[["5c4d93ce.f7478c"]]},{"id":"71837a0e.668474","type":"link out","z":"ce35d200.18817","name":"Blinds control Input","links":["dba681ea.8d5ab"],"x":1105,"y":680,"wires":[]},{"id":"f8fd9032b140b6ca","type":"link in","z":"ce35d200.18817","name":"Shutdown Out","links":["0436629f96b47e1a"],"x":775,"y":720,"wires":[["10ada537.a7bb3b","da41d838.b695c8","ac63547a.3fced8"]]},{"id":"bf48167398d96d8a","type":"link out","z":"ce35d200.18817","name":"Secure Energy Safe Mode","mode":"link","links":["d074501098e3667c"],"x":915,"y":640,"wires":[]},{"id":"ba9036c1.11e058","type":"api-call-service","z":"2614aeae.a90552","name":"LED on","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"logi_circle","service":"set_config","entityId":"camera.logi_living_room","data":"{\"mode\":\"LED\",\"value\":true}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":720,"y":220,"wires":[[]]},{"id":"adda0079.bdc5e","type":"api-call-service","z":"2614aeae.a90552","name":"LED off","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"logi_circle","service":"set_config","entityId":"camera.logi_living_room","data":"{\"mode\":\"LED\",\"value\":false}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":720,"y":80,"wires":[[]]},{"id":"44013385.05812c","type":"api-call-service","z":"2614aeae.a90552","name":"Recoding on","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"logi_circle","service":"set_config","entityId":"camera.logi_living_room","data":"{\"mode\":\"RECORDING_MODE\",\"value\":true}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":730,"y":180,"wires":[[]]},{"id":"16c2fd2.6d65703","type":"api-call-service","z":"2614aeae.a90552","name":"Recording off","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"logi_circle","service":"set_config","entityId":"camera.logi_living_room","data":"{\"mode\":\"RECORDING_MODE\",\"value\":false}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":740,"y":120,"wires":[[]]},{"id":"7e0be515.b450cc","type":"server-state-changed","z":"2614aeae.a90552","name":"Apartment occupancy state change","server":"78fe396.483dac8","version":1,"entityidfilter":"binary_sensor.apartment_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":140,"y":160,"wires":[["95b513c136f0b6c4"],["44013385.05812c","ba9036c1.11e058","fc3c8713f2437547"]],"outputLabels":["occupied","not occupied"]},{"id":"fc3c8713f2437547","type":"api-call-service","z":"2614aeae.a90552","name":"Entrance Camera ON","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.entrance_camera_plug","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":760,"y":260,"wires":[[]]},{"id":"297fce434fd7577c","type":"api-call-service","z":"2614aeae.a90552","name":"Entrance Camera OFF","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.entrance_camera_plug","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":760,"y":40,"wires":[[]]},{"id":"e5b5d5c2deb182f4","type":"server-state-changed","z":"2614aeae.a90552","name":"Entrance door opens","server":"78fe396.483dac8","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.apartment_entrance","entityidfiltertype":"substring","outputinitially":false,"state_type":"habool","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"x":160,"y":340,"wires":[["74ea4fcb7503e9a3"],[]]},{"id":"74ea4fcb7503e9a3","type":"api-current-state","z":"2614aeae.a90552","name":"Access Control Enabled","server":"78fe396.483dac8","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.access_control","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":410,"y":340,"wires":[["07a5b8c8099766a6","2d1cbcffd2caf980","b881bd55f7e67add","fc3c8713f2437547","ba9036c1.11e058","44013385.05812c"],[]]},{"id":"07a5b8c8099766a6","type":"api-call-service","z":"2614aeae.a90552","name":"Notify iPhone","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_theos_iphone_13_pro","entityId":"","data":"{\t   \"message\":\"WestLink Apartment Door opened\",\t   \"title\":\"Access Control Alert\",\t   \"data\": {\t       push: {\t           sound: \"default\",\t           critical: 1,\t           volume: 0\t        }\t   }\t}","dataType":"jsonata","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":640,"y":320,"wires":[[]]},{"id":"2d1cbcffd2caf980","type":"api-call-service","z":"2614aeae.a90552","name":"Notify macbook","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"notify","service":"mobile_app_theos_macbook_air","entityId":"","data":"{\t   \"message\":\"WestLink Apartment Door opened\",\t   \"title\":\"Access Control Alert\",\t   \"data\": {\t       push: {\t           sound: \"default\",\t           critical: 1,\t           volume: 0\t        }\t   }\t}","dataType":"jsonata","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":640,"y":360,"wires":[[]]},{"id":"b881bd55f7e67add","type":"api-call-service","z":"2614aeae.a90552","name":"Telegram Log","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"telegram_bot","service":"send_message","entityId":"","data":"{\"message\":\"Security Alert: Apartment Door opened while access control was enabled!\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":640,"y":400,"wires":[[]]},{"id":"c7585537.3490a8","type":"inject","z":"2614aeae.a90552","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":420,"wires":[[]]},{"id":"95b513c136f0b6c4","type":"api-current-state","z":"2614aeae.a90552","name":"Access Control Enabled","server":"78fe396.483dac8","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.access_control","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":450,"y":100,"wires":[[],["297fce434fd7577c","adda0079.bdc5e","16c2fd2.6d65703"]]},{"id":"b9e2e175.9a3ad","type":"function","z":"e550f91e.577438","name":"calculate total networth","func":"const globalHomeAssistant = global.get('homeassistant');\n\nvar swissquoteAssets = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.influx_swissquote_assets\"].state);\nvar swissquoteCrypto = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.influx_swissquote_crypto\"].state);\n\nvar zweiteSaeuleBalance = parseInt(msg.payload[0].distinct);\n\nvar cash = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.influx_cash\"].state);\nvar neon = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.influx_neon_checking\"].state);\nvar revolut = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.influx_revolut_checking\"].state);\nvar swissquoteChecking = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.influx_swissquote_checking\"].state);\nvar yuhChecking = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.influx_yuh_checking\"].state);\nvar yuhInvestments = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.influx_yuh_investments\"].state);\n\nvar ibkrChecking = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.influx_ibkr_checking\"].state);\nvar ibkrAssets = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.influx_ibkr_assets\"].state);\n\nvar frankly3A = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.influx_frankly_3a\"].state);\n\nvar total = frankly3A+swissquoteAssets+swissquoteCrypto\n+zweiteSaeuleBalance+cash+neon+revolut+swissquoteChecking\n+yuhChecking+yuhInvestments+ibkrChecking+ibkrAssets;\nmsg.networth = total;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":530,"y":820,"wires":[["1509b22.e29b94e"]]},{"id":"39aef00f.a4481","type":"trigger","z":"e550f91e.577438","name":"","op1":"","op2":"","op1type":"nul","op2type":"date","duration":"2","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":260,"y":820,"wires":[["e965479251ca80b2","1e12551703b1c237"]]},{"id":"1509b22.e29b94e","type":"ha-entity","z":"e550f91e.577438","name":"Net Worth","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Net Worth"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:currency-usd"},{"property":"unit_of_measurement","value":"CHF"}],"state":"networth","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":760,"y":820,"wires":[[]]},{"id":"4c068b8d.b88ab4","type":"server-events","z":"e550f91e.577438","name":"iOS Shortcut Events","server":"78fe396.483dac8","event_type":"ios_shortcut","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"x":150,"y":160,"wires":[["92982b00.9e35f8"]]},{"id":"92982b00.9e35f8","type":"switch","z":"e550f91e.577438","name":"Topic","property":"payload.event.topic","propertyType":"msg","rules":[{"t":"eq","v":"money_spent","vt":"str"},{"t":"eq","v":"swissquote_performance","vt":"str"},{"t":"eq","v":"swissquote_balance","vt":"str"},{"t":"eq","v":"ubs_fond_balance","vt":"str"},{"t":"eq","v":"ubs_vorsorge_balance","vt":"str"},{"t":"eq","v":"health_pmo","vt":"str"},{"t":"eq","v":"health_pmo_craving","vt":"str"},{"t":"eq","v":"health_mood","vt":"str"},{"t":"eq","v":"health_mo","vt":"str"},{"t":"eq","v":"health_exp","vt":"str"}],"checkall":"true","repair":false,"outputs":10,"x":330,"y":160,"wires":[["6f1f703d.69a1b"],[],[],[],[],["d4ad6a80.f44928"],["3c4934f2.47d84c"],["fe58e2d7.ca12f"],["8324fd1d.6a982"],["efda3943ed0d8e1a"]]},{"id":"6f1f703d.69a1b","type":"link out","z":"e550f91e.577438","name":"Money Spent Input","links":["d82f26ba.3ccdd8"],"x":435,"y":60,"wires":[]},{"id":"7f4d67d7.97c758","type":"link in","z":"e550f91e.577438","name":"Recalculate Net Worth Output","links":["65dcde1c.66ad7","a439a78f9d6e9c6e"],"x":85,"y":820,"wires":[["39aef00f.a4481"]]},{"id":"af6f1005.600d3","type":"ha-entity","z":"e550f91e.577438","name":"Swissquote Balance","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Swissquote Balance"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:certificate-outline"},{"property":"unit_of_measurement","value":"CHF"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":820,"y":4000,"wires":[[]]},{"id":"1323a57.ab0f25b","type":"inject","z":"e550f91e.577438","name":"weekdays 06:00","props":[],"repeat":"","crontab":"00 06 * * 1,2,3,4,5,6","once":false,"onceDelay":0.1,"topic":"","x":150,"y":1720,"wires":[["1e716bc640be1a0e"]]},{"id":"8fab4e7b.6b911","type":"inject","z":"e550f91e.577438","name":"weekdays 22:00","props":[],"repeat":"","crontab":"00 22 * * 1,2,3,4,5,6","once":false,"onceDelay":0.1,"topic":"","x":150,"y":1780,"wires":[["a35a6074.a9a5"]]},{"id":"a35a6074.a9a5","type":"api-call-service","z":"e550f91e.577438","name":"Offpeak Tariff","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"select","service":"select_option","entityId":"select.daily_energy","data":"{\"option\":\"offpeak\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":390,"y":1780,"wires":[["38d223f015b932e0"]]},{"id":"ea57a6b9.536428","type":"inject","z":"e550f91e.577438","name":"EoD","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"55 23 * * *","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":110,"y":1880,"wires":[["4d08cb30.242974","6ec8460f.2ebe08","5be0f639.f5cda8","ad8f728a.f451a"]]},{"id":"4d08cb30.242974","type":"api-current-state","z":"e550f91e.577438","name":"get energy total","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.daily_energy_total","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":280,"y":1880,"wires":[["63840ce0.8439f4"]]},{"id":"63840ce0.8439f4","type":"ha-entity","z":"e550f91e.577438","name":"EoD Energy Consumption (Total)","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"EoD Energy Consumption"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:lightning-bolt"},{"property":"unit_of_measurement","value":"kWh"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":530,"y":1880,"wires":[[]]},{"id":"6ff17984.779b88","type":"ha-entity","z":"e550f91e.577438","name":"EoD Energy Consumption (Peak)","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"EoD Energy Consumption Peak"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:lightning-bolt"},{"property":"unit_of_measurement","value":"kWh"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":540,"y":1940,"wires":[[]]},{"id":"4870a3ce.f2f88c","type":"ha-entity","z":"e550f91e.577438","name":"EoD Energy Consumption (Offpeak)","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"EoD Energy Consumption Offpeak"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:lightning-bolt"},{"property":"unit_of_measurement","value":"kWh"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":540,"y":2000,"wires":[[]]},{"id":"6ec8460f.2ebe08","type":"api-current-state","z":"e550f91e.577438","name":"get energy peak","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.daily_energy_peak","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":280,"y":1940,"wires":[["6ff17984.779b88"]]},{"id":"5be0f639.f5cda8","type":"api-current-state","z":"e550f91e.577438","name":"get energy offpeak","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.daily_energy_offpeak","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":270,"y":2000,"wires":[["4870a3ce.f2f88c"]]},{"id":"ad8f728a.f451a","type":"api-current-state","z":"e550f91e.577438","name":"get daily energy cost","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.daily_energy_cost_total","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":260,"y":2060,"wires":[["4f544421.c2a2bc"]]},{"id":"4f544421.c2a2bc","type":"ha-entity","z":"e550f91e.577438","name":"EoD Energy Cost (Total)","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"EoD Energy Cost"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:currency-usd"},{"property":"unit_of_measurement","value":"CHF"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":510,"y":2060,"wires":[[]]},{"id":"60ed4610.384be8","type":"function","z":"e550f91e.577438","name":"convert to percentage","func":"msg.payload = parseFloat(msg.payload) * 100;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":140,"y":2140,"wires":[[]]},{"id":"fbe27cd0.e24a1","type":"ha-entity","z":"e550f91e.577438","name":"Health PMO","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Health PMO"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:head-dots-horizontal-outline"},{"property":"unit_of_measurement","value":"event"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":650,"y":2480,"wires":[[]]},{"id":"d4ad6a80.f44928","type":"link out","z":"e550f91e.577438","name":"Health PMO Input","links":["a432fd41.e419b","67568579.12396c"],"x":525,"y":320,"wires":[]},{"id":"a432fd41.e419b","type":"link in","z":"e550f91e.577438","name":"Health PMO Output","links":["d4ad6a80.f44928","15aea4c77de9d72d"],"x":315,"y":2480,"wires":[["202cb511.55f4ca"]]},{"id":"202cb511.55f4ca","type":"function","z":"e550f91e.577438","name":"calculate pmo","func":"const globalHomeAssistant = global.get('homeassistant');\n\nvar health_pmo = parseFloat(globalHomeAssistant.homeAssistant.states[\"sensor.health_pmo\"].state);\n\nmsg.payload = health_pmo + 1;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":2480,"wires":[["fbe27cd0.e24a1"]]},{"id":"f944055c.8110a8","type":"inject","z":"e550f91e.577438","name":"EoD","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"59 23 * * *","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":290,"y":2580,"wires":[["25cd2e8c.bcdc22"]]},{"id":"25cd2e8c.bcdc22","type":"function","z":"e550f91e.577438","name":"reset pmo","func":"msg.payload = 0;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":2580,"wires":[["fa6405e3.f4f8b8","fbe27cd0.e24a1","4314bbd8.7a1654"]]},{"id":"fa6405e3.f4f8b8","type":"ha-entity","z":"e550f91e.577438","name":"Health PMO Craving","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Health PMO Craving"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:head-remove-outline"},{"property":"unit_of_measurement","value":"event"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":680,"y":2520,"wires":[[]]},{"id":"fb86218.c1b1be","type":"function","z":"e550f91e.577438","name":"calculate craving","func":"const globalHomeAssistant = global.get('homeassistant');\n\nvar health_pmo_craving = parseFloat(globalHomeAssistant.homeAssistant.states[\"sensor.health_pmo_craving\"].state);\n\nmsg.payload = health_pmo_craving + 1;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":2520,"wires":[["fa6405e3.f4f8b8"]]},{"id":"825fbe1a.42936","type":"link in","z":"e550f91e.577438","name":"Health PMO Craving Output","links":["3c4934f2.47d84c"],"x":315,"y":2520,"wires":[["fb86218.c1b1be"]]},{"id":"3c4934f2.47d84c","type":"link out","z":"e550f91e.577438","name":"Health PMO Craving Input","links":["825fbe1a.42936","6b7896c9.818198"],"x":525,"y":280,"wires":[]},{"id":"83bd2ae8.2e6178","type":"ha-entity","z":"e550f91e.577438","name":"Health Mood","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Health Mood"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:drama-masks"},{"property":"unit_of_measurement","value":"happiness"}],"state":"payload","stateType":"msg","attributes":[{"property":"update_count","value":"update_count","valueType":"msg"},{"property":"total_score","value":"total_score","valueType":"msg"},{"property":"avg_score","value":"avg_score","valueType":"msg"}],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":610,"y":2660,"wires":[[]]},{"id":"fe58e2d7.ca12f","type":"link out","z":"e550f91e.577438","name":"Health Mood Input","links":["8306013.6d97e"],"x":585,"y":320,"wires":[]},{"id":"8306013.6d97e","type":"link in","z":"e550f91e.577438","name":"Health Mood Output","links":["fe58e2d7.ca12f"],"x":275,"y":2660,"wires":[["b8461947.136c18"]]},{"id":"b8461947.136c18","type":"function","z":"e550f91e.577438","name":"calculate mood","func":"const gHA = global.get('homeassistant').homeAssistant;\n\nvar existingMood = parseFloat(gHA.states[\"sensor.health_mood\"].state);\nvar existingCount = parseFloat(gHA.states[\"sensor.health_mood\"].attributes.update_count);\nvar existingTotal = parseFloat(gHA.states[\"sensor.health_mood\"].attributes.total_score);\n\nvar newMood = parseFloat(msg.payload.event.value);\n\nmsg.payload = newMood;\nmsg.update_count = existingCount + 1;\nmsg.total_score = existingTotal + newMood;\n\nif(existingCount === 0){\n    msg.avg_score = newMood;\n} else {\n    msg.avg_score = msg.total_score / msg.update_count\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":400,"y":2660,"wires":[["83bd2ae8.2e6178"]]},{"id":"faabc60c.dfe658","type":"function","z":"e550f91e.577438","name":"reset mood","func":"const gHA = global.get('homeassistant').homeAssistant;\nmsg.payload = parseFloat(gHA.states[\"sensor.health_mood\"].state);\nmsg.update_count = 0;\nmsg.total_score = 0;\nmsg.avg_score = 5;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":410,"y":2700,"wires":[["83bd2ae8.2e6178"]]},{"id":"10cedebe.794431","type":"inject","z":"e550f91e.577438","name":"Nightly 03:00","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"00 03 * * *","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":240,"y":2700,"wires":[["faabc60c.dfe658"]]},{"id":"3b7540d1.ba7c5","type":"link in","z":"e550f91e.577438","name":"Calories Output","links":["6bf84159.60762"],"x":415,"y":2760,"wires":[["512d6dc8.d802b4"]]},{"id":"512d6dc8.d802b4","type":"function","z":"e550f91e.577438","name":"calculate calories","func":"const globalHomeAssistant = global.get('homeassistant');\n\nvar health_calories_consumed = parseFloat(globalHomeAssistant.homeAssistant.states[\"sensor.health_calories_consumed\"].state);\n\nmsg.payload = health_calories_consumed + msg.payload;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":570,"y":2800,"wires":[["65ccee01.8f3c6"]]},{"id":"65ccee01.8f3c6","type":"ha-entity","z":"e550f91e.577438","name":"Health Calories","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Health Calories Consumed"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:food"},{"property":"unit_of_measurement","value":"kcal"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":800,"y":2860,"wires":[[]]},{"id":"3ce11074.aef3b","type":"inject","z":"e550f91e.577438","name":"EoD","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"59 23 * * *","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":410,"y":2860,"wires":[["eced7493.2f4fb8"]]},{"id":"eced7493.2f4fb8","type":"function","z":"e550f91e.577438","name":"reset calories","func":"msg.payload = 0;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":2860,"wires":[["65ccee01.8f3c6"]]},{"id":"4314bbd8.7a1654","type":"ha-entity","z":"e550f91e.577438","name":"Health MO","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Health MO"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:head-heart-outline"},{"property":"unit_of_measurement","value":"event"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":650,"y":2440,"wires":[[]]},{"id":"9b48b643.ebbcc8","type":"function","z":"e550f91e.577438","name":"calculate mo","func":"const globalHomeAssistant = global.get('homeassistant');\n\nvar health_mo = parseFloat(globalHomeAssistant.homeAssistant.states[\"sensor.health_mo\"].state);\n\nmsg.payload = health_mo + 1;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":2440,"wires":[["4314bbd8.7a1654"]]},{"id":"8324fd1d.6a982","type":"link out","z":"e550f91e.577438","name":"Health Mo Input","links":["b5464904.ee3888"],"x":585,"y":280,"wires":[]},{"id":"b5464904.ee3888","type":"link in","z":"e550f91e.577438","name":"Health MO Output","links":["8324fd1d.6a982"],"x":315,"y":2440,"wires":[["9b48b643.ebbcc8"]]},{"id":"96c124df.d4aad8","type":"ha-webhook","z":"e550f91e.577438","name":"iOS Health Sync","server":"78fe396.483dac8","outputs":1,"webhookId":"health-sync-I9z97p2lDcrRwQo630YAP8aVbe5X7Dqb","payloadLocation":"payload","payloadLocationType":"msg","headersLocation":"","headersLocationType":"none","x":160,"y":3100,"wires":[["1597c2cc.a9d7dd","9e53443b.0f41c8","a65f25c9.dd3ed8","195dc03bd9f99035"]]},{"id":"1597c2cc.a9d7dd","type":"function","z":"e550f91e.577438","name":"map health metrics to influx measurement","func":"var mappedMetrics = []; \n\n//e.g. active_energy\nmsg.payload = msg.payload.data.metrics.map(metric => {\n    \n    //e.g. measurement for 01.01.2020 of active_energy\n    return metric.data.map(actualMeasurement =>\n       ({\n            measurement: metric.units, //kJ\n            fields: {\n                ...(actualMeasurement.qty && {value: actualMeasurement.qty}), //2500 default\n                ...(actualMeasurement.Avg && {Avg: actualMeasurement.Avg}), //Heartrate special\n                ...(actualMeasurement.Max && {Max: actualMeasurement.Max}), //Heartrate special\n                ...(actualMeasurement.Min && {Min: actualMeasurement.Min}), //Heartrate special\n                ...(actualMeasurement.inBed && {inBed: actualMeasurement.inBed}), //Bed special\n                ...(actualMeasurement.asleep && {asleep: actualMeasurement.asleep}), //Bed special\n\t\t\t\t...(actualMeasurement.heartRateVariation && { value: measurement.heartRateVariation.length }), //irregular heartrate special\n            },\n            tags:{\n                entity_id: metric.name, //active_energy\n                ...(actualMeasurement.sleepSource && {sleepSource: actualMeasurement.sleepSource}), //Bed special\n                ...(actualMeasurement.inBedSource && {inBedSource: actualMeasurement.inBedSource}) //Bed special\n\n            },\n            timestamp: Date.parse(actualMeasurement.date) //2021-03-16 00:00:00 +0100\n        }))\n    })\n\t.flat() // we've created array for each metric consisting of array of measurements\n\t.filter(e => Object.keys(e.fields).length) // only return entries with fields\n\t\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":460,"y":3100,"wires":[["60ed24c1.a201fc"]]},{"id":"60ed24c1.a201fc","type":"influxdb batch","z":"e550f91e.577438","influxdb":"ff691ce7.c0e1c","precision":"ms","retentionPolicy":"","name":"Write batch to InfluxDB","database":"","retentionPolicyV18Flux":"","org":"","bucket":"","x":810,"y":3100,"wires":[]},{"id":"9e53443b.0f41c8","type":"function","z":"e550f91e.577438","name":"map workout metrics to influx measurement","func":"msg.payload = msg.payload.data.workouts.map(workout =>\n    ({\n        measurement: \"workout\",\n        fields: {\n            ...(workout.humidity.qty && {workout_humidity_percentage: workout.humidity.qty}), //62\n            ...(workout.flightsClimbed.qty && {workout_flightsClimbedCount_stairs: workout.flightsClimbed.qty}), //0\n            ...(workout.swimCadence.qty && {workout_swimCadence_spm: workout.swimCadence.qty}), //0\n            ...(workout.totalSwimmingStrokeCount.qty && {workout_totalSwimmingStrokeCount_strokes: workout.totalSwimmingStrokeCount.qty}), //0   \n            ...(workout.intensity.qty && {workout_intensity_met: workout.intensity.qty}), //8.7823\n            ...(workout.temperature.qty && {workout_temperature_degC: workout.temperature.qty}), //3.9\n            ...(workout.avgHeartRate.qty && {workout_avgHeartRate_bpm: workout.avgHeartRate.qty}), //140.78\n            ...(workout.stepCadence.qty && {workout_stepCadence_spm: workout.stepCadence.qty}), //1.449\n            ...(workout.totalEnergy.qty && {workout_totalEnergy_kJ: workout.totalEnergy.qty}), //1723.616\n            ...(workout.maxHeartRate.qty && {workout_maxHeartRate_bpm: workout.maxHeartRate.qty}), //170\n            ...(workout.stepCount.qty && {workout_stepCount_steps: workout.stepCount.qty}), //3081\n            ...(workout.distance.qty && {workout_distance_km: workout.distance.qty}), //0\n            ...(workout.activeEnergy.qty && {workout_activeEnergy_kJ: workout.activeEnergy.qty}), //1471\n            ...(workout.elevation.ascent && {workout_elevationAscent_m: workout.elevation.ascent}), //0\n            ...(workout.elevation.descent && {workout_elevationDescent_m: workout.elevation.descent}), //0\n            ...(workout.start && {workout_totalTime_min: Math.floor(((Math.abs(new Date(workout.end) - new Date(workout.start)))/1000)/60)}), //0            \n        },\n        tags:{\n            workout_type: workout.name //Fitness Gaming\n        },\n        timestamp: Date.parse(workout.start) \n    }))\n\t.filter(e => Object.keys(e.fields).length) // only return entries with fields\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":470,"y":3140,"wires":[["60ed24c1.a201fc","a65f25c9.dd3ed8"]]},{"id":"a65f25c9.dd3ed8","type":"debug","z":"e550f91e.577438","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":830,"y":3220,"wires":[]},{"id":"f5a67cc9dba01dd8","type":"trigger-state","z":"e550f91e.577438","name":"Add 50kcal","server":"78fe396.483dac8","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"script.add_50kcal","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on","propertyValue":"new_state.state"}],"outputs":3,"customoutputs":[{"messageType":"custom","messageValue":"{\"payload\":50}","messageValueType":"json","comparatorPropertyType":"always","comparatorType":"is","comparatorValue":"on","comparatorValueDataType":"str","comparatorPropertyValue":""}],"outputinitially":false,"state_type":"str","x":110,"y":2800,"wires":[[],[],["512d6dc8.d802b4"]]},{"id":"40e0cd57fe771dc0","type":"trigger-state","z":"e550f91e.577438","name":"Add 100kcal","server":"78fe396.483dac8","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"script.add_100kcals","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on","propertyValue":"new_state.state"}],"outputs":3,"customoutputs":[{"messageType":"custom","messageValue":"{\"payload\":100}","messageValueType":"json","comparatorPropertyType":"always","comparatorType":"is","comparatorValue":"on","comparatorValueDataType":"str","comparatorPropertyValue":""}],"outputinitially":false,"state_type":"str","x":110,"y":2860,"wires":[[],[],["512d6dc8.d802b4"]]},{"id":"2252ba165b38405c","type":"trigger-state","z":"e550f91e.577438","name":"Add 500kcal","server":"78fe396.483dac8","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"script.add_500kcal","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on","propertyValue":"new_state.state"}],"outputs":3,"customoutputs":[{"messageType":"custom","messageValue":"{\"payload\":500}","messageValueType":"json","comparatorPropertyType":"always","comparatorType":"is","comparatorValue":"on","comparatorValueDataType":"str","comparatorPropertyValue":""}],"outputinitially":false,"state_type":"str","x":110,"y":2920,"wires":[[],[],["512d6dc8.d802b4"]]},{"id":"8dca3ad193c4bc7a","type":"function","z":"e550f91e.577438","name":"map 2. S√§ule","func":"msg.payload = [{\n    measurement: \"CHF\",\n    fields: {\n        bvg_value: 29442,\n        total_value: 37030,\n        bvg_projection_without_interest: 319933,\n        bvg_projection_with_interest: 426207,\n        total_projection_without_interest: 408300,\n        total_projection_with_interest: 547816\n    },\n    tags:{\n        entity_id: \"vorsorge_2_saeule\"\n    },\n    timestamp: Date.parse(\"01.01.2023\") \n}]    \n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":370,"y":3340,"wires":[["195dc03bd9f99035","60ed24c1.a201fc"]]},{"id":"195dc03bd9f99035","type":"debug","z":"e550f91e.577438","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":590,"y":3360,"wires":[]},{"id":"e965479251ca80b2","type":"influxdb in","z":"e550f91e.577438","influxdb":"ff691ce7.c0e1c","name":"Get latest 2. S√§ule Total Value","query":"SELECT distinct(\"total_value\") FROM \"CHF\" WHERE (\"entity_id\" = 'vorsorge_2_saeule') GROUP BY * ORDER BY DESC LIMIT 1","rawOutput":false,"precision":"","retentionPolicy":"","org":"organisation","x":370,"y":880,"wires":[["b9e2e175.9a3ad","6af0335f97a3b006"]]},{"id":"6af0335f97a3b006","type":"ha-entity","z":"e550f91e.577438","name":"2 S√§ule Total HA Sync","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"2. S√§ule Total HA Sync"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:currency-usd"},{"property":"unit_of_measurement","value":"CHF"}],"state":"payload[0].distinct","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":800,"y":880,"wires":[[]]},{"id":"1e12551703b1c237","type":"function","z":"e550f91e.577438","name":"calculate liquid funds","func":"const globalHomeAssistant = global.get('homeassistant');\n\nvar creditCard = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.ubs_credit_card\"].state);\nvar personalAccount = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.ubs_personal_account\"].state);\nvar savingsAccount = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.ubs_savings_account\"].state);\n\nvar cash = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.influx_cash\"].state);\nvar neon = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.influx_neon_checking\"].state);\nvar revolut = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.influx_revolut_checking\"].state);\nvar swissquoteChecking = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.influx_swissquote_checking\"].state);\nvar yuhChecking = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.influx_yuh_checking\"].state);\nvar ibkrChecking = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.influx_ibkr_checking\"].state);\n\nvar total = creditCard+personalAccount+savingsAccount+cash+neon+revolut+swissquoteChecking+yuhChecking+ibkrChecking;\nmsg.liquidfunds = total;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":520,"y":780,"wires":[["35d06792479418e2"]]},{"id":"35d06792479418e2","type":"ha-entity","z":"e550f91e.577438","name":"Liquid Funds","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Liquid Funds"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:currency-usd"},{"property":"unit_of_measurement","value":"CHF"}],"state":"liquidfunds","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":770,"y":780,"wires":[[]]},{"id":"393c883ff166d5c0","type":"ha-entity","z":"e550f91e.577438","name":"Swissquote Performance","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Swissquote Performance"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:certificate-outline"},{"property":"unit_of_measurement","value":"CHF"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":550,"y":4080,"wires":[["1e0438b600760975"]]},{"id":"1e0438b600760975","type":"function","z":"e550f91e.577438","name":"calculate sq profit percentage","func":"const globalHomeAssistant = global.get('homeassistant');\n\nvar sq_balance_today = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.swissquote_balance\"].state);\n\nvar sq_performance_today = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.swissquote_performance\"].state);\nvar sq_performance_bot = -2500;\n\nvar sq_performance_total = sq_performance_today - sq_performance_bot;\n\nmsg.sq_profit_percentage_bot_today = Math.round(sq_performance_total / (sq_balance_today / 100));\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":830,"y":4080,"wires":[["6d998282082a2754"]]},{"id":"6d998282082a2754","type":"ha-entity","z":"e550f91e.577438","name":"Swissquote Profit Percentage","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Swissquote Profit Percentage"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:certificate-outline"},{"property":"unit_of_measurement","value":"%"}],"state":"sq_profit_percentage_bot_today","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":930,"y":4140,"wires":[[]]},{"id":"a5733396e98a6fbf","type":"function","z":"e550f91e.577438","name":"insert metrics","func":"msg.payload = {\n\"data\" : {\n\"metrics\" : [\n{\n\"units\" : \"count\",\n\"data\" : [\n{\n\"qty\" : 5472,\n\"date\" : \"2021-12-11 00:00:00 -0500\"\n},\n{\n\"qty\" : 8169,\n\"date\" : \"2021-12-12 00:00:00 -0500\"\n},\n{\n\"date\" : \"2021-12-13 00:00:00 -0500\",\n\"qty\" : 3446\n},\n{\n\"date\" : \"2021-12-14 00:00:00 -0500\",\n\"qty\" : 4784\n},\n{\n\"date\" : \"2021-12-15 00:00:00 -0500\",\n\"qty\" : 4837.7652613770606\n},\n{\n\"qty\" : 4852,\n\"date\" : \"2021-12-16 00:00:00 -0500\"\n}\n],\n\"name\" : \"step_count\"\n}\n],\n\"workouts\" : [\n\n]\n}\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":220,"y":3440,"wires":[["aaeb804e202a0508"]]},{"id":"9513551692b17c69","type":"inject","z":"e550f91e.577438","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":3560,"wires":[["a5733396e98a6fbf"]]},{"id":"aaeb804e202a0508","type":"function","z":"e550f91e.577438","name":"map health metrics to influx measurement","func":"msg.payload = msg.payload.data.metrics.map(metric => {\n\n    //e.g. measurement for 01.01.2020 of active_energy\n    return metric.data.map(actualMeasurement =>\n       ({\n            measurement: metric.units, //kJ\n            fields: {\n                ...(actualMeasurement.qty && {value: actualMeasurement.qty}), //2500 default\n                ...(actualMeasurement.Avg && {Avg: actualMeasurement.Avg}), //Heartrate special\n                ...(actualMeasurement.Max && {Max: actualMeasurement.Max}), //Heartrate special\n                ...(actualMeasurement.Min && {Min: actualMeasurement.Min}), //Heartrate special\n                ...(actualMeasurement.inBed && {inBed: actualMeasurement.inBed}), //Bed special\n                ...(actualMeasurement.asleep && {asleep: actualMeasurement.asleep}), //Bed special\n                ...(actualMeasurement.heartRateVariation && { value: measurement.heartRateVariation.length }), //irregular heartrate special\n            },\n            tags:{\n                entity_id: metric.name, //active_energy\n                ...(actualMeasurement.sleepSource && {sleepSource: actualMeasurement.sleepSource}), //Bed special\n                ...(actualMeasurement.inBedSource && {inBedSource: actualMeasurement.inBedSource}) //Bed special\n            },\n            timestamp: Date.parse(actualMeasurement.date) //2021-03-16 00:00:00 +0100\n        }))\n    })\n    .flat() // we've created array for each metric consisting of array of measurements\n    .filter(e => Object.keys(e.fields).length) // only return entries with fields\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":500,"y":3440,"wires":[["c3ece44f2716a9b9"]]},{"id":"c3ece44f2716a9b9","type":"debug","z":"e550f91e.577438","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":750,"y":3440,"wires":[]},{"id":"2d6a168145cbcff9","type":"ha-entity","z":"e550f91e.577438","name":"Neon Checking","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Influx Neon Checking"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:currency-usd"},{"property":"unit_of_measurement","value":"CHF"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":520,"y":3660,"wires":[[]]},{"id":"5bcb2e9bb4ca158b","type":"api-current-state","z":"e550f91e.577438","name":"Input Neon Checking","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_number.neon_chf","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":320,"y":3660,"wires":[["2d6a168145cbcff9"]]},{"id":"500676d5cba9d0e9","type":"ha-entity","z":"e550f91e.577438","name":"Yuh Checking","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Influx Yuh Checking"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:currency-usd"},{"property":"unit_of_measurement","value":"CHF"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":520,"y":3720,"wires":[[]]},{"id":"ad0f17505a1d2bee","type":"api-current-state","z":"e550f91e.577438","name":"Input Yuh Checking","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_number.yuh_checking","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":330,"y":3720,"wires":[["500676d5cba9d0e9"]]},{"id":"48e8afda6580f74b","type":"ha-entity","z":"e550f91e.577438","name":"Yuh Investments","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Influx Yuh Investments"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:currency-usd"},{"property":"unit_of_measurement","value":"CHF"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":530,"y":3780,"wires":[[]]},{"id":"521782aff8eb6d87","type":"api-current-state","z":"e550f91e.577438","name":"Input Yuh Investments","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_number.yuh_investments","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":320,"y":3780,"wires":[["48e8afda6580f74b"]]},{"id":"c78fc87d0766b3a1","type":"ha-entity","z":"e550f91e.577438","name":"Yuh Performance","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Influx Yuh Performance"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:currency-usd"},{"property":"unit_of_measurement","value":"CHF"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":530,"y":3840,"wires":[[]]},{"id":"1ebeb6760133e154","type":"api-current-state","z":"e550f91e.577438","name":"Input Yuh Performance","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_number.yuh_performance","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":310,"y":3840,"wires":[["c78fc87d0766b3a1"]]},{"id":"fef914923902d121","type":"server-state-changed","z":"e550f91e.577438","name":"Sync Button","server":"78fe396.483dac8","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"script.sync_finances","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":90,"y":3660,"wires":[["5bcb2e9bb4ca158b","ad0f17505a1d2bee","521782aff8eb6d87","1ebeb6760133e154","f7f6116ca72b937d","2b6f4a0d02b2ce3e","593ac01b1aa6bdf1","0f18815664bb8bd2","e459d20294ac8394","91b127170e515614","63482acd621b6043","a439a78f9d6e9c6e","5d676f72c61482e7","d3061015a186cda1","7bbd9ded9d429a86"]]},{"id":"74331f396686f317","type":"ha-entity","z":"e550f91e.577438","name":"Swissquote Checking","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Influx Swissquote Checking"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:currency-usd"},{"property":"unit_of_measurement","value":"CHF"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":540,"y":3900,"wires":[["114af87562415c25"]]},{"id":"f7f6116ca72b937d","type":"api-current-state","z":"e550f91e.577438","name":"Input Swissquote Checking","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_number.swissquote_checking","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":300,"y":3900,"wires":[["74331f396686f317"]]},{"id":"bf70ce6fecf57c70","type":"ha-entity","z":"e550f91e.577438","name":"Swissquote Assets","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Influx Swissquote Assets"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:currency-usd"},{"property":"unit_of_measurement","value":"CHF"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":530,"y":3960,"wires":[["114af87562415c25"]]},{"id":"2b6f4a0d02b2ce3e","type":"api-current-state","z":"e550f91e.577438","name":"Input Swissquote Assets","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_number.swissquote_assets","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":310,"y":3960,"wires":[["bf70ce6fecf57c70"]]},{"id":"e2b00d8a87a2c0dc","type":"ha-entity","z":"e550f91e.577438","name":"Swissquote Crypto","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Influx Swissquote Crypto"},{"property":"device_class","value":""},{"property":"icon","value":"input_number.swissquote_crypto"},{"property":"unit_of_measurement","value":"CHF"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":530,"y":4020,"wires":[["114af87562415c25"]]},{"id":"593ac01b1aa6bdf1","type":"api-current-state","z":"e550f91e.577438","name":"Input Swissquote Crypto","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_number.swissquote_crypto","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":310,"y":4020,"wires":[["e2b00d8a87a2c0dc"]]},{"id":"0f18815664bb8bd2","type":"api-current-state","z":"e550f91e.577438","name":"Input Swissquote Performance","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_number.swissquote_performance","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":290,"y":4080,"wires":[["393c883ff166d5c0"]]},{"id":"170112e6797bd968","type":"ha-entity","z":"e550f91e.577438","name":"Frankly 3A","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Influx Frankly 3A"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:bank-check"},{"property":"unit_of_measurement","value":"CHF"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":510,"y":4140,"wires":[[]]},{"id":"e459d20294ac8394","type":"api-current-state","z":"e550f91e.577438","name":"Input Frankly 3A","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_number.frankly_3a","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":340,"y":4140,"wires":[["170112e6797bd968"]]},{"id":"50c64b0c3f172726","type":"ha-entity","z":"e550f91e.577438","name":"Revolut Checking","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Influx Revolut Checking"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:currency-usd"},{"property":"unit_of_measurement","value":"CHF"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":530,"y":4540,"wires":[[]]},{"id":"91b127170e515614","type":"api-current-state","z":"e550f91e.577438","name":"Input Revolut Checking","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_number.revolut_checking","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":290,"y":4540,"wires":[["50c64b0c3f172726"]]},{"id":"3081635dad922adb","type":"ha-entity","z":"e550f91e.577438","name":"Cash","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Influx Cash"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:currency-usd"},{"property":"unit_of_measurement","value":"CHF"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":490,"y":4200,"wires":[[]]},{"id":"63482acd621b6043","type":"api-current-state","z":"e550f91e.577438","name":"Input Cash","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_number.cash","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":350,"y":4200,"wires":[["3081635dad922adb"]]},{"id":"114af87562415c25","type":"function","z":"e550f91e.577438","name":"calculate SQ balance","func":"const globalHomeAssistant = global.get('homeassistant');\n\nvar swissquoteAssets = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.influx_swissquote_assets\"].state);\nvar swissquoteCrypto = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.influx_swissquote_crypto\"].state);\nvar swissquoteChecking = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.influx_swissquote_checking\"].state);\n\nvar total = swissquoteAssets + swissquoteCrypto + swissquoteChecking\nmsg.payload = total;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":820,"y":3960,"wires":[["af6f1005.600d3"]]},{"id":"a439a78f9d6e9c6e","type":"link out","z":"e550f91e.577438","name":"","mode":"link","links":["7f4d67d7.97c758"],"x":235,"y":3620,"wires":[]},{"id":"90ed51dc.dcc71","type":"csv","z":"e550f91e.577438","name":"","sep":";","hdrin":false,"hdrout":"none","multi":"mult","ret":"\\n","temp":"date,amount,description","skip":"1","strings":true,"include_empty_strings":false,"include_null_values":false,"x":430,"y":4680,"wires":[["aca852c34e7591a7"]]},{"id":"2bef78fd.ae70f8","type":"template","z":"e550f91e.577438","name":"UBS 2020-2022.01","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Date;Amount;Description\n2022-01-26;-10;APPLE.COM/BILL           0800001853\n2022-01-17;8000;Theodor Michael Alexius Winter\n2022-01-17;-1.1;WANKDORFALLEE 4-- 3030 BERN POST CH LTD 1A\n2022-01-17;-13;THEODOR MICHAEL ALEXIUS WINTER 8048 ZUERICH UBS FONDSKONTO-√úBERTRAG\n2022-01-14;-25;HAUS BELARIA NA-- 7050 AROSA BERGRESTAURANT SIT-HUETT\n2022-01-13;-24;TWINT 41793272674 WINTER-- ALEX\n2022-01-11;-8;TWINT 41764556624 WINTER-- NICOLE\n2022-01-11;-100;RB Lenzerheide 2 KARTE 15246316-0 2212 BEZUG BANCOMAT\n2022-01-10;-4.2;TWINT41764556624 WINTER-- NICOLE\n2022-01-06;-60;BENI WINTER YOUTUBE PREMIUM\n2021-12-31;-10;SALDO DIENSTLEISTUNGSPREISABSCHLUSS \n2021-12-31;-35;APPLE.COM/BILL           0800001853\n2021-12-31;-269.35;ARCOSANA AG LUZERN E-BILL\n2021-12-31;-2247;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN DAUERAUFTRAG\n2021-12-29;-12.95;SPOTIFY                  STOCKHOLM \n2021-12-27;-10;APPLE.COM/BILL           0800001853\n2021-12-21;-1;WANKDORFALLEE 4-- 3030 BERN POST CH LTD 1A\n2021-12-21;-48.25;LIMMATSTRASSE 152  NA-- 8031 ZUERICH SPORTXX ONLINE SHOP\n2021-12-20;-39;BUCKHAUSERSTRASSE 28-- 8048 Z RICH FARMY.CH\n2021-12-20;-105;BRACK. CH AG MAEGENWIL E-BILL\n2021-12-20;-1528;PFINGSTWEIDSTRASSE 60-- 8005 Z RICH DIGITEC GALAXUS\n2021-12-16;-3454.35;STEUERAMT DER STADT ZH 8010 ZUERICH E-BANKING-AUFTRAG\n2021-12-13;-1450;ZAHNARZTZENTRUM.CH AG 8005 ZUERICH E-BANKING-AUFTRAG\n2021-11-30;-10;SALDO DIENSTLEISTUNGSPREISABSCHLUSS \n2021-11-30;-270.25;ARCOSANA AG LUZERN ESR\n2021-11-30;-2247;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN DAUERAUFTRAG\n2021-11-29;-12.95;SPOTIFY                  STOCKHOLM \n2021-11-29;-22;WANKDORFALLEE 4-- 3030 BERN POST CH LTD\n2021-11-26;-6;APPLE.COM/BILL           ITUNES.COM \n2021-11-26;-10;APPLE.COM/BILL           ITUNES.COM \n2021-11-22;-400;TWINT 41765457355 WINTER-- FRANZISKA\n2021-11-15;-13;TWINT 41799473714 SYFRIG-- MARCO\n2021-11-15;-31;TWINT 41799473714 SYFRIG-- MARCO\n2021-11-12;-128.6;ELEKTRIZITAETSWERK DER STADT ZUERICH-- ZUERICH ESR\n2021-11-04;-52;BRACK. CH AG MAEGENWIL ESR\n2021-11-01;-270.25;ARCOSANA AG LUZERN ESR \n2021-10-29;-10;SALDO DIENSTLEISTUNGSPREISABSCHLUSS \n2021-10-29;-12.95;SPOTIFY                  STOCKHOLM \n2021-10-29;-50;BENI WINTER GOOGLE DRIVE STORAGE\n2021-10-29;-2247;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN DAUERAUFTRAG\n2021-10-26;-6;APPLE.COM/BILL           ITUNES.COM \n2021-10-26;-10;APPLE.COM/BILL           ITUNES.COM \n2021-10-22;-16;B RSENSTRASSE 15 NA-- 8001 Z RICH CULINARIUM NATIONALBANK\n2021-10-20;-2;WANKDORFALLEE 4-- 3030 BERN POST CH LTD 1A\n2021-10-20;-20;TWINT 41764097358 THRIER-- YVES\n2021-10-20;-21;APPLE.COM/BILL           ITUNES.COM \n2021-10-11;-19;TWINT 41799473714 SYFRIG-- MARCO\n2021-09-30;-10;SALDO DIENSTLEISTUNGSPREISABSCHLUSS \n2021-09-30;-270.25;ARCOSANA AG LUZERN ESR \n2021-09-30;-2247;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN DAUERAUFTRAG\n2021-09-30;-3454.35;STEUERAMT DER STADT ZH 8010 ZUERICH E-BANKING-AUFTRAG\n2021-09-29;-12.95;SPOTIFY                  STOCKHOLM \n2021-09-27;-6;APPLE.COM/BILL           ITUNES.COM \n2021-09-27;-10;APPLE.COM/BILL           ITUNES.COM \n2021-09-20;-1249;APPLE.COM/CHDE           0844-000-079\n2021-09-16;-69;BRACK. CH AG MAEGENWIL ESR \n2021-09-13;-73.7;ALTSTETTERSTR. 145 NA-- 8047 Z RICH MIGROS ALTSTETTEN\n2021-09-09;-777;INIT7 8406 WINTERTHUR E-BANKING-AUFTRAG\n2021-09-01;-2247;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN E-BANKING-AUFTRAG\n2021-08-31;-10;SALDO DIENSTLEISTUNGSPREISABSCHLUSS \n2021-08-31;-200;MUSIK HUG AG 8001 ZUERICH E-BANKING-AUFTRAG\n2021-08-31;-270.25;ARCOSANA AG LUZERN ESR  \n2021-08-30;-12.95;SPOTIFY                  STOCKHOLM \n2021-08-30;-285;SERAFE AG POSTFACH 8010 Z RICH 27 86003 18285 27900 76777 00044 \n2021-08-25;-4;T GERNAUSTRAS T GERNAUSTRASSE-- 8645 STADTSCHUETZEN RAPPERSWI\n2021-08-12;-122.7;ELEKTRIZITAETSWERK DER STADT ZUERICH-- ZUERICH ESR \n2021-08-10;-120;BASLER VERSICHERUN AG 4002 BASEL E-BANKING-AUFTRAG\n2021-08-10;-2247;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN E-BANKING-AUFTRAG\n2021-08-09;-1420;- NA-- 8031 ZURICH FITNESSPARK PULS 5\n2021-08-02;-270.25;ARCOSANA AG LUZERN ESR    \n2021-07-30;-10;SALDO DIENSTLEISTUNGSPREISABSCHLUSS \n2021-07-29;-12.95;SPOTIFY                  STOCKHOLM \n2021-07-21;-34.25;1PASSWORD                TORONTO\n2021-07-14;-72;4290 GEBUEHR REISESCHUTZ PLUS\n2021-06-30;-10;SALDO DIENSTLEISTUNGSPREISABSCHLUSS \n2021-06-30;-270.25;ARCOSANA AG LUZERN ESR\n2021-06-30;-2247;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN E-BANKING-AUFTRAG\n2021-06-30;-3454.3;STEUERAMT DER STADT ZH 8010 ZUERICH E-BANKING-AUFTRAG\n2021-06-29;-12.95;SPOTIFY                  STOCKHOLM \n2021-06-23;-3118.5;MOOSSTRASSE 23-- 3302 MOOSSEEDORF MICROSPOT.CH\n2021-06-14;-4;TWINT 41764556624 WINTER-- NICOLE\n2021-06-14;-24.7;ARCOSANA AG LUZERN ESR     \n2021-06-10;-24;SBB CFF FFS Mobile Tic   Bern \n2021-06-08;-3.4;SBB EasyRide             Bern 65 SBB\n2021-06-07;-75;ZALANDO AG DE-BERLIN E-BANKING-AUFTRAG\n2021-06-07;-2247;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN E-BANKING-AUFTRAG\n2021-06-01;-11.1;SBB EasyRide             Bern 65 SBB\n2021-05-31;-10;SALDO DIENSTLEISTUNGSPREISABSCHLUSS \n2021-05-31;-12.95;SPOTIFY                  STOCKHOLM \n2021-05-31;-13;SBB EasyRide             Bern 65 SBB\n2021-05-31;-270.25;ARCOSANA AG LUZERN ESR   \n2021-05-25;-7.25;KANELA AG 6014 LUZERN E-BANKING-AUFTRAG\n2021-05-25;-501.2;ARCOSANA AG LUZERN ESR  \n2021-05-17;-30.25;WANKDORFALLEE 4-- 3030 BERN POST CH LTD\n2021-05-17;-122.9;ELEKTRIZITAETSWERK DER STADT ZUERICH-- ZUERICH ESR  \n2021-05-10;-7;TWINT 41765247706 WINTER-- BENI\n2021-05-10;-135.8;ARCOSANA AG LUZERN ESR  \n2021-05-10;-2247;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN E-BANKING-AUFTRAG\n2021-05-07;-10;HIRSCHMATTSTRASSE 4 NA-- 6003 LUZERN WUERZENBACH DROGERIE NUR\n2021-05-07;-16;TWINT 41764556624 WINTER-- NICOLE SUSANNE F\n2021-04-30;-10;SALDO DIENSTLEISTUNGSPREISABSCHLUSS \n2021-04-30;-270.25;ARCOSANA AG LUZERN ESR  \n2021-04-29;-12.95;Spotify P14906E5D7       Stockholm\n2021-04-23;-70;ZKB ZH Altstetten Westli KARTE 15246316-0 2212 BEZUG BANCOMAT\n2021-04-01;-20;TWINT 41765250173 WERNER-- MICHAEL\n2021-03-31;-10;SALDO DIENSTLEISTUNGSPREISABSCHLUSS \n2021-03-31;-20;HOSTPOINT AG 8640 RAPPERSWIL-JONA PAYNET-SAMMELAUFTRAG\n2021-03-31;-270.25;ARCOSANA AG LUZERN PAYNET-SAMMELAUFTRAG\n2021-03-30;-1778.4;KANTON ZUERICH 8090 ZUERICH E-BANKING-AUFTRAG\n2021-03-29;-12.95;SpotifyCH                Stockholm \n2021-03-29;-2247;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN E-BANKING-AUFTRAG\n2021-03-24;-31.8;TALSTRASSE 4-- 4586 KYBURG-BUCHEGG BASTELGARAGE.CH\n2021-03-15;-119.2;Migros MMM Altstetten KARTE 15246316-0 2212 ZAHLUNG DEBITKARTE\n2021-03-01;-12.95;SpotifyCH                Stockholm \n2021-03-01;-270.25;ARCOSANA AG LUZERN ESR \n2021-03-01;-2247;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN E-BANKING-AUFTRAG\n2021-02-26;-10;SALDO DIENSTLEISTUNGSPREISABSCHLUSS \n2021-02-15;-131.35;ELEKTRIZITAETSWERK DER STADT ZUERICH-- ZUERICH ESR\n2021-02-08;-58.25;Coop-5240 Zurich Prime2  Zurich\n2021-02-05;-77.24;AMZNPrime DE*MF6X324X4   amzn.de/info\n2021-02-01;-192;TWINT 41765247706 WINTER-- BERNHARD MARIUS\n2021-01-29;-10;SALDO DIENSTLEISTUNGSPREISABSCHLUSS \n2021-01-29;-12.95;Spotify P1334ADCFD       Stockholm\n2021-01-29;-270.25;ARCOSANA AG LUZERN E-BANKING-AUFTRAG\n2021-01-29;-2247;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN E-BANKING-AUFTRAG\n2021-01-26;-10;TWINT 41764097358 THRIER-- YVES\n2021-01-26;-10;TWINT 41764097358 THRIER-- YVES\n2021-01-14;-14.67;0021 ZINSBELASTUNG\n2021-01-13;-15;HOSTPOINT AG 8640 RAPPERSWIL-JONA ESR\n2021-01-08;-21.7;Coop-4873 Zurich WESTLINKZurich\n2021-01-07;-46.8;BRACK. CH AG MAEGENWIL ESR \n2021-01-06;-60;BENI WINTER YOUTUBE PREMIUM\n2021-01-05;-20.1;Coop-4873 Zurich WESTLINKZurich\n2021-01-05;-270.25;ARCOSANA AG LUZERN E-BANKING-AUFTRAG\n2020-12-31;-10;SALDO DIENSTLEISTUNGSPREISABSCHLUSS \n2020-12-31;-280;FRANZISKA + ALEX WINTER ABZAHLUNG STUDENT LOAN\n2020-12-31;-840;FRANZISKA + ALEX WINTER CH RESTZAHLUNG STUDENT LOAN\n2020-12-31;-2247;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN E-BANKING-AUFTRAG\n2020-12-29;-12.95;SpotifyCH                Stockholm \n2020-12-16;-143.5;TALSTRASSE 4-- 4586 KYBURG-BUCHEGG BASTELGARAGE.CH\n2020-12-15;-29.05;Coop-4873 Z√ºrich WESTLIN KARTE 15246316-0 2212 ZAHLUNG DEBITKARTE\n2020-12-10;-239.2;LIMMATSTRASSE 152  NA-- 8031 ZUERICH SPORTXX ONLINE SHOP\n2020-12-07;-39.9;BRACK. CH AG MAEGENWIL ESR \n2020-12-02;-1.66;DIGITALOCEAN.COM         6463978051\n2020-12-01;-258.45;ASSURA ASSURANCE MALADIE 1009 PULLY ESR\n2020-12-01;-2247;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN E-BANKING-AUFTRAG\n2020-11-30;-3;UBER   *EATS             HELP.UBER.COM \n2020-11-30;-10;SALDO DIENSTLEISTUNGSPREISABSCHLUSS \n2020-11-30;-11;UBER EATS HELP.UBER.CO   help.uber.com \n2020-11-30;-12.95;SpotifyCH                Stockholm \n2020-11-30;-111.8;MOOSSTRASSE 23-- 3302 MOOSSEEDORF MICROSPOT.CH\n2020-11-30;-280;FRANZISKA + ALEX WINTER ABZAHLUNG STUDENT LOAN\n2020-11-27;-184;41765247706 WINTER-- BERNHARD MARIUS\n2020-11-26;-53.4;HINTERM TTLISTRASSE 3-- 5506 M GENWI BRACK.CH ONLINESHOP\n2020-11-26;-55.95;BRACK. CH AG MAEGENWIL ESR  \n2020-11-26;-3493.75;STEUERAMT DER STADT ZH 8010 ZUERICH E-BANKING-AUFTRAG\n2020-11-24;-0.18;1.75% ZUSCHLAG CHF IM AUSLAND\n2020-11-24;-10.23;PAYPAL *UNITYTECHNO      35314369001\n2020-11-17;-206;ZALANDO AG DE-BERLIN 10703071353569\n2020-11-17;-2247;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN E-BANKING-AUFTRAG\n2020-11-12;-148.95;ELEKTRIZITAETSWERK DER STADT ZUERICH-- ZUERICH ESR\n2020-11-02;-258.45;ASSURA ASSURANCE MALADIE 1009 PULLY ESR \n2020-10-30;-10;SALDO DIENSTLEISTUNGSPREISABSCHLUSS \n2020-10-30;-280;FRANZISKA + ALEX WINTER ABZAHLUNG STUDENT LOAN\n2020-10-26;-0.26;1.75% ZUSCHLAG CHF IM AUSLAND\n2020-10-26;-14.6;PAYPAL *BLIZZARDENT      35314369001\n2020-10-23;-50;TWINT 41765247706 WINTER-- BENI\n2020-10-23;-405;ZALANDO AG DE-BERLIN 10703071353569\n2020-10-22;-5.6;SBB EasyRide             Bern 65 SBB\n2020-10-20;-13;SBB EasyRide             Bern 65 SBB\n2020-10-19;-5.6;SBB EasyRide             Bern 65 SBB\n2020-10-19;-21.86;1.75% ZUSCHLAG CHF IM AUSLAND\n2020-10-19;-1249;APPLE.COM/CHDE           0844-000-079\n2020-10-15;-7.54;OCULUS *PGED5VJX62       oculus.com\n2020-10-12;-9.43;OCULUS *KJ7FAXJW62       oculus.com\n2020-10-08;-8.73;1.75% ZUSCHLAG CHF IM AUSLAND\n2020-10-08;-138.5;ZAHNARZTZENTRUM.CH AG 8005 ZUERICH E-BANKING-AUFTRAG\n2020-10-08;-499;OCULUS *C9QTTVNW62       oculus.com\n2020-10-06;-23.67;OCULUS *CYPGMV6X62       oculus.com\n2020-10-05;-15.23;OCULUS *X49PBVEX62       oculus.com\n2020-10-05;-2247;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN E-BANKING-AUFTRAG\n2020-10-02;-1.69;DIGITALOCEAN.COM         6463978051\n2020-10-02;-15.21;OCULUS *X49PBVEX62       oculus.com\n2020-10-01;-258.45;ASSURA ASSURANCE MALADIE 1009 PULLY ESR \n2020-09-30;-10;SALDO DIENSTLEISTUNGSPREISABSCHLUSS \n2020-09-30;-16.1;SBB EasyRide             Bern 65 SBB\n2020-09-30;-280;FRANZISKA + ALEX WINTER ABZAHLUNG STUDENT LOAN\n2020-09-29;-139.62;GOOGLE *Google Store     g.co/helppay# \n2020-09-29;-3493.75;STEUERAMT DER STADT ZH 8010 ZUERICH E-BANKING-AUFTRAG\n2020-09-28;-28.82;OCULUS *BBGNCVSW62       oculus.com\n2020-09-25;-6.1;SBB EasyRide             Bern 65 SBB\n2020-09-25;-777;INIT7 8406 WINTERTHUR E-BANKING-AUFTRAG\n2020-09-23;-3.4;SBB EasyRide             Bern 65 SBB\n2020-09-21;-4.4;SBB EasyRide             Bern 65 SBB\n2020-09-21;-28.24;OCULUS *WPS8YUEX62       oculus.com\n2020-09-14;-2.3;SBB EasyRide             Bern 65 SBB\n2020-09-10;-120;BASLER VERSICHERUN AG 4002 BASEL E-BANKING-AUFTRAG\n2020-09-08;-11.7;SBB EasyRide             Bern 65 SBB\n2020-09-07;-13;SBB EasyRide             Bern 65 SBB\n2020-09-03;-5.6;SBB EasyRide             Bern 65 SBB\n2020-09-01;-3.1;SBB EasyRide             Bern 65 SBB\n2020-09-01;-258.45;ASSURA ASSURANCE MALADIE 1009 PULLY ESR\n2020-08-31;-3.1;SBB CFF FFS Mobile Tic   Bern \n2020-08-31;-8;TWINT 41765250173 WERNER-- MICHAEL\n2020-08-31;-10;SALDO DIENSTLEISTUNGSPREISABSCHLUSS \n2020-08-31;-280;FRANZISKA + ALEX WINTER ABZAHLUNG STUDENT LOAN\n2020-08-31;-2247;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN E-BANKING-AUFTRAG\n2020-08-28;-352.5;SERAFE AG POSTFACH 8010 Z RICH 27 86003 18285 27900 76777 00036 \n2020-08-24;-5.6;SBB EasyRide             Bern 65 SBB\n2020-08-24;-6.2;SBB CFF FFS Mobile Tic   Bern \n2020-08-24;-454;ZALANDO AG DE-BERLIN 10703071353569\n2020-08-17;-3.4;SBB EasyRide             Bern 65 SBB\n2020-08-17;-17.2;SBB EasyRide             Bern 65 SBB\n2020-08-14;-6.8;SBB CFF FFS Mobile Tic   Bern \n2020-08-14;-31.29;0021 ZINSBELASTUNG\n2020-08-13;-139.55;ELEKTRIZITAETSWERK DER STADT ZUERICH-- ZUERICH ESR \n2020-08-05;-8.6;SBB EasyRide             Bern 65 SBB\n2020-08-04;-8.6;SBB EasyRide             Bern 65 SBB\n2020-08-03;-1.68;DIGITALOCEAN.COM         6463978051\n2020-08-03;-258.45;ASSURA ASSURANCE MALADIE 1009 PULLY ESR \n2020-07-31;-10;SALDO DIENSTLEISTUNGSPREISABSCHLUSS \n2020-07-31;-280;FRANZISKA + ALEX WINTER ABZAHLUNG STUDENT LOAN\n2020-07-31;-2247;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN E-BANKING-AUFTRAG\n2020-07-29;-13;SBB EasyRide             Bern 65 SBB\n2020-07-24;-6.2;SBB CFF FFS Mobile Tic   Bern \n2020-07-22;-13;SBB EasyRide             Bern 65 SBB\n2020-07-21;-34.87;1PASSWORD                TORONTO\n2020-07-17;-6.1;SBB EasyRide             Bern 65 SBB\n2020-07-15;-13;SBB EasyRide             Bern 65 SBB\n2020-07-14;-72;4290 GEBUEHR REISESCHUTZ PLUS\n2020-07-14;-182.9;ZALANDO AG DE-BERLIN 10703071353569\n2020-07-14;-3194.15;STEUERAMT DER STADT ZH 8010 ZUERICH E-BANKING-AUFTRAG\n2020-07-07;-80;ZKB ZH Altstetten Westli KARTE 15246316-0 2212 BEZUG BANCOMAT\n2020-07-06;-30;TWINT 41794835111 FUELLEMAN-- LUKAS\n2020-07-01;-258.45;ASSURA ASSURANCE MALADIE 1009 PULLY ESR\n2020-06-30;-10;SALDO DIENSTLEISTUNGSPREISABSCHLUSS \n2020-06-30;-13;SBB EasyRide             Bern 65 SBB\n2020-06-30;-280;FRANZISKA + ALEX WINTER ABZAHLUNG STUDENT LOAN\n2020-06-30;-2247;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN E-BANKING-AUFTRAG\n2020-06-29;-3493.75;STEUERAMT DER STADT ZH 8010 ZUERICH E-BANKING-AUFTRAG\n2020-06-16;-13.5;WWW.RICARDO.CH           ZUG \n2020-06-12;-6.1;SBB EasyRide             Bern 65 SBB\n2020-06-08;-4.4;SBB EasyRide             Bern 65 SBB\n2020-06-03;-9.2;WANKDORFALLEE 4-- 3030 BERN POST CH LTD\n2020-06-02;-1.77;DIGITALOCEAN.COM         6463978051\n2020-06-02;-5.6;SBB EasyRide             Bern 65 SBB\n2020-06-02;-13;SBB CFF FFS Mobile Tic   Bern \n2020-06-02;-258.45;ASSURA ASSURANCE MALADIE 1009 PULLY ESR \n2020-05-29;-4.5;Publibike                Fribourg \n2020-05-29;-10;SALDO DIENSTLEISTUNGSPREISABSCHLUSS \n2020-05-29;-21.8;SBB EasyRide             Bern 65 SBB\n2020-05-29;-280;FRANZISKA + ALEX WINTER ABZAHLUNG STUDENT LOAN\n2020-05-29;-2330;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN E-BANKING-AUFTRAG\n2020-05-22;-13;SBB CFF FFS Mobile Tic   Bern \n2020-05-18;-2330;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN E-BANKING-AUFTRAG\n2020-05-14;-117.7;ELEKTRIZITAETSWERK DER STADT ZUERICH-- ZUERICH ESR  \n2020-05-11;-7;TWINT 41765247706 WINTER-- BENI\n2020-05-11;-13;SBB CFF FFS Mobile Tic   Bern \n2020-05-11;-5299;e-commerce               Wetzikon ZH \n2020-05-04;-0.19;1.75% ZUSCHLAG CHF IM AUSLAND\n2020-05-04;-11.08;PAYPAL *BLIZZARDENT      35314369001\n2020-05-04;-258.45;ASSURA ASSURANCE MALADIE 1009 PULLY ESR   \n2020-04-30;-10;SALDO DIENSTLEISTUNGSPREISABSCHLUSS \n2020-04-30;-280;FRANZISKA + ALEX WINTER ABZAHLUNG STUDENT LOAN\n2020-04-20;-6.8;SBB CFF FFS Mobile Tic   Bern \n2020-04-14;-0.25;1.75% ZUSCHLAG CHF IM AUSLAND\n2020-04-14;-14.42;PAYPAL *BLIZZARDENT      35314369001\n2020-04-14;-17.2;SBB CFF FFS Mobile Tic   Bern \n2020-04-14;-17.2;SBB CFF FFS Mobile Tic   Bern \n2020-04-02;-1.78;DIGITALOCEAN.COM         6463978051\n2020-04-01;-258.45;ASSURA ASSURANCE MALADIE 1009 PULLY ESR    \n2020-04-01;-2330;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN E-BANKING-AUFTRAG\n2020-03-31;-10.3;SALDO DIENSTLEISTUNGSPREISABSCHLUSS \n2020-03-31;-280;FRANZISKA + ALEX WINTER ABZAHLUNG STUDENT LOAN\n2020-03-31;-1818;KANTON ZUERICH 8090 ZUERICH E-BANKING-AUFTRAG\n2020-03-30;-10;POST CH AG POSTLOGISTICS 3030 BERN E-BANKING-AUFTRAG\n2020-03-30;-769;OKENSTRASSE 4-6 NA-- 8037 DEINDEAL AG\n2020-03-25;-20;HOSTPOINT AG 8640 RAPPERSWIL-JONA ESR\n2020-03-23;-0.25;1.75% ZUSCHLAG CHF IM AUSLAND\n2020-03-23;-14.56;PAYPAL *BLIZZARDENT      35314369001\n2020-03-20;-141.5;CLEMENS KOESSLER DE MUENCHEN SKI WEEKEND\n2020-03-19;-5;ZALANDO SE CH 10703071635687\n2020-03-16;-165.14;RB ZH-Altstetten SBB KARTE 15246316-0 2212 BEZUG BANCOMAT\n2020-03-12;-29;TWINT 41799014842 SUTER-- ROBIN\n2020-03-05;-23;TWINT 41765250173 WERNER-- MICHAEL\n2020-03-03;-9.39;AWS EMEA                 aws.amazon.co \n2020-03-02;-12.95;PAYPAL *SPOTIFY          35314369001\n2020-03-02;-258.45;ASSURA ASSURANCE MALADIE 1009 PULLY ESR  \n2020-02-28;-6.2;SBB CFF FFS Mobile Tic   Bern \n2020-02-28;-10;SALDO DIENSTLEISTUNGSPREISABSCHLUSS \n2020-02-28;-280;FRANZISKA + ALEX WINTER ABZAHLUNG STUDENT LOAN\n2020-02-28;-2330;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN E-BANKING-AUFTRAG\n2020-02-26;-1;APPLE.COM/BILL           0800001853\n2020-02-26;-10;APPLE.COM/BILL           0800001853\n2020-02-26;-20.21;OCULUS *HDPYQQ2X62       oculus.com\n2020-02-25;-0.09;1.75% ZUSCHLAG CHF IM AUSLAND\n2020-02-25;-5.13;PAYPAL *NABU CASA        4029357733\n2020-02-25;-9.7;Migros MR Stadelhofen    Zurich \n2020-02-25;-238.5;SWISSCARD AECS GMBH CH - 8810 HORGEN E-BANKING-AUFTRAG\n2020-02-24;-90;PFINGSTWEIDSTRAS60-- 8005 DIGITEC GALAXUS\n2020-02-17;-3.1;SBB EasyRide             Bern 65 SBB\n2020-02-17;-5.6;SBB EasyRide             Bern 65 SBB\n2020-02-17;-16;APPLE.COM/BILL           0800001853\n2020-02-17;-95.35;ELEKTRIZITAETSWERK DER STADT ZUERICH-- ZUERICH ESR  \n2020-02-13;-50;ZALANDO AG DE-BERLIN E-BANKING-AUFTRAG\n2020-02-13;-64.95;ZALANDO SE CH 10703071635687\n2020-02-13;-135;ZALANDO AG DE-BERLIN E-BANKING-AUFTRAG\n2020-02-13;-234.9;ZALANDO AG DE-BERLIN 10703071353569\n2020-02-13;-398.35;BRACK. CH AG MAEGENWIL ESR  \n2020-02-12;-3.1;SBB EasyRide             Bern 65 SBB\n2020-02-12;-122.25;PAYPAL *HEAVEN LABS      4029357733\n2020-02-12;-1420;Fitnesspark Puls 5       Z√ºrich\n2020-02-11;-9.9;Migros MR Stadelhofen    Zurich \n2020-02-10;-6.64;Amazon Video*KN79B6UH5   amazon.com\n2020-02-10;-74.1;PFINGSTWEIDSTRAS60-- 8005 DIGITEC GALAXUS\n2020-02-06;-9.7;Migros MR Stadelhofen    Zurich \n2020-02-06;-22;TWINT 41796038264 TRENTINI-- MURIELE\n2020-02-04;-12.96;AWS EMEA                 aws.amazon.co \n2020-02-03;-1.72;DIGITALOCEAN.COM         6463978051\n2020-02-03;-258.45;ASSURA ASSURANCE MALADIE 1009 PULLY ESR\n2020-01-31;-10;SALDO DIENSTLEISTUNGSPREISABSCHLUSS \n2020-01-31;-10.9;Migros MR Stadelhofen    Zurich \n2020-01-31;-280;FRANZISKA + ALEX WINTER ABZAHLUNG STUDENT LOAN\n2020-01-31;-2330;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN E-BANKING-AUFTRAG\n2020-01-29;-6.2;SBB CFF FFS Mobile Tic   Bern \n2020-01-29;-12.95;PAYPAL *SPOTIFY          35314369001\n2020-01-29;-39.7;SWISSCOM (SCHWEIZ) AG BERN-- LIEBEFELD E-BANKING-AUFTRAG\n2020-01-29;-79.9;PAYPAL *HELLOFRESHS      4029357733\n2020-01-27;-0.09;1.75% ZUSCHLAG CHF IM AUSLAND\n2020-01-27;-5.05;PAYPAL *NABU CASA        4029357733\n2020-01-27;-6.5;SBB EasyRide             Bern 65 SBB\n2020-01-27;-10;APPLE.COM/BILL           0800001853\n2020-01-27;-499;SWISSCARD AECS GMBH CH - 8810 HORGEN E-BANKING-AUFTRAG\n2020-01-24;-66.5;- NA-- 3000 BERN SBB SBB CFF FFS\n2020-01-20;-10.9;Migros MR Stadelhofen    Zurich \n2020-01-20;-25;Ticket BIRKENWEG 61 NA-- 3013 BE TICKETPARK\n2020-01-20;-25.07;OCULUS *JF9EQPWW62       oculus.com\n2020-01-20;-42.8;Coop FELDSTRASSE 88-- 8180 B L COOP\n2020-01-20;-535;digitec Galaxus (Onlin   Z√ºrich \n2020-01-17;-5.6;SBB EasyRide             Bern 65 SBB\n2020-01-17;-23;APPLE.COM/BILL           ITUNES.COM \n2020-01-17;-349.9;Digitec Galaxus PFINGSTWEIDSTRAS60-- 8005 DIGITEC GALAXUS\n2020-01-16;-8.5;Migros MR Stadelhofen    Zurich \n2020-01-15;-15;HOSTPOINT AG 8640 RAPPERSWIL-JONA ESR\n2020-01-15;-79.9;PAYPAL *HELLOFRESHS      4029357733\n2020-01-14;-10.9;Migros MR Stadelhofen    Zurich \n2020-01-13;-2.19;WWW.ALIEXPRESS.COM       LUXEMBOURG \n2020-01-13;-5.6;SBB EasyRide             Bern 65 SBB\n2020-01-10;-4;TWINT 41799607130 HUESSER-- NOAH\n2020-01-10;-8.7;Migros MR Stadelhofen    Zurich \n2020-01-09;-8.7;Migros MR Stadelhofen    Zurich \n2020-01-09;-108;SWISS INT 2318764141     ZURICH\n2020-01-08;-6.71;Amazon Video*GM9048H35   amazon.com\n2020-01-08;-8.5;Migros MR Stadelhofen    Zurich \n2020-01-08;-153.69;Hotel on Booking.com     Amsterdam \n2020-01-07;-10.5;APPLE.COM/BILL           ITUNES.COM \n2020-01-07;-53.6;digitec Galaxus (Onlin   Z√ºrich \n2020-01-06;-2;APPLE.COM/BILL           ITUNES.COM \n2020-01-06;-3.1;SBB EasyRide             Bern 65 SBB\n2020-01-06;-5;SBB CFF FFS Mobile Tic   Bern \n2020-01-06;-6.5;SBB EasyRide             Bern 65 SBB\n2020-01-06;-51.98;HELLO CODE EXIST.IO      EPPING \n2020-01-06;-258.45;ASSURA ASSURANCE MALADIE 1009 PULLY ESR\n2020-01-03;-0.3;1.75% ZUSCHLAG CHF IM AUSLAND\n2020-01-03;-5.61;DB AUTOMATEN             Leipzig \n2020-01-03;-13;TWINT 41799473714 SYFRIG-- MARCO\n2020-01-03;-16.99;PAYPAL *FASTSPRING       4029357733\n2020-01-03;-17.11;DIGITALOCEAN.COM         6463978051\n2020-01-03;-57.85;BRACK. CH AG MAEGENWIL ESR\n2020-01-03;-100;GOOGLE *Google Storage   g.co/helppay# \n2020-01-03;-154;ZALANDO AG DE-BERLIN E-BANKING-AUFTRAG\n2020-01-03;-412.4;SWISSCARD AECS GMBH CH - 8810 HORGEN E-BANKING-AUFTRAG\n2020-01-03;-2330;SBB AG-- IMMOBILIEN / FINANZEN IT-- 3030 BERN E-BANKING-AUFTRAG","output":"str","x":270,"y":4680,"wires":[["90ed51dc.dcc71"]]},{"id":"32c7e522da0b2933","type":"function","z":"e550f91e.577438","name":"Neon format","func":"// Reverse array so that older payments are first\nmsg.payload = msg.payload.reverse();\n\n\n// Update Dates\n// we only have a day value and we need to prevent multiple same day transactions\n// from overwriting eachother in Influx\nvar lastDate = Date.parse(\"2000-01-01T12:33:58Z\");\nmsg.payload.forEach(entry => {\n    \n    //Define source\n    entry.source = \"Neon\";\n    \n    //Format: 2022-01-27T12:33:58Z\n    entry.date = entry.date+\"T09:00:00Z\";\n    var parsedDate = Date.parse(entry.date);\n    if(parsedDate === lastDate){ //60000 = 1min\n        parsedDate = new Date(new Date(parsedDate).getTime() + 60000);\n    }\n    lastDate = parsedDate;\n    entry.date = new Date(parsedDate);\n});\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":730,"y":4900,"wires":[["501e3d53e3a8f331"]]},{"id":"b8431e0290bf43ad","type":"function","z":"e550f91e.577438","name":"influx format","func":"\n\nmsg.payload = msg.payload.map(transaction => {\n    \n    return {\n        measurement: \"CHF\",\n        fields: {\n            value: transaction.amount\n        },\n        tags: {\n            entity_id: \"financial.transactions3\",\n            category: transaction.category,\n            type: transaction.type,\n            source: transaction.source\n        },\n        timestamp: Date.parse(transaction.date)\n}});\n\n\t\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1090,"y":4860,"wires":[["1b94a5a4ba67c58c","deda771a937353b9"]]},{"id":"deda771a937353b9","type":"influxdb batch","z":"e550f91e.577438","influxdb":"ff691ce7.c0e1c","precision":"ms","retentionPolicy":"","name":"Write batch to InfluxDB","database":"","retentionPolicyV18Flux":"","org":"","bucket":"","x":1310,"y":4860,"wires":[]},{"id":"b0a243cca6f9efae","type":"ha-webhook","z":"e550f91e.577438","name":"","server":"78fe396.483dac8","outputs":1,"webhookId":"neon-csv-O0Nax3Pq6qGQVoIAcoqyaXYPNDHZT4eL","payloadLocation":"payload","payloadLocationType":"msg","headersLocation":"headers","headersLocationType":"none","x":100,"y":4860,"wires":[["4fba9a2b09c80e52","2005bfffd5999d0e"]]},{"id":"4fba9a2b09c80e52","type":"function","z":"e550f91e.577438","name":"extract","func":"msg.payload = msg.payload.csv;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":230,"y":4860,"wires":[["af448514e82faf63","2005bfffd5999d0e"]]},{"id":"3ad41ed303f36b3c","type":"csv","z":"e550f91e.577438","name":"Neon CSV","sep":";","hdrin":false,"hdrout":"none","multi":"mult","ret":"\\n","temp":"date,amount,description","skip":"2","strings":true,"include_empty_strings":false,"include_null_values":false,"x":530,"y":4880,"wires":[["32c7e522da0b2933","2005bfffd5999d0e"]]},{"id":"af448514e82faf63","type":"switch","z":"e550f91e.577438","name":"Decider","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"Type,Product,Started Date,Completed Date,Description,Amount,Fee,Currency","vt":"str"},{"t":"cont","v":"\"Date\";\"Incoming Amount/Outgoing Amount\";\"Description\"","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":360,"y":4860,"wires":[["46435d641fdb8f23"],["3ad41ed303f36b3c"]],"outputLabels":["Revolut","Neon"]},{"id":"46435d641fdb8f23","type":"csv","z":"e550f91e.577438","name":"Revolut CSV","sep":",","hdrin":false,"hdrout":"none","multi":"mult","ret":"\\n","temp":"type,product,date,completed_date,description,amount,fee,currency,state,balance","skip":"1","strings":true,"include_empty_strings":false,"include_null_values":false,"x":530,"y":4840,"wires":[["106d89685622db6d","68108ab68639a347"]]},{"id":"501e3d53e3a8f331","type":"function","z":"e550f91e.577438","name":"categorize","func":"const categories = new Map();\n\n//generic\ncategories.set('Ticket', 'Leisure');\ncategories.set('Sportbahnen', 'Leisure');\ncategories.set('Sumup', 'Leisure');\ncategories.set('Zoo Zurich', 'Leisure');\n\ncategories.set('ELEKTRIZITAETSWERK', 'Home');\ncategories.set('INIT7', 'Communication');\ncategories.set('SWISSCOM', 'Communication');\ncategories.set('KANTON ZUERICH', 'Taxes');\ncategories.set('Dhl Express', 'Taxes');\ncategories.set('STEUERAMT DER STADT', 'Taxes');\ncategories.set('Serafe', 'Taxes');\ncategories.set('ABZAHLUNG STUDENT LOAN', 'Education');\ncategories.set('Vue*testing', 'Education');\ncategories.set('Migros', 'Groceries');\ncategories.set('Coop', 'Groceries');\ncategories.set('SodaStream', 'Groceries');\ncategories.set('FARMY.CH', 'Groceries');\ncategories.set('HELLOFRESHS', 'Groceries');\ncategories.set('Power Food', 'Groceries');\ncategories.set('Confiserie', 'Groceries');\ncategories.set('PerfectHair', 'Health & Sport');\ncategories.set('Arcosana', 'Insurance');\ncategories.set('ASSURA', 'Insurance');\ncategories.set('BASLER VERSICHERUN', 'Insurance');\ncategories.set('REISESCHUTZ PLUS', 'Insurance');\ncategories.set('SBB', 'Transport');\ncategories.set('Bird* Ride', 'Transport');\ncategories.set('Sbb Cff Ffs Mobile Ticket', 'Transport');\ncategories.set('Birdrides', 'Transport');\ncategories.set('DB AUTOMATEN', 'Transport');\ncategories.set('Lim*add Balance', 'Transport');\ncategories.set('Lim*ride Cost', 'Transport');\ncategories.set('Tier Mobility', 'Transport');\ncategories.set('www.voiscooters.com', 'Transport');\ncategories.set('Mobility', 'Transport');\ncategories.set('Spotify', 'Entertainment');\ncategories.set('Google *stadia', 'Entertainment');\ncategories.set('Oculus', 'Entertainment');\ncategories.set('Patreon', 'Entertainment');\ncategories.set('Amazon Video', 'Entertainment');\ncategories.set('Nintendo', 'Entertainment');\ncategories.set('Ex Libris', 'Entertainment');\ncategories.set('Steam', 'Entertainment');\ncategories.set('YOUTUBE PREMIUM', 'Entertainment');\ncategories.set('Mojang', 'Entertainment');\ncategories.set('BLIZZARDENT', 'Entertainment');\ncategories.set('Blizzard Entertainment', 'Entertainment');\ncategories.set('Abobestellung Nzz', 'Entertainment');\ncategories.set('Bergbahn', 'Leisure');\ncategories.set('Inselwirtschaft Ufenau', 'Leisure');\ncategories.set('Osteria Sazio', 'Leisure');\ncategories.set('Arena Cinemas', 'Leisure');\ncategories.set('Billiardino', 'Leisure');\ncategories.set('Stoosbahnen Ag', 'Leisure');\ncategories.set('UBER', 'Leisure');\ncategories.set('Burger', 'Leisure');\ncategories.set('Restaurant', 'Leisure');\ncategories.set('Ski Ticketcorner.ch', 'Leisure');\ncategories.set('Selecta', 'Leisure');\ncategories.set('Snarymary-Adventures', 'Leisure');\ncategories.set('Frau Gerold', 'Leisure');\ncategories.set('Lti* Arosa Tix', 'Leisure');\ncategories.set('Lti* Bergbahnen B-E Ti', 'Leisure');\ncategories.set('Kater', 'Leisure');\ncategories.set('Kosmos-Kultur', 'Leisure');\ncategories.set('La Taqueria', 'Leisure');\ncategories.set('Pizolbahnen', 'Leisure');\ncategories.set('Mcdonalds', 'Leisure');\ncategories.set('Digitec', 'Shopping');\ncategories.set('Migros Do It', 'Shopping');\ncategories.set('Migros Mm Brunaupark', 'Shopping');\ncategories.set('Galaxus', 'Shopping');\ncategories.set('AliExpress', 'Shopping');\ncategories.set('interdiscount', 'Shopping');\ncategories.set('Amersports', 'Shopping');\ncategories.set('Amzn Digital', 'Shopping');\ncategories.set('Secretlab', 'Shopping');\ncategories.set('Ricardo', 'Shopping');\ncategories.set('www.cakelicious.ch', 'Shopping');\ncategories.set('Mammut', 'Shopping');\ncategories.set('Brack', 'Shopping');\ncategories.set('Zalando', 'Shopping');\ncategories.set('ZKB ZH Altstetten', 'Cash');\ncategories.set('Ikea', 'Shopping');\ncategories.set('SPORTXX', 'Shopping');\ncategories.set('APPLE.COM/CHDE', 'Shopping');\ncategories.set('Microspot', 'Shopping');\ncategories.set('ZUSCHLAG CHF IM AUSLAND', 'Bank fee');\ncategories.set('SALDO DIENSTLEISTUNGSPREISABSCHLUSS', 'Bank fee');\ncategories.set('ZINSBELASTUNG', 'Bank fee');\ncategories.set('1PASSWORD', 'Apps');\ncategories.set('APPLE.COM/BILL', 'Apps');\ncategories.set('GOOGLE DRIVE', 'Apps');\ncategories.set('Google Storage', 'Apps');\ncategories.set('DIGITALOCEAN.COM', 'Apps');\ncategories.set('HELLO CODE', 'Apps');\ncategories.set('HOSTPOINT', 'Apps');\ncategories.set('NABU CASA', 'Apps');\ncategories.set('nexusmods', 'Apps');\ncategories.set('Ifttt Pro', 'Apps');\ncategories.set('UNITYTECHNO', 'Hobbies');\ncategories.set('UNITY', 'Hobbies');\ncategories.set('BASTELGARAGE.CH', 'Hobbies');\ncategories.set('Name-Cheap.com', 'Hobbies');\ncategories.set('www.reichelt.ch', 'Hobbies');\ncategories.set('Logitech', 'Hobbies');\ncategories.set('Hotel', 'Travel');\ncategories.set('Flixbus', 'Travel');\ncategories.set('SWISS INT', 'Travel');\ncategories.set('Exchanged to', 'Travel');\ncategories.set('Host. Am Schwarzsee', 'Travel');\ncategories.set('FITNESSPARK', 'Health & Sport');\ncategories.set('Amavita', 'Health & Sport');\ncategories.set('ZAHNARZTZENTRUM.CH', 'Health & Sport');\ncategories.set('SBB AG-- IMMOBILIEN', 'Home');\ncategories.set('SBB EasyRide', 'Transport');\ncategories.set('Revolut', 'Revolut');\ncategories.set('TWINT', 'TWINT');\n\nmsg.payload.forEach(entry => {\n    categories.forEach((value, key) => {\n        if(entry.description.toLowerCase().includes(key.toLowerCase())){\n            entry.category = value;\n        }\n    });\n    \n    if(!entry.category){\n        entry.category = \"Other\";\n    }\n    \n    if(entry.category === \"Transport\" && entry.amount === -2247){\n        entry.category = \"Home\";\n    }\n    \n    if(entry.amount >= 0){\n        entry.type = \"incoming\";\n    } else {\n        entry.type = \"outgoing\";\n    }\n});\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":930,"y":4860,"wires":[["b8431e0290bf43ad"]]},{"id":"d5549cbaad9d7297","type":"api-call-service","z":"e550f91e.577438","name":"Set Revolut Input to Balance","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"input_number","service":"set_value","entityId":"input_number.revolut_checking","data":"{\"value\":\"{{payload}}\"}","dataType":"json","mergecontext":"payload","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":980,"y":4760,"wires":[[]]},{"id":"197fa18754f33578","type":"inject","z":"e550f91e.577438","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"3","payloadType":"num","x":110,"y":4680,"wires":[["2bef78fd.ae70f8"]]},{"id":"106d89685622db6d","type":"function","z":"e550f91e.577438","name":"get balance","func":"msg.payload = msg.payload.filter(entry => {\n    return entry.balance; //only returns truthy\n}).reverse()[0].balance;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":730,"y":4740,"wires":[["d5549cbaad9d7297","683c0045e058e4ff"]]},{"id":"683c0045e058e4ff","type":"trigger","z":"e550f91e.577438","name":"","op1":"","op2":"","op1type":"nul","op2type":"date","duration":"3","extend":false,"units":"s","reset":"","bytopic":"all","outputs":1,"x":920,"y":4720,"wires":[["91b127170e515614"]]},{"id":"aca852c34e7591a7","type":"function","z":"e550f91e.577438","name":"UBS format","func":"// Reverse array so that older payments are first\nmsg.payload = msg.payload.reverse();\n\n\n// Update Dates\n// we only have a day value and we need to prevent multiple same day transactions\n// from overwriting eachother in Influx\nvar lastDate = Date.parse(\"2000-01-01T12:33:58Z\");\nmsg.payload.forEach(entry => {\n    \n    //Define source\n    entry.source = \"UBS\";\n    \n    //Format: 2022-01-27T12:33:58Z\n    entry.date = entry.date+\"T09:00:00Z\";\n    var parsedDate = Date.parse(entry.date);\n    if(parsedDate === lastDate){ //60000 = 1min\n        parsedDate = new Date(new Date(parsedDate).getTime() + 60000);\n    }\n    lastDate = parsedDate;\n    entry.date = new Date(parsedDate);\n});\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":730,"y":4820,"wires":[["501e3d53e3a8f331"]]},{"id":"68108ab68639a347","type":"function","z":"e550f91e.577438","name":"Revolut format","func":"msg.payload.forEach(entry => {\n    //Define source\n    entry.source = \"Revolut\";\n});\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":740,"y":4860,"wires":[["501e3d53e3a8f331"]]},{"id":"1b94a5a4ba67c58c","type":"debug","z":"e550f91e.577438","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1250,"y":4820,"wires":[]},{"id":"d2c97ddedb1634be","type":"template","z":"e550f91e.577438","name":"Neon Correction File","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"SKIP;SKIP;SKIP\nDate;Amount;Description\n2022-02-01;2247;Correction: SBB Wrongly booked rent as transport","output":"str","x":340,"y":4980,"wires":[["3ad41ed303f36b3c"]]},{"id":"aba5b27cb12af98f","type":"inject","z":"e550f91e.577438","name":"Correct Neon","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"3","payloadType":"num","x":130,"y":4980,"wires":[["d2c97ddedb1634be"]]},{"id":"8b76bc66b4a47a90","type":"inject","z":"e550f91e.577438","name":"Manual sync","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":170,"y":3320,"wires":[["8dca3ad193c4bc7a"]]},{"id":"1ff88f6d7b6a2798","type":"ha-entity","z":"e550f91e.577438","name":"IBKR Checking","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Influx IBKR Checking"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:currency-usd"},{"property":"unit_of_measurement","value":"CHF"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":520,"y":4260,"wires":[["7812bbdcf250e693"]]},{"id":"4d27983b6f16910c","type":"ha-entity","z":"e550f91e.577438","name":"IBKR Assets","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Influx IBKR Assets"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:currency-usd"},{"property":"unit_of_measurement","value":"CHF"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":510,"y":4320,"wires":[["7812bbdcf250e693"]]},{"id":"7812bbdcf250e693","type":"function","z":"e550f91e.577438","name":"calculate IBKR balance","func":"const globalHomeAssistant = global.get('homeassistant');\n\nvar ibkrAssets = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.influx_ibkr_assets\"].state);\nvar ibkrChecking = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.influx_ibkr_checking\"].state);\n\nvar total = ibkrAssets + ibkrChecking\nmsg.payload = total;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":830,"y":4260,"wires":[["a17af4c4356937fe"]]},{"id":"a17af4c4356937fe","type":"ha-entity","z":"e550f91e.577438","name":"IBKR Balance","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"IBKR Balance"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:certificate-outline"},{"property":"unit_of_measurement","value":"CHF"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":820,"y":4300,"wires":[[]]},{"id":"5d676f72c61482e7","type":"api-current-state","z":"e550f91e.577438","name":"Input IBKR Checking","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_number.ibkr_checking","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":320,"y":4260,"wires":[["1ff88f6d7b6a2798"]]},{"id":"d3061015a186cda1","type":"api-current-state","z":"e550f91e.577438","name":"Input IBKR Assets","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_number.ibkr_assets","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":330,"y":4320,"wires":[["4d27983b6f16910c"]]},{"id":"7bbd9ded9d429a86","type":"api-current-state","z":"e550f91e.577438","name":"Input IBKR Performance","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_number.ibkr_performance","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":310,"y":4380,"wires":[["2a21f3133c98c95e"]]},{"id":"2a21f3133c98c95e","type":"ha-entity","z":"e550f91e.577438","name":"IBKR Performance","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Influx IBKR Performance"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:certificate-outline"},{"property":"unit_of_measurement","value":"CHF"}],"state":"payload","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"","outputPayloadType":"str","x":530,"y":4380,"wires":[[]]},{"id":"e6725379b1134faa","type":"ha-entity","z":"e550f91e.577438","name":"Experience Points","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Experience Points"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:thumb-up-outline"},{"property":"unit_of_measurement","value":"Exp"}],"state":"newExpValue","stateType":"msg","attributes":[],"resend":true,"outputLocation":"payload","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":590,"y":440,"wires":[[]]},{"id":"ff1da03d407aaf06","type":"link in","z":"e550f91e.577438","name":"Experience Points","links":["d77b4039db495d83","932243510eecd2c4"],"x":145,"y":440,"wires":[["efda3943ed0d8e1a"]]},{"id":"efda3943ed0d8e1a","type":"function","z":"e550f91e.577438","name":"add 1 exp","func":"const globalHomeAssistant = global.get('homeassistant');\n\nvar existingPoints = parseInt(globalHomeAssistant.homeAssistant.states[\"sensor.experience_points\"].state);\n\nmsg.newExpValue = existingPoints+1;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":320,"y":440,"wires":[["e6725379b1134faa"]]},{"id":"857e4eadb74b0ae2","type":"function","z":"e550f91e.577438","name":"reset daily exp","func":"\nmsg.newExpValue = 0;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":340,"y":500,"wires":[["e6725379b1134faa"]]},{"id":"1d8ab537d004de28","type":"inject","z":"e550f91e.577438","name":"Midnight","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"59 23 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":500,"wires":[["857e4eadb74b0ae2"]]},{"id":"2005bfffd5999d0e","type":"debug","z":"e550f91e.577438","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":470,"y":4760,"wires":[]},{"id":"1e716bc640be1a0e","type":"api-call-service","z":"e550f91e.577438","name":"Peak Tariff","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"select","service":"select_option","entityId":"select.daily_energy","data":"{\"option\":\"peak\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":390,"y":1720,"wires":[["38d223f015b932e0"]]},{"id":"38d223f015b932e0","type":"debug","z":"e550f91e.577438","name":"debug 1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":580,"y":1760,"wires":[]},{"id":"4619eea4b0d72c3b","type":"inject","z":"e550f91e.577438","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"3","payloadType":"num","x":810,"y":4540,"wires":[["99956b70de04d563"]]},{"id":"e5a76405d427e70e","type":"subflow:d4379195.7e131","z":"e550f91e.577438","name":"","env":[{"name":"secret_id","value":"firefly_token","type":"str"},{"name":"is_bearer","value":"true","type":"bool"}],"x":1040,"y":4540,"wires":[["9d1ae33dd0e4b082","6625502c51f47878"]]},{"id":"9d1ae33dd0e4b082","type":"debug","z":"e550f91e.577438","name":"debug 2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1320,"y":4480,"wires":[]},{"id":"6625502c51f47878","type":"http request","z":"e550f91e.577438","name":"","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://sixtymeters2.duckdns.org/firefly/api/v1/about","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[{"keyType":"other","keyValue":"Authorization","valueType":"msg","valueValue":"secret"}],"x":1230,"y":4540,"wires":[["9d1ae33dd0e4b082"]]},{"id":"c5173be940a9c315","type":"csv","z":"e550f91e.577438","name":"Neon CSV","sep":";","hdrin":false,"hdrout":"none","multi":"one","ret":"\\n","temp":"date,amount,description","skip":"2","strings":true,"include_empty_strings":false,"include_null_values":false,"x":1070,"y":4600,"wires":[[]]},{"id":"99956b70de04d563","type":"template","z":"e550f91e.577438","name":"Neon Test","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\"Date\";\"Amount\";\"Original amount\";\"Original currency\";\"Exchange rate\";\"Description\";\"Subject\";\"Category\";\"Tags\";\"Wise\";\"Spaces\"\n\"2022-09-15\";\"-150.00\";\"\";\"\";\"\";\"Revolut\";;\"finances\";\"\";\"no\";\"no\"\n\"2022-09-12\";\"-69.90\";\"\";\"\";\"\";\"Zalando\";\"10703124627487\";\"shopping\";\"\";\"no\";\"no\"\n\"2022-09-11\";\"-1299.00\";\"\";\"\";\"\";\"Apple\";;\"shopping\";\"\";\"no\";\"no\"\n\"2022-09-10\";\"-3.00\";\"\";\"\";\"\";\"Apple\";;\"shopping\";\"\";\"no\";\"no\"\n\"2022-09-08\";\"-150.00\";\"\";\"\";\"\";\"Revolut\";;\"finances\";\"\";\"no\";\"no\"\n\"2022-09-07\";\"-777.00\";\"\";\"\";\"\";\"Init7 (Schweiz) AG\";\"QR-Bill: PURPOSE: INC22020808 / REF: 000000000000000000220208086\";\"household\";\"\";\"no\";\"no\"\n\"2022-09-01\";\"-2247.00\";\"\";\"\";\"\";\"SBB CFF FFS\";;\"transport\";\"rent\";\"no\";\"no\"\n\"2022-09-01\";\"-150.00\";\"\";\"\";\"\";\"Revolut\";;\"finances\";\"\";\"no\";\"no\"\n\"2022-09-01\";\"-150.00\";\"\";\"\";\"\";\"Revolut\";;\"finances\";\"\";\"no\";\"no\"","output":"str","x":860,"y":4600,"wires":[["c5173be940a9c315"]]},{"id":"ec3239d7dea9f85f","type":"file","z":"f008a57656af0219","name":"file","filename":"/config/node-red/micro-tasks.json","appendNewline":true,"createDir":true,"overwriteFile":"true","encoding":"none","x":1110,"y":500,"wires":[[]]},{"id":"7710f81e68930f78","type":"file in","z":"f008a57656af0219","name":"file","filename":"/config/node-red/micro-tasks.json","format":"utf8","chunk":false,"sendError":false,"encoding":"none","allProps":false,"x":610,"y":540,"wires":[["af549ec83fdfb7d3"]]},{"id":"af549ec83fdfb7d3","type":"function","z":"f008a57656af0219","name":"read existing and perform action","func":"var existingTasks = JSON.parse(msg.payload);\n\nvar allTasksDone = \"All tasks done!\";\n\n// Handle action\nswitch (msg.action) {\n  case \"ADD_NEW\":\n    existingTasks.push(msg.newTask);\n    break;\n  case \"DELETE\":\n    existingTasks.shift();\n    break;\n  case \"DONE\":\n  case \"BACK_OFF\":\n    var firstTask = existingTasks.shift();\n    existingTasks.push(firstTask);\n    break;\n  default:\n}\n\n// Remove all tasks done if we have more than 1 task\nif(existingTasks.length > 1 && existingTasks[0] === allTasksDone){\n    existingTasks.shift();\n}\n\n// Add all tasks done if we have no tasks\nif (!(typeof existingTasks != \"undefined\" && existingTasks != null && existingTasks.length != null && existingTasks.length > 0)) {\n    existingTasks.push(allTasksDone);\n}\n\nmsg.payload = existingTasks;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":830,"y":540,"wires":[["ec3239d7dea9f85f","96944f9f4c8e30db","de57c1ae7f9b318c","fe00e1d280628952"]]},{"id":"a1a5532ef8f7ed6d","type":"server-state-changed","z":"f008a57656af0219","name":"Add task","server":"78fe396.483dac8","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_button.add_micro_task","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":100,"y":700,"wires":[["0dbc18eb199bc578"]]},{"id":"999f092d4ababd89","type":"api-current-state","z":"f008a57656af0219","name":"get task input","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_text.micro_task_input","state_type":"str","state_location":"newTask","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":470,"y":600,"wires":[["7710f81e68930f78"]]},{"id":"96944f9f4c8e30db","type":"ha-entity","z":"f008a57656af0219","name":"Next Micro Task","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Next Micro Task"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:cog-outline"},{"property":"unit_of_measurement","value":""}],"state":"payload[0]","stateType":"msg","attributes":[],"resend":true,"outputLocation":"payload","outputLocationType":"none","inputOverride":"allow","outputOnStateChange":false,"outputPayload":"$entity().state ? \"on\": \"off\"","outputPayloadType":"jsonata","x":1140,"y":540,"wires":[[]]},{"id":"de57c1ae7f9b318c","type":"api-call-service","z":"f008a57656af0219","name":"reset input","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"input_text","service":"set_value","entityId":"input_text.micro_task_input","data":"{\"value\":\"\"}","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":1130,"y":580,"wires":[[]]},{"id":"8457cc2be40a1502","type":"server-state-changed","z":"f008a57656af0219","name":"Task Done","server":"78fe396.483dac8","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_button.micro_task_done","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":140,"y":520,"wires":[["23998292bf3138db"]]},{"id":"07679e6c5f05d1e5","type":"server-state-changed","z":"f008a57656af0219","name":"Task Delete","server":"78fe396.483dac8","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_button.micro_task_delete","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":130,"y":560,"wires":[["1ff12836d8e5b637"]]},{"id":"019cadfb5688fa74","type":"server-state-changed","z":"f008a57656af0219","name":"Task Back off queue","server":"78fe396.483dac8","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_button.micro_task_back_of_queue","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":110,"y":480,"wires":[["5b4809933f7c6e09"]]},{"id":"1ff12836d8e5b637","type":"function","z":"f008a57656af0219","name":"Action: Delete","func":"msg.action = \"DELETE\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":300,"y":560,"wires":[["7710f81e68930f78"]]},{"id":"23998292bf3138db","type":"function","z":"f008a57656af0219","name":"Action: Done","func":"msg.action = \"DONE\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":290,"y":520,"wires":[["7710f81e68930f78"]]},{"id":"5b4809933f7c6e09","type":"function","z":"f008a57656af0219","name":"Action: Back Off","func":"msg.action = \"BACK_OFF\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":300,"y":480,"wires":[["7710f81e68930f78"]]},{"id":"0dbc18eb199bc578","type":"function","z":"f008a57656af0219","name":"Action: Add New","func":"msg.action = \"ADD_NEW\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":300,"y":600,"wires":[["999f092d4ababd89"]]},{"id":"fe00e1d280628952","type":"function","z":"f008a57656af0219","name":"influx format","func":"msg.payload = [{\n    measurement: \"Task\",\n    fields: {\n        value: 1\n    },\n    tags: {\n        entity_id: \"task.microtasks\",\n        action: msg.action\n    },\n}]\n\n\t\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1130,"y":640,"wires":[["14d2aa1dfa0eaaf4"]]},{"id":"14d2aa1dfa0eaaf4","type":"influxdb batch","z":"f008a57656af0219","influxdb":"ff691ce7.c0e1c","precision":"ms","retentionPolicy":"","name":"Write batch to InfluxDB","database":"","retentionPolicyV18Flux":"","org":"","bucket":"","x":1340,"y":640,"wires":[]},{"id":"eb3e9943.3b5f18","type":"ha-entity","z":"84cddc8f.78464","name":"Kitchen Bin","server":"78fe396.483dac8","version":1,"debugenabled":false,"outputs":1,"entityType":"sensor","config":[{"property":"name","value":"Kitchen Bin"},{"property":"device_class","value":""},{"property":"icon","value":"mdi:trash-can-outline"},{"property":"unit_of_measurement","value":"days since last emptied"}],"state":"daysSinceLastEmptied","stateType":"msg","attributes":[],"resend":true,"outputLocation":"","outputLocationType":"none","inputOverride":"allow","x":910,"y":180,"wires":[[]]},{"id":"f4f2a9b7.cc1998","type":"server-events","z":"84cddc8f.78464","name":"NFC Tag scanned","server":"78fe396.483dac8","event_type":"tag_scanned","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"x":130,"y":280,"wires":[["a0b49d73.eb00d","d6e915c6.8da9f8"]]},{"id":"a0b49d73.eb00d","type":"switch","z":"84cddc8f.78464","name":"tag of type","property":"payload.event.tag_id","propertyType":"msg","rules":[{"t":"eq","v":"trashcan","vt":"str"},{"t":"eq","v":"04-BF-CF-6A-83-64-80","vt":"str"},{"t":"eq","v":"04-15-91-0A-00-96-26","vt":"str"},{"t":"eq","v":"04-15-91-1A-C9-E1-26","vt":"str"},{"t":"eq","v":"04-15-91-0A-3D-34-26","vt":"str"},{"t":"eq","v":"04-15-91-1A-C3-B6-26","vt":"str"},{"t":"eq","v":"04-15-91-0A-A7-4E-26","vt":"str"},{"t":"eq","v":"04-15-91-1A-4D-DA-26","vt":"str"},{"t":"eq","v":"04-15-91-0A-42-E0-26","vt":"str"},{"t":"eq","v":"04-15-91-1A-E6-81-26","vt":"str"}],"checkall":"true","repair":false,"outputs":10,"x":310,"y":280,"wires":[["4112ad63.71cf54"],["6d2dc22a.48c7fc","6a51b9aa.078708","3ad35762.b0abc8","dece190.ad22de8"],["8bee61ca.c9d27"],["9eaae95a.250a18"],["2f474b1f06a7d61c"],["0436629f96b47e1a"],["b6a25c43e7798504"],["ec7932b2740f60b6"],["f2710b3f935e1acb"],["f7ea21c64a5fefce"]]},{"id":"8c7d10a6.b433a","type":"function","z":"84cddc8f.78464","name":"calculate days since last emptied","func":"var lastEmptiedDate = new Date(msg.data.last_updated);\nvar today = new Date();\nconst diffTime = Math.abs(today - lastEmptiedDate);\nconst diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n\nmsg.daysSinceLastEmptied = diffDays;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":680,"y":180,"wires":[["eb3e9943.3b5f18"]]},{"id":"4112ad63.71cf54","type":"api-current-state","z":"84cddc8f.78464","name":"bin state","server":"78fe396.483dac8","version":1,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"sensor.kitchen_bin","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":460,"y":180,"wires":[["8c7d10a6.b433a"]]},{"id":"85b120f7.7e1d5","type":"server-state-changed","z":"84cddc8f.78464","name":"Tagreader State Change","server":"78fe396.483dac8","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.tagreader_99b69a_buzzer_enabled","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":170,"y":840,"wires":[["21c36762.ca96f8","3b1fe51b.af884a","dce6b8e6.1163a8"]]},{"id":"21c36762.ca96f8","type":"api-call-service","z":"84cddc8f.78464","name":"LED ON","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"light","service":"turn_on","entityId":"light.tagreader_99b69a_led","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":430,"y":820,"wires":[[]]},{"id":"3b1fe51b.af884a","type":"api-call-service","z":"84cddc8f.78464","name":"Buzzer ON","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.tagreader_99b69a_buzzer_enabled","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":440,"y":860,"wires":[[]]},{"id":"dce6b8e6.1163a8","type":"api-call-service","z":"84cddc8f.78464","name":"LED confirmation ON","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.tagreader_99b69a_led_enabled","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":470,"y":900,"wires":[[]]},{"id":"8cb1b8bd.0833b8","type":"api-call-service","z":"84cddc8f.78464","name":"Activate Party Colors","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"scene","service":"turn_on","entityId":"scene.party_colors","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":760,"y":280,"wires":[[]]},{"id":"e0cbb2a5.3b013","type":"api-call-service","z":"84cddc8f.78464","name":"Spotify: WestLink Party Playlist","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"spotcast","service":"start","entityId":"media_player.everywhere","data":"{\"uri\":\"spotify:playlist:7bQrKU1BnsWrNIXXDUv7WM\",\"shuffle\":true}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":790,"y":320,"wires":[[]]},{"id":"d6e915c6.8da9f8","type":"debug","z":"84cddc8f.78464","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":290,"y":480,"wires":[]},{"id":"6d2dc22a.48c7fc","type":"api-call-service","z":"84cddc8f.78464","name":"Pause all media players","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"media_player","service":"turn_off","entityId":"media_player.samsung_tv, media_player.everywhere, media_player.google_home, media_player.bathroom, media_player.home_hub, media_player.bedroom_speaker, media_player.loggia_speaker","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":550,"y":380,"wires":[[]]},{"id":"6a51b9aa.078708","type":"api-call-service","z":"84cddc8f.78464","name":"Turn all lights off","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"all","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":520,"y":340,"wires":[[]]},{"id":"3ad35762.b0abc8","type":"trigger","z":"84cddc8f.78464","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"2","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":500,"y":300,"wires":[["8cb1b8bd.0833b8","e0cbb2a5.3b013"]]},{"id":"dece190.ad22de8","type":"api-call-service","z":"84cddc8f.78464","name":"Turn Click & Grow off","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.mystromclickandgrow3","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":540,"y":420,"wires":[[]]},{"id":"8bee61ca.c9d27","type":"function","z":"84cddc8f.78464","name":"100kcal","func":"msg.payload = 100;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":480,"wires":[["6bf84159.60762"]]},{"id":"9eaae95a.250a18","type":"function","z":"84cddc8f.78464","name":"50kcal","func":"msg.payload = 50;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":490,"y":520,"wires":[["6bf84159.60762"]]},{"id":"6bf84159.60762","type":"link out","z":"84cddc8f.78464","name":"Calories Input","links":["3b7540d1.ba7c5"],"x":615,"y":500,"wires":[]},{"id":"2f474b1f06a7d61c","type":"api-call-service","z":"84cddc8f.78464","name":"Spotify: Schwizerd√ºtsch","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"spotcast","service":"start","entityId":"media_player.everywhere","data":"{\"uri\":\"spotify:playlist:1sNB7DzHbHYS6rNVOfa4jP\",\"shuffle\":true}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":550,"y":600,"wires":[["9b5c7f8f62b05eba"]]},{"id":"0436629f96b47e1a","type":"link out","z":"84cddc8f.78464","name":"Shutdown Input","links":["f8fd9032b140b6ca"],"x":455,"y":560,"wires":[]},{"id":"b6a25c43e7798504","type":"api-call-service","z":"84cddc8f.78464","name":"Spotify: United States of America","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"spotcast","service":"start","entityId":"media_player.everywhere","data":"{\"uri\":\"spotify:playlist:1C0ZFzOs6tFSHDiUPfkTkH\",\"shuffle\":true}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":580,"y":640,"wires":[[]]},{"id":"ec7932b2740f60b6","type":"api-call-service","z":"84cddc8f.78464","name":"Spotify: WestLink Lounge","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"spotcast","service":"start","entityId":"media_player.everywhere","data":"{\"uri\":\"spotify:playlist:440DwvrtJWWM3v0AgRSRNx\",\"shuffle\":true}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":550,"y":680,"wires":[[]]},{"id":"f2710b3f935e1acb","type":"api-call-service","z":"84cddc8f.78464","name":"Spotify: Dystopian Darkness","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"spotcast","service":"start","entityId":"media_player.everywhere","data":"{\"uri\":\"spotify:playlist:1Fpb7VeVUpCE8TOXJGKeZt\",\"shuffle\":true}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":560,"y":720,"wires":[[]]},{"id":"f7ea21c64a5fefce","type":"api-call-service","z":"84cddc8f.78464","name":"Spotify: Space","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"spotcast","service":"start","entityId":"media_player.everywhere","data":"{\"uri\":\"spotify:playlist:2yz12Nw1DbaPVNQNtBUVUh\",\"shuffle\":true}","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":520,"y":760,"wires":[[]]},{"id":"9b5c7f8f62b05eba","type":"debug","z":"84cddc8f.78464","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":760,"y":600,"wires":[]},{"id":"c0a802d52595c03d","type":"trigger-state","z":"b13dd5761c2c67bf","name":"Energy Save Mode","server":"78fe396.483dac8","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"input_boolean.energy_save_mode","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"bool","comparatorValue":"true","propertyValue":"new_state.state"}],"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"habool","x":190,"y":180,"wires":[["d5781f9e897e1aa9","1c14d4652527e1ac","fa783e8bd1404ca3","480b491b7204f094","9db43fbe150f3231"],["5b0e3991b1bd6e54","94abade1990ab197"]]},{"id":"554d47292d672019","type":"debug","z":"b13dd5761c2c67bf","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":830,"y":200,"wires":[]},{"id":"d5781f9e897e1aa9","type":"api-call-service","z":"b13dd5761c2c67bf","name":"Computer Power OFF","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_off","entityId":"switch.mystromimac","data":"","dataType":"jsonata","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":540,"y":100,"wires":[[]]},{"id":"94abade1990ab197","type":"api-call-service","z":"b13dd5761c2c67bf","name":"Computer Power ON","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"switch","service":"turn_on","entityId":"switch.mystromimac","data":"","dataType":"jsonata","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":540,"y":380,"wires":[[]]},{"id":"fa783e8bd1404ca3","type":"api-call-service","z":"b13dd5761c2c67bf","name":"Kitchen Utilities OFF","server":"78fe396.483dac8","version":"1","service_domain":"switch","service":"turn_off","entityId":"switch.kitchen_plug","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":540,"y":180,"wires":[[]]},{"id":"480b491b7204f094","type":"api-call-service","z":"b13dd5761c2c67bf","name":"Turn all lights off","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"all","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":520,"y":260,"wires":[[]]},{"id":"1c14d4652527e1ac","type":"api-call-service","z":"b13dd5761c2c67bf","name":"Pause all media players","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"media_player","service":"turn_off","entityId":"media_player.samsung_tv, media_player.everywhere, media_player.google_home, media_player.bathroom, media_player.home_hub, media_player.bedroom_speaker, media_player.loggia_speaker","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":550,"y":140,"wires":[[]]},{"id":"9db43fbe150f3231","type":"api-call-service","z":"b13dd5761c2c67bf","name":"TV Energy Off","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.tv_energy","data":"","dataType":"jsonata","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":520,"y":220,"wires":[[]]},{"id":"5b0e3991b1bd6e54","type":"trigger","z":"b13dd5761c2c67bf","name":"wait 1min","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"1","extend":false,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":500,"y":320,"wires":[["147be333218b582a"]]},{"id":"fa7c7055dfb9f02b","type":"api-current-state","z":"b13dd5761c2c67bf","name":"Office Power < 70W","server":"78fe396.483dac8","version":1,"outputs":2,"halt_if":"70","halt_if_type":"num","halt_if_compare":"lt","override_topic":false,"entity_id":"sensor.office_power","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":440,"y":580,"wires":[["21b6096e1a9ee3bd"],[]]},{"id":"bb184e1835c05f91","type":"api-call-service","z":"b13dd5761c2c67bf","name":"Energy Save Mode On","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.energy_save_mode","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":680,"y":640,"wires":[[]]},{"id":"21b6096e1a9ee3bd","type":"api-current-state","z":"b13dd5761c2c67bf","name":"TV is off","server":"78fe396.483dac8","version":1,"outputs":2,"halt_if":"false","halt_if_type":"bool","halt_if_compare":"is","override_topic":false,"entity_id":"switch.samsung_tv","state_type":"habool","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":480,"y":640,"wires":[["bb184e1835c05f91"],[]]},{"id":"157950131f740657","type":"inject","z":"b13dd5761c2c67bf","name":"Interval 22:00 - 00:00","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"*/10 22-23 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":520,"wires":[["9052d5bf38b71d28"]]},{"id":"92494297f1311068","type":"inject","z":"b13dd5761c2c67bf","name":"Interval 00:00 - 02:00","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"*/10 0-1 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":560,"wires":[["9052d5bf38b71d28"]]},{"id":"d074501098e3667c","type":"link in","z":"b13dd5761c2c67bf","name":"Secure Energy Safe Mode ON","links":["bf48167398d96d8a"],"x":225,"y":480,"wires":[["9052d5bf38b71d28"]]},{"id":"9052d5bf38b71d28","type":"api-current-state","z":"b13dd5761c2c67bf","name":"is ESM already engaged?","server":"78fe396.483dac8","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.energy_save_mode","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":430,"y":520,"wires":[[],["fa7c7055dfb9f02b"]]},{"id":"147be333218b582a","type":"api-call-service","z":"b13dd5761c2c67bf","name":"Turn Loggia Lightstrip & Nanoleaf Off","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"light","service":"turn_off","entityId":"light.loggia_lightstrip, light.nanoleaf","data":"","dataType":"json","mergecontext":"","output_location":"payload","output_location_type":"msg","mustacheAltTags":false,"x":730,"y":320,"wires":[[]]},{"id":"6477afb48c04a14c","type":"server-state-changed","z":"b13dd5761c2c67bf","name":"Samsung TV turned off for 5min","server":"78fe396.483dac8","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.samsung_tv","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"false","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"5","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"x":150,"y":720,"wires":[["88801d6407ad20a6"],[]]},{"id":"88801d6407ad20a6","type":"api-call-service","z":"b13dd5761c2c67bf","name":"TV Energy Off","server":"78fe396.483dac8","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.tv_energy","data":"","dataType":"jsonata","mergecontext":"","output_location":"payload","output_location_type":"none","mustacheAltTags":false,"x":400,"y":720,"wires":[[]]}]